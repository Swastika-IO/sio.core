”G
WD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\App_Start\Startup.Auth.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
{ 
public 

partial 
class 
Startup  
{ 
	protected 
void 
ConfigIdentity %
(% &
IServiceCollection& 8
services9 A
,A B
IConfigurationRootC U
ConfigurationV c
,c d
stringe k
connectionNamel z
)z {
{ 	
services 
. 
AddDbContext !
<! " 
ApplicationDbContext" 6
>6 7
(7 8
)8 9
;9 :
PasswordOptions 
pOpt  
=! "
new# &
PasswordOptions' 6
(6 7
)7 8
{ 
RequireDigit 
= 
false $
,$ %
RequiredLength 
=  
$num! "
," #
RequireLowercase    
=  ! "
false  # (
,  ( )"
RequireNonAlphanumeric!! &
=!!' (
false!!) .
,!!. /
RequireUppercase""  
=""! "
false""# (
}## 
;## 
services%% 
.%% 
AddIdentity%%  
<%%  !
ApplicationUser%%! 0
,%%0 1
IdentityRole%%2 >
>%%> ?
(%%? @
options%%@ G
=>%%H J
{&& 
options'' 
.'' 
Password''  
=''! "
pOpt''# '
;''' (
}(( 
)(( 
.)) $
AddEntityFrameworkStores)) )
<))) * 
ApplicationDbContext))* >
>))> ?
())? @
)))@ A
.** $
AddDefaultTokenProviders** )
(**) *
)*** +
.++ 
AddUserManager++ 
<++  
UserManager++  +
<+++ ,
ApplicationUser++, ;
>++; <
>++< =
(++= >
)++> ?
;,, 
services-- 
.-- 
AddAuthorization-- %
(--% &
options--& -
=>--. 0
{.. 
options// 
.// 
	AddPolicy// !
(//! "
$str//" /
,/// 0
policy//1 7
=>//8 :
{00 
policy11 
.11 
RequireClaim11 '
(11' (
$str11( 2
)112 3
;113 4
policy22 
.22 
RequireClaim22 '
(22' (
$str22( 3
)223 4
;224 5
}33 
)33 
;33 
options44 
.44 
	AddPolicy44 !
(44! "
$str44" .
,44. /
policy440 6
=>447 9
policy44: @
.44@ A
RequireClaim44A M
(44M N
$str44N [
)44[ \
)44\ ]
;44] ^
}55 
)55 
;66 
}77 	
	protected99 
void99 
ConfigJWTToken99 %
(99% &
IServiceCollection99& 8
services999 A
,99A B
IConfigurationRoot99C U
Configuration99V c
)99c d
{:: 	
services;; 
.;; 
AddAuthentication;; &
(;;& '
JwtBearerDefaults;;' 8
.;;8 9 
AuthenticationScheme;;9 M
);;M N
.<< 
AddJwtBearer<< !
(<<! "
options<<" )
=><<* ,
{== 
options>> 
.>>  %
TokenValidationParameters>>  9
=>>: ;
new??  %
TokenValidationParameters??! :
{@@ 
ValidateIssuerAA! /
=AA0 1
falseAA2 7
,AA7 8
ValidateAudienceBB! 1
=BB2 3
falseBB4 9
,BB9 :
ValidateLifetimeCC! 1
=CC2 3
trueCC4 8
,CC8 9$
ValidateIssuerSigningKeyDD! 9
=DD: ;
trueDD< @
,DD@ A
ValidIssuerFF! ,
=FF- .
SWCmsConstantsFF/ =
.FF= >
JwtSettingsFF> I
.FFI J
ISSUERFFJ P
,FFP Q
ValidAudienceGG! .
=GG/ 0
SWCmsConstantsGG1 ?
.GG? @
JwtSettingsGG@ K
.GGK L
AUDIENCEGGL T
,GGT U
IssuerSigningKeyHH! 1
=HH2 3
JwtSecurityKeyHH4 B
.HHB C
CreateHHC I
(HHI J
SWCmsConstantsHHJ X
.HHX Y
JwtSettingsHHY d
.HHd e

SECRET_KEYHHe o
)HHo p
}II 
;II 
optionsJJ 
.JJ  
EventsJJ  &
=JJ' (
newJJ) ,
JwtBearerEventsJJ- <
{KK "
OnAuthenticationFailedLL 2
=LL3 4
contextLL5 <
=>LL= ?
{MM 
ConsoleNN  '
.NN' (
	WriteLineNN( 1
(NN1 2
$strNN2 L
+NNM N
contextNNO V
.NNV W
	ExceptionNNW `
.NN` a
MessageNNa h
)NNh i
;NNi j
returnOO  &
TaskOO' +
.OO+ ,
CompletedTaskOO, 9
;OO9 :
}PP 
,PP 
OnTokenValidatedQQ ,
=QQ- .
contextQQ/ 6
=>QQ7 9
{RR 
ConsoleSS  '
.SS' (
	WriteLineSS( 1
(SS1 2
$strSS2 F
+SSG H
contextSSI P
.SSP Q
SecurityTokenSSQ ^
)SS^ _
;SS_ `
returnTT  &
TaskTT' +
.TT+ ,
CompletedTaskTT, 9
;TT9 :
}UU 
}VV 
;VV 
}WW 
)WW 
;WW 
}XX 	
	protectedZZ 
voidZZ 
ConfigCookieAuthZZ '
(ZZ' (
IServiceCollectionZZ( :
servicesZZ; C
,ZZC D
IConfigurationRootZZE W
ConfigurationZZX e
)ZZe f
{[[ 	
services\\ 
.\\ &
ConfigureApplicationCookie\\ /
(\\/ 0
options\\0 7
=>\\8 :
{]] 
options__ 
.__ 
Cookie__ 
.__ 
HttpOnly__ '
=__( )
true__* .
;__. /
options`` 
.`` 
Cookie`` 
.`` 

Expiration`` )
=``* +
TimeSpan``, 4
.``4 5
FromDays``5 =
(``= >
$num``> A
)``A B
;``B C
optionsaa 
.aa 
	LoginPathaa !
=aa" #
$straa$ '
+aa( )'
CONST_ROUTE_DEFAULT_CULTUREaa* E
+aaF G
$straaH \
;aa\ ]
optionsbb 
.bb 

LogoutPathbb "
=bb# $
$strbb% (
+bb) *'
CONST_ROUTE_DEFAULT_CULTUREbb+ F
+bbG H
$strbbI ^
;bb^ _
optionscc 
.cc 
AccessDeniedPathcc (
=cc) *
$strcc+ .
;cc. /
optionsdd 
.dd 
SlidingExpirationdd )
=dd* +
truedd, 0
;dd0 1
}ee 
)ee 
;ee 
servicesgg 
.gg 
AddAuthenticationgg &
(gg& '(
CookieAuthenticationDefaultsgg' C
.ggC D 
AuthenticationSchemeggD X
)ggX Y
.hh 
	AddCookiehh 
(hh 
optionsii 
=>ii 
{jj 
optionsll 
.ll 
Cookiell "
.ll" #
HttpOnlyll# +
=ll, -
truell. 2
;ll2 3
optionsmm 
.mm 
Cookiemm "
.mm" #

Expirationmm# -
=mm. /
TimeSpanmm0 8
.mm8 9
FromDaysmm9 A
(mmA B
$nummmB E
)mmE F
;mmF G
optionsnn 
.nn 
	LoginPathnn %
=nn& '
$strnn( +
+nn, -'
CONST_ROUTE_DEFAULT_CULTUREnn. I
+nnJ K
$strnnL `
;nn` a
optionsoo 
.oo 

LogoutPathoo &
=oo' (
$stroo) ,
+oo- .'
CONST_ROUTE_DEFAULT_CULTUREoo/ J
+ooK L
$strooM b
;oob c
optionspp 
.pp 
AccessDeniedPathpp ,
=pp- .
$strpp/ 2
;pp2 3
optionsqq 
.qq 
SlidingExpirationqq -
=qq. /
trueqq0 4
;qq4 5
}rr 
)rr 
;rr 
}ss 	
	protecteduu 
staticuu 
classuu 
JwtSecurityKeyuu -
{vv 	
publicww 
staticww  
SymmetricSecurityKeyww .
Createww/ 5
(ww5 6
stringww6 <
secretww= C
)wwC D
{xx 
returnyy 
newyy  
SymmetricSecurityKeyyy /
(yy/ 0
Encodingyy0 8
.yy8 9
ASCIIyy9 >
.yy> ?
GetBytesyy? G
(yyG H
secretyyH N
)yyN O
)yyO P
;yyP Q
}zz 
}{{ 	
}|| 
}}} ˇÏ
rD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\Apis\ApiModuleController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
.3 4
Apis4 8
{ 
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str (
)( )
]) *
public 

class 
ApiModuleController $
:% &
BaseController' 5
<5 6
ApiModuleController6 I
>I J
{ 
public 
ApiModuleController "
(" #
IHostingEnvironment# 6
env7 :
,: ;
IStringLocalizer< L
<L M
PortalControllerM ]
>] ^
	localizer_ h
)h i
:j k
basel p
(p q
envq t
)t u
{ 	
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
[   	
Route  	 
(   
$str   
)   
]   
[!! 	
Route!!	 
(!! 
$str!! ;
)!!; <
]!!< =
["" 	
Route""	 
("" 
$str"" A
)""A B
]""B C
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
Index##) .
(##. /
int##/ 2
pageSize##3 ;
=##< =
$num##> @
,##@ A
int##B E
	pageIndex##F O
=##P Q
$num##R S
,##S T
string##U [
keyword##\ c
=##d e
null##f j
)##j k
{$$ 	
var%% 
pagingPages%% 
=%% 
await%% #
BEModuleViewModel%%$ 5
.%%5 6

Repository%%6 @
.%%@ A
GetModelListByAsync%%A T
(%%T U
m&& 
=>&& 
m&& 
.&& 
Specificulture&& %
==&&& (
CurrentLanguage&&) 8
&&'' 
('' 
string'' 
.'' 
IsNullOrEmpty'' ,
('', -
keyword''- 4
)''4 5
||''6 8
m''9 :
.'': ;
Name''; ?
.''? @
Contains''@ H
(''H I
keyword''I P
)''P Q
)''Q R
,''R S
$str(( 
,(( 
OrderByDirection(( (
.((( )
	Ascending(() 2
,((2 3
pageSize)) 
,)) 
	pageIndex)) #
)))# $
;))$ %
return++ 
View++ 
(++ 
pagingPages++ #
)++# $
;++$ %
},, 	
[// 	
HttpGet//	 
]// 
[00 	
Route00	 
(00 
$str00 
)00 
]00 
public11 
IActionResult11 
Create11 #
(11# $
)11$ %
{22 	
var33 
Module33 
=33 
new33 
BEModuleViewModel33 .
(33. /
)33/ 0
{44 
Specificulture55 
=55  
CurrentLanguage55! 0
,550 1
Columns66 
=66 
new66 
System66 $
.66$ %
Collections66% 0
.660 1
Generic661 8
.668 9
List669 =
<66= >
Swastika66> F
.66F G
Cms66G J
.66J K
Lib66K N
.66N O

ViewModels66O Y
.66Y Z 
ModuleFieldViewModel66Z n
>66n o
(66o p
)66p q
}77 
;77 
return88 
View88 
(88 
Module88 
)88 
;88  
}99 	
[>> 	
Route>>	 
(>> 
$str>> 
)>> 
]>> 
[?? 	
HttpPost??	 
]?? 
[@@ 	$
ValidateAntiForgeryToken@@	 !
]@@! "
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
CreateAA) /
(AA/ 0
BEModuleViewModelAA0 A
ModuleAAB H
)AAH I
{BB 	
ifCC 
(CC 

ModelStateCC 
.CC 
IsValidCC "
)CC" #
{DD 
varEE 
resultEE 
=EE 
awaitEE "
ModuleEE# )
.EE) *
SaveModelAsyncEE* 8
(EE8 9
)EE9 :
;EE: ;
ifFF 
(FF 
resultFF 
.FF 
	IsSucceedFF $
)FF$ %
{GG 
returnHH 
RedirectToActionHH +
(HH+ ,
$strHH, 3
)HH3 4
;HH4 5
}II 
elseJJ 
{KK 
throwLL 
newLL 
	ExceptionLL '
(LL' (
resultLL( .
.LL. /
	ExceptionLL/ 8
.LL8 9

StackTraceLL9 C
)LLC D
;LLD E
}MM 
}NN 
returnOO 
ViewOO 
(OO 
ModuleOO 
)OO 
;OO  
}PP 	
[SS 	
HttpGetSS	 
]SS 
[TT 	
RouteTT	 
(TT 
$strTT 
)TT 
]TT 
publicUU 
asyncUU 
TaskUU 
<UU 
IActionResultUU '
>UU' (
EditUU) -
(UU- .
intUU. 1
idUU2 4
)UU4 5
{VV 	
varWW 
ModuleWW 
=WW 
awaitWW 
BEModuleViewModelWW 0
.WW0 1

RepositoryWW1 ;
.WW; <
GetSingleModelAsyncWW< O
(WWO P
mWWP Q
=>WWR T
mWWU V
.WWV W
IdWWW Y
==WWZ \
idWW] _
&&WW` b
mWWc d
.WWd e
SpecificultureWWe s
==WWt v
CurrentLanguage	WWw Ü
)
WWÜ á
;
WWá à
ifXX 
(XX 
ModuleXX 
==XX 
nullXX 
)XX 
{YY 
returnZZ 
RedirectToActionZZ '
(ZZ' (
$strZZ( /
)ZZ/ 0
;ZZ0 1
}[[ 
return\\ 
View\\ 
(\\ 
Module\\ 
)\\ 
;\\  
}]] 	
[bb 	
Routebb	 
(bb 
$strbb 
)bb 
]bb 
[cc 	
HttpPostcc	 
]cc 
[dd 	$
ValidateAntiForgeryTokendd	 !
]dd! "
publicee 
asyncee 
Taskee 
<ee 
IActionResultee '
>ee' (
Editee) -
(ee- .
intee. 1
idee2 4
,ee4 5
BEModuleViewModelee6 G
ModuleeeH N
)eeN O
{ff 	
ifgg 
(gg 
idgg 
!=gg 
Modulegg 
.gg 
Idgg 
)gg  
{hh 
returnii 
NotFoundii 
(ii  
)ii  !
;ii! "
}jj 
ifll 
(ll 

ModelStatell 
.ll 
IsValidll "
)ll" #
{mm 
trynn 
{oo 
varpp 
resultpp 
=pp  
awaitpp! &
Modulepp' -
.pp- .
SaveModelAsyncpp. <
(pp< =
)pp= >
;pp> ?
ifqq 
(qq 
resultqq 
.qq 
	IsSucceedqq (
)qq( )
{rr 
returnss 
RedirectToActionss /
(ss/ 0
$strss0 9
,ss9 :
newss; >
{ss? @
idssA C
=ssD E
ModulessF L
.ssL M
IdssM O
}ssP Q
)ssQ R
;ssR S
}tt 
elseuu 
{vv 

ModelStateww "
.ww" #
AddModelErrorww# 0
(ww0 1
stringww1 7
.ww7 8
Emptyww8 =
,ww= >
resultww? E
.wwE F
	ExceptionwwF O
.wwO P
MessagewwP W
)wwW X
;wwX Y
returnxx 
Viewxx #
(xx# $
Modulexx$ *
)xx* +
;xx+ ,
}yy 
}zz 
catch{{ 
({{ (
DbUpdateConcurrencyException{{ 3
){{3 4
{|| 
if}} 
(}} 
!}} 
BEModuleViewModel}} *
.}}* +

Repository}}+ 5
.}}5 6
CheckIsExists}}6 C
(}}C D
m}}D E
=>}}F H
m}}I J
.}}J K
Id}}K M
==}}N P
Module}}Q W
.}}W X
Id}}X Z
)}}Z [
)}}[ \
{~~ 
return 
NotFound '
(' (
)( )
;) *
}
ÄÄ 
else
ÅÅ 
{
ÇÇ 
throw
ÉÉ 
;
ÉÉ 
}
ÑÑ 
}
ÖÖ 
}
ÜÜ 
ViewData
áá 
[
áá 
$str
áá 
]
áá 
=
áá  
$str
áá! '
;
áá' (
ViewData
àà 
[
àà 
$str
àà !
]
àà! "
=
àà# $
$str
àà% ,
;
àà, -
return
ââ 
View
ââ 
(
ââ 
Module
ââ 
)
ââ 
;
ââ  
}
ää 	
[
åå 	
HttpGet
åå	 
]
åå 
[
çç 	
Route
çç	 
(
çç 
$str
çç 
)
çç 
]
çç 
public
éé 
async
éé 
Task
éé 
<
éé 
IActionResult
éé '
>
éé' (
Delete
éé) /
(
éé/ 0
int
éé0 3
id
éé4 6
)
éé6 7
{
èè 	
var
êê 
Module
êê 
=
êê 
await
êê 
BEModuleViewModel
êê 0
.
êê0 1

Repository
êê1 ;
.
êê; <
RemoveModelAsync
êê< L
(
êêL M
m
êêM N
=>
êêO Q
m
êêR S
.
êêS T
Id
êêT V
==
êêW Y
id
êêZ \
&&
êê] _
m
êê` a
.
êêa b
Specificulture
êêb p
==
êêq s
CurrentLanguageêêt É
)êêÉ Ñ
;êêÑ Ö
return
ëë 
RedirectToAction
ëë #
(
ëë# $
$str
ëë$ +
)
ëë+ ,
;
ëë, -
}
íí 	
[
ññ 	
HttpGet
ññ	 
]
ññ 
[
óó 	
Route
óó	 
(
óó 
$str
óó -
)
óó- .
]
óó. /
public
òò 
async
òò 
Task
òò 
<
òò %
InfoModuleDataViewModel
òò 1
>
òò1 2
AjaxAddModuleData
òò3 D
(
òòD E
int
òòE H
moduleId
òòI Q
)
òòQ R
{
ôô 	
string
öö 
_lang
öö 
=
öö 
	RouteData
öö $
.
öö$ %
Values
öö% +
[
öö+ ,
$str
öö, 5
]
öö5 6
.
öö6 7
ToString
öö7 ?
(
öö? @
)
öö@ A
;
ööA B
var
õõ 
module
õõ 
=
õõ 
await
õõ 
BEModuleViewModel
õõ 0
.
õõ0 1

Repository
õõ1 ;
.
õõ; <!
GetSingleModelAsync
õõ< O
(
õõO P
m
úú 
=>
úú 
m
úú 
.
úú 
Id
úú 
==
úú 
moduleId
úú %
&&
úú& (
m
úú) *
.
úú* +
Specificulture
úú+ 9
==
úú: <
_lang
úú= B
)
úúB C
;
úúC D
if
ùù 
(
ùù 
module
ùù 
.
ùù 
	IsSucceed
ùù  
)
ùù  !
{
ûû 
var
üü 

ModuleData
üü 
=
üü  
new
üü! $%
InfoModuleDataViewModel
üü% <
(
üü< =
)
üü= >
{
†† 
Id
°° 
=
°° 
Guid
°° 
.
°° 
NewGuid
°° %
(
°°% &
)
°°& '
.
°°' (
ToString
°°( 0
(
°°0 1
$str
°°1 4
)
°°4 5
,
°°5 6
ModuleId
¢¢ 
=
¢¢ 
moduleId
¢¢ '
,
¢¢' (
Specificulture
££ "
=
££# $
_lang
££% *
,
££* +
Fields
•• 
=
•• 
module
•• #
.
••# $
Data
••$ (
?
••( )
.
••) *
Fields
••* 0
}
¶¶ 
;
¶¶ 
return
ßß 

ModuleData
ßß !
;
ßß! "
}
®® 
else
©© 
{
™™ 
return
´´ 
null
´´ 
;
´´ 
}
¨¨ 
}
≠≠ 	
[
≤≤ 	
Route
≤≤	 
(
≤≤ 
$str
≤≤ #
)
≤≤# $
]
≤≤$ %
[
≥≥ 	
HttpPost
≥≥	 
]
≥≥ 
[
¥¥ 	&
ValidateAntiForgeryToken
¥¥	 !
]
¥¥! "
public
µµ 
async
µµ 
Task
µµ 
<
µµ 
IActionResult
µµ '
>
µµ' ( 
AjaxSaveModuleData
µµ) ;
(
µµ; <%
InfoModuleDataViewModel
µµ< S

ModuleData
µµT ^
)
µµ^ _
{
∂∂ 	
if
∑∑ 
(
∑∑ 

ModelState
∑∑ 
.
∑∑ 
IsValid
∑∑ "
)
∑∑" #
{
∏∏ 

ModuleData
ππ 
.
ππ 
CreatedDateTime
ππ *
=
ππ+ ,
DateTime
ππ- 5
.
ππ5 6
UtcNow
ππ6 <
;
ππ< =
var
∫∫ 
result
∫∫ 
=
∫∫ 
await
∫∫ "

ModuleData
∫∫# -
.
∫∫- .
SaveModelAsync
∫∫. <
(
∫∫< =
)
∫∫= >
;
∫∫> ?
if
ªª 
(
ªª 
result
ªª 
.
ªª 
	IsSucceed
ªª $
)
ªª$ %
{
ºº 
return
ΩΩ 
PartialView
ΩΩ &
(
ΩΩ& '
$str
ΩΩ' ;
,
ΩΩ; <
result
ΩΩ= C
.
ΩΩC D
Data
ΩΩD H
)
ΩΩH I
;
ΩΩI J
}
ææ 
else
øø 
{
¿¿ 
throw
¡¡ 
new
¡¡ 
	Exception
¡¡ '
(
¡¡' (
result
¡¡( .
.
¡¡. /
	Exception
¡¡/ 8
.
¡¡8 9

StackTrace
¡¡9 C
)
¡¡C D
;
¡¡D E
}
¬¬ 
}
√√ 
return
ƒƒ 
View
ƒƒ 
(
ƒƒ 

ModuleData
ƒƒ "
)
ƒƒ" #
;
ƒƒ# $
}
≈≈ 	
[
«« 	
Route
««	 
(
«« 
$str
«« J
)
««J K
]
««K L
[
»» 	
HttpGet
»»	 
]
»» 
public
…… 
async
…… 
Task
…… 
<
…… 
bool
…… 
>
…… !
AjaxAtiveModuleData
……  3
(
……3 4
string
……4 :
	articleId
……; D
,
……D E
string
……F L
dataId
……M S
,
……S T
bool
……U Y
	isActived
……Z c
)
……c d
{
   	
var
ÀÀ 
getData
ÀÀ 
=
ÀÀ 
await
ÀÀ %
InfoModuleDataViewModel
ÀÀ  7
.
ÀÀ7 8

Repository
ÀÀ8 B
.
ÀÀB C!
GetSingleModelAsync
ÀÀC V
(
ÀÀV W
d
ÃÃ 
=>
ÃÃ 
d
ÃÃ 
.
ÃÃ 
Id
ÃÃ 
==
ÃÃ 
dataId
ÃÃ #
&&
ÃÃ$ &
d
ÃÃ' (
.
ÃÃ( )
Specificulture
ÃÃ) 7
==
ÃÃ8 :
CurrentLanguage
ÃÃ; J
)
ÃÃJ K
;
ÃÃK L
if
ÕÕ 
(
ÕÕ 
getData
ÕÕ 
.
ÕÕ 
	IsSucceed
ÕÕ !
)
ÕÕ! "
{
ŒŒ 
var
œœ 
data
œœ 
=
œœ 
getData
œœ "
.
œœ" #
Data
œœ# '
;
œœ' (
data
–– 
.
–– 
	ArticleId
–– 
=
––  
	isActived
––! *
?
––+ ,
	articleId
––- 6
:
––7 8
null
––9 =
;
––= >
var
—— 
result
—— 
=
—— 
await
—— "%
InfoModuleDataViewModel
——# :
.
——: ;

Repository
——; E
.
——E F
SaveModelAsync
——F T
(
——T U
data
——U Y
)
——Y Z
;
——Z [
return
““ 
result
““ 
.
““ 
	IsSucceed
““ '
;
““' (
}
”” 
else
‘‘ 
{
’’ 
return
÷÷ 
false
÷÷ 
;
÷÷ 
}
◊◊ 
}
ÿÿ 	
[
⁄⁄ 	
HttpGet
⁄⁄	 
]
⁄⁄ 
[
€€ 	
Route
€€	 
(
€€ 
$str
€€ ,
)
€€, -
]
€€- .
public
‹‹ 
async
‹‹ 
Task
‹‹ 
<
‹‹ 
IActionResult
‹‹ '
>
‹‹' ( 
AjaxEditModuleData
‹‹) ;
(
‹‹; <
string
‹‹< B
dataId
‹‹C I
)
‹‹I J
{
›› 	
var
ﬁﬁ 
getData
ﬁﬁ 
=
ﬁﬁ 
await
ﬁﬁ %
InfoModuleDataViewModel
ﬁﬁ  7
.
ﬁﬁ7 8

Repository
ﬁﬁ8 B
.
ﬁﬁB C!
GetSingleModelAsync
ﬁﬁC V
(
ﬁﬁV W
d
ﬂﬂ 
=>
ﬂﬂ 
d
ﬂﬂ 
.
ﬂﬂ 
Id
ﬂﬂ 
==
ﬂﬂ 
dataId
ﬂﬂ #
&&
ﬂﬂ$ &
d
ﬂﬂ' (
.
ﬂﬂ( )
Specificulture
ﬂﬂ) 7
==
ﬂﬂ8 :
CurrentLanguage
ﬂﬂ; J
)
ﬂﬂJ K
;
ﬂﬂK L
if
‡‡ 
(
‡‡ 
getData
‡‡ 
.
‡‡ 
	IsSucceed
‡‡ !
)
‡‡! "
{
·· 
var
‚‚ 
data
‚‚ 
=
‚‚ 
getData
‚‚ "
.
‚‚" #
Data
‚‚# '
;
‚‚' (
return
„„ 
PartialView
„„ "
(
„„" #
$str
„„# 0
,
„„0 1
data
„„2 6
)
„„6 7
;
„„7 8
}
‰‰ 
else
ÂÂ 
{
ÊÊ 
return
ÁÁ 
NotFound
ÁÁ 
(
ÁÁ  
)
ÁÁ  !
;
ÁÁ! "
}
ËË 
}
ÈÈ 	
[
 	
HttpGet
	 
]
 
[
ÒÒ 	
Route
ÒÒ	 
(
ÒÒ 
$str
ÒÒ 
)
ÒÒ 
]
ÒÒ 
[
ÚÚ 	
Route
ÚÚ	 
(
ÚÚ 
$str
ÚÚ H
)
ÚÚH I
]
ÚÚI J
public
ÛÛ 
async
ÛÛ 
Task
ÛÛ 
<
ÛÛ 
IActionResult
ÛÛ '
>
ÛÛ' (
Details
ÛÛ) 0
(
ÛÛ0 1
int
ÛÛ1 4
id
ÛÛ5 7
,
ÛÛ7 8
int
ÛÛ9 <
pageSize
ÛÛ= E
=
ÛÛF G
$num
ÛÛH J
,
ÛÛJ K
int
ÛÛL O
	pageIndex
ÛÛP Y
=
ÛÛZ [
$num
ÛÛ\ ]
,
ÛÛ] ^
string
ÛÛ_ e
keyword
ÛÛf m
=
ÛÛn o
null
ÛÛp t
)
ÛÛt u
{
ÙÙ 	
var
ıı 
	getModule
ıı 
=
ıı 
await
ıı !
BEModuleViewModel
ıı" 3
.
ıı3 4

Repository
ıı4 >
.
ıı> ?!
GetSingleModelAsync
ıı? R
(
ııR S
m
ˆˆ 
=>
ˆˆ 
m
ˆˆ 
.
ˆˆ 
Specificulture
ˆˆ %
==
ˆˆ& (
CurrentLanguage
ˆˆ) 8
&&
ˆˆ9 ;
m
ˆˆ< =
.
ˆˆ= >
Id
ˆˆ> @
==
ˆˆA C
id
ˆˆD F
)
ˆˆF G
;
ˆˆG H
if
˜˜ 
(
˜˜ 
	getModule
˜˜ 
.
˜˜ 
	IsSucceed
˜˜ #
)
˜˜# $
{
¯¯ 
return
˘˘ 
View
˘˘ 
(
˘˘ 
	getModule
˘˘ %
.
˘˘% &
Data
˘˘& *
)
˘˘* +
;
˘˘+ ,
}
˙˙ 
else
˚˚ 
{
¸¸ 
return
˝˝ 
RedirectToAction
˝˝ '
(
˝˝' (
$str
˝˝( /
)
˝˝/ 0
;
˝˝0 1
}
˛˛ 
}
ˇˇ 	
[
ÇÇ 	
HttpGet
ÇÇ	 
]
ÇÇ 
[
ÉÉ 	
Route
ÉÉ	 
(
ÉÉ 
$str
ÉÉ '
)
ÉÉ' (
]
ÉÉ( )
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (
AddModuleData
ÑÑ) 6
(
ÑÑ6 7
int
ÑÑ7 :
id
ÑÑ; =
)
ÑÑ= >
{
ÖÖ 	
var
ÜÜ 
	getModule
ÜÜ 
=
ÜÜ 
await
ÜÜ !!
InfoModuleViewModel
ÜÜ" 5
.
ÜÜ5 6

Repository
ÜÜ6 @
.
ÜÜ@ A!
GetSingleModelAsync
ÜÜA T
(
ÜÜT U
m
áá 
=>
áá 
m
áá 
.
áá 
Id
áá 
==
áá 
id
áá 
&&
áá  "
m
áá# $
.
áá$ %
Specificulture
áá% 3
==
áá4 6
CurrentLanguage
áá7 F
)
ááF G
;
ááG H
if
àà 
(
àà 
	getModule
àà 
.
àà 
	IsSucceed
àà #
)
àà# $
{
ââ 
var
ää 
module
ää 
=
ää 
	getModule
ää &
.
ää& '
Data
ää' +
;
ää+ ,
var
ãã 

ModuleData
ãã 
=
ãã  
new
ãã! $%
InfoModuleDataViewModel
ãã% <
(
ãã< =
new
åå 
SiocModuleData
åå &
(
åå& '
)
åå' (
{
çç 
Id
éé 
=
éé 
Guid
éé !
.
éé! "
NewGuid
éé" )
(
éé) *
)
éé* +
.
éé+ ,
ToString
éé, 4
(
éé4 5
$str
éé5 8
)
éé8 9
,
éé9 :
ModuleId
èè  
=
èè! "
id
èè# %
,
èè% &
Specificulture
êê &
=
êê' (
CurrentLanguage
êê) 8
,
êê8 9
Fields
ëë 
=
ëë  
module
ëë! '
.
ëë' (
Fields
ëë( .
}
íí 
)
íí 
;
íí 
return
ìì 
View
ìì 
(
ìì 

ModuleData
ìì &
)
ìì& '
;
ìì' (
}
îî 
else
ïï 
{
ññ 
return
óó 
NotFound
óó 
(
óó  
)
óó  !
;
óó! "
}
òò 
}
ôô 	
[
ûû 	
Route
ûû	 
(
ûû 
$str
ûû '
)
ûû' (
]
ûû( )
[
üü 	
HttpPost
üü	 
]
üü 
[
†† 	&
ValidateAntiForgeryToken
††	 !
]
††! "
public
°° 
async
°° 
Task
°° 
<
°° 
IActionResult
°° '
>
°°' (
AddModuleData
°°) 6
(
°°6 7%
InfoModuleDataViewModel
°°7 N

ModuleData
°°O Y
)
°°Y Z
{
¢¢ 	
if
££ 
(
££ 

ModelState
££ 
.
££ 
IsValid
££ "
)
££" #
{
§§ 

ModuleData
•• 
.
•• 
CreatedDateTime
•• *
=
••+ ,
DateTime
••- 5
.
••5 6
UtcNow
••6 <
;
••< =
var
¶¶ 
result
¶¶ 
=
¶¶ 
await
¶¶ "

ModuleData
¶¶# -
.
¶¶- .
SaveModelAsync
¶¶. <
(
¶¶< =
)
¶¶= >
;
¶¶> ?
if
ßß 
(
ßß 
result
ßß 
.
ßß 
	IsSucceed
ßß $
)
ßß$ %
{
®® 
return
©© 
RedirectToAction
©© +
(
©©+ ,
$str
©©, 5
,
©©5 6
new
©©7 :"
RouteValueDictionary
©©; O
(
©©O P
new
©©P S
{
©©T U
id
©©V X
=
©©Y Z

ModuleData
©©[ e
.
©©e f
ModuleId
©©f n
}
©©o p
)
©©p q
)
©©q r
;
©©r s
}
™™ 
else
´´ 
{
¨¨ 
throw
≠≠ 
new
≠≠ 
	Exception
≠≠ '
(
≠≠' (
result
≠≠( .
.
≠≠. /
	Exception
≠≠/ 8
.
≠≠8 9

StackTrace
≠≠9 C
)
≠≠C D
;
≠≠D E
}
ÆÆ 
}
ØØ 
return
∞∞ 
View
∞∞ 
(
∞∞ 

ModuleData
∞∞ "
)
∞∞" #
;
∞∞# $
}
±± 	
[
¥¥ 	
HttpGet
¥¥	 
]
¥¥ 
[
µµ 	
Route
µµ	 
(
µµ 
$str
µµ -
)
µµ- .
]
µµ. /
public
∂∂ 
async
∂∂ 
Task
∂∂ 
<
∂∂ 
IActionResult
∂∂ '
>
∂∂' (
EditModuleData
∂∂) 7
(
∂∂7 8
int
∂∂8 ;
id
∂∂< >
,
∂∂> ?
string
∂∂@ F
dataId
∂∂G M
)
∂∂M N
{
∑∑ 	
var
∏∏ 
getModuleData
∏∏ 
=
∏∏ 
await
∏∏  %%
InfoModuleDataViewModel
∏∏& =
.
∏∏= >

Repository
∏∏> H
.
∏∏H I!
GetSingleModelAsync
∏∏I \
(
∏∏\ ]
m
ππ 
=>
ππ 
m
ππ 
.
ππ 
Id
ππ 
==
ππ 
dataId
ππ #
)
ππ# $
;
ππ$ %
if
∫∫ 
(
∫∫ 
getModuleData
∫∫ 
.
∫∫ 
	IsSucceed
∫∫ '
)
∫∫' (
{
ªª 
return
ºº 
View
ºº 
(
ºº 
getModuleData
ºº )
.
ºº) *
Data
ºº* .
)
ºº. /
;
ºº/ 0
}
ΩΩ 
return
ææ 
RedirectToAction
ææ #
(
ææ# $
$str
ææ$ +
)
ææ+ ,
;
ææ, -
}
øø 	
[
ƒƒ 	
Route
ƒƒ	 
(
ƒƒ 
$str
ƒƒ -
)
ƒƒ- .
]
ƒƒ. /
[
≈≈ 	
HttpPost
≈≈	 
]
≈≈ 
[
∆∆ 	&
ValidateAntiForgeryToken
∆∆	 !
]
∆∆! "
public
«« 
async
«« 
Task
«« 
<
«« 
IActionResult
«« '
>
««' (
EditModuleData
««) 7
(
««7 8%
InfoModuleDataViewModel
««8 O

ModuleData
««P Z
)
««Z [
{
»» 	
if
…… 
(
…… 

ModelState
…… 
.
…… 
IsValid
…… "
)
……" #
{
   
try
ÀÀ 
{
ÃÃ 
var
ÕÕ 
result
ÕÕ 
=
ÕÕ  
await
ÕÕ! &

ModuleData
ÕÕ' 1
.
ÕÕ1 2
SaveModelAsync
ÕÕ2 @
(
ÕÕ@ A
)
ÕÕA B
;
ÕÕB C
if
ŒŒ 
(
ŒŒ 
result
ŒŒ 
.
ŒŒ 
	IsSucceed
ŒŒ (
)
ŒŒ( )
{
œœ 
return
–– 
RedirectToAction
–– /
(
––/ 0
$str
––0 9
,
––9 :
new
––; >"
RouteValueDictionary
––? S
(
––S T
new
—— 
{
——  !
id
——" $
=
——% &

ModuleData
——' 1
.
——1 2
ModuleId
——2 :
}
——; <
)
——< =
)
——= >
;
——> ?
}
““ 
else
”” 
{
‘‘ 

ModelState
’’ "
.
’’" #
AddModelError
’’# 0
(
’’0 1
string
’’1 7
.
’’7 8
Empty
’’8 =
,
’’= >
result
’’? E
.
’’E F
	Exception
’’F O
.
’’O P
Message
’’P W
)
’’W X
;
’’X Y
return
÷÷ 
View
÷÷ #
(
÷÷# $

ModuleData
÷÷$ .
)
÷÷. /
;
÷÷/ 0
}
◊◊ 
}
ÿÿ 
catch
ŸŸ 
(
ŸŸ *
DbUpdateConcurrencyException
ŸŸ 3
)
ŸŸ3 4
{
⁄⁄ 
if
€€ 
(
€€ 
!
€€ %
InfoModuleDataViewModel
€€ 0
.
€€0 1

Repository
€€1 ;
.
€€; <
CheckIsExists
€€< I
(
€€I J
m
€€J K
=>
€€L N
m
€€O P
.
€€P Q
Id
€€Q S
==
€€T V

ModuleData
€€W a
.
€€a b
Id
€€b d
)
€€d e
)
€€e f
{
‹‹ 
return
›› 
NotFound
›› '
(
››' (
)
››( )
;
››) *
}
ﬁﬁ 
else
ﬂﬂ 
{
‡‡ 
throw
·· 
;
·· 
}
‚‚ 
}
„„ 
}
ÂÂ 
return
ÊÊ 
View
ÊÊ 
(
ÊÊ 

ModuleData
ÊÊ "
)
ÊÊ" #
;
ÊÊ# $
}
ÁÁ 	
[
ÈÈ 	
HttpGet
ÈÈ	 
]
ÈÈ 
[
ÍÍ 	
Route
ÍÍ	 
(
ÍÍ 
$str
ÍÍ &
)
ÍÍ& '
]
ÍÍ' (
public
ÎÎ 
async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
IActionResult
ÎÎ '
>
ÎÎ' (
DeleteModuleData
ÎÎ) 9
(
ÎÎ9 :
string
ÎÎ: @
id
ÎÎA C
)
ÎÎC D
{
ÏÏ 	
var
ÌÌ 
getData
ÌÌ 
=
ÌÌ 
await
ÌÌ %
InfoModuleDataViewModel
ÌÌ  7
.
ÌÌ7 8

Repository
ÌÌ8 B
.
ÌÌB C!
GetSingleModelAsync
ÌÌC V
(
ÌÌV W
m
ÓÓ 
=>
ÓÓ 
m
ÓÓ 
.
ÓÓ 
Id
ÓÓ 
==
ÓÓ 
id
ÓÓ 
)
ÓÓ  
;
ÓÓ  !
if
ÔÔ 
(
ÔÔ 
getData
ÔÔ 
.
ÔÔ 
	IsSucceed
ÔÔ !
)
ÔÔ! "
{
 
await
ÒÒ %
InfoModuleDataViewModel
ÒÒ -
.
ÒÒ- .

Repository
ÒÒ. 8
.
ÒÒ8 9
RemoveModelAsync
ÒÒ9 I
(
ÒÒI J
m
ÒÒJ K
=>
ÒÒL N
m
ÒÒO P
.
ÒÒP Q
Id
ÒÒQ S
==
ÒÒT V
id
ÒÒW Y
)
ÒÒY Z
;
ÒÒZ [
}
ÚÚ 
return
ÙÙ 
RedirectToAction
ÙÙ #
(
ÙÙ# $
$str
ÙÙ$ -
,
ÙÙ- .
new
ÙÙ/ 2"
RouteValueDictionary
ÙÙ3 G
(
ÙÙG H
new
ÙÙH K
{
ÙÙL M
id
ÙÙN P
=
ÙÙQ R
id
ÙÙS U
}
ÙÙV W
)
ÙÙW X
)
ÙÙX Y
;
ÙÙY Z
}
ıı 	
}
¯¯ 
}˘˘ ﬂ∂
lD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\ArticlesController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str &
)& '
]' (
public 

class 
ArticlesController #
:$ %
BaseController& 4
<4 5
ArticlesController5 G
>G H
{ 
public 
ArticlesController !
(! "
IHostingEnvironment" 5
hostingEnvironment6 H
) 
: 
base 
( 
hostingEnvironment %
)% &
{ 	
}   	
[## 	
HttpPost##	 
,## 
HttpGet## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
[%% 	
Route%%	 
(%% 
$str%% 
)%% 
]%% 
[&& 	
Route&&	 
(&& 
$str&& ;
)&&; <
]&&< =
['' 	
Route''	 
('' 
$str'' 1
)''1 2
]''2 3
[(( 	
Route((	 
((( 
$str(( A
)((A B
]((B C
[)) 	
Route))	 
()) 
$str)) 7
)))7 8
]))8 9
public** 
IActionResult** 
Index** "
(**" #
int**# &
pageSize**' /
=**0 1
$num**2 4
,**4 5
int**6 9
	pageIndex**: C
=**D E
$num**F G
,**G H
string**I O
keyword**P W
=**X Y
null**Z ^
)**^ _
{++ 	
return44 
View44 
(44 
)44 
;44 
}55 	
[88 	
HttpGet88	 
]88 
[99 	
Route99	 
(99 
$str99 
)99 
]99 
[:: 	
Route::	 
(:: 
$str:: A
)::A B
]::B C
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
Draft;;) .
(;;. /
int;;/ 2
pageSize;;3 ;
=;;< =
$num;;> @
,;;@ A
int;;B E
	pageIndex;;F O
=;;P Q
$num;;R S
,;;S T
string;;U [
keyword;;\ c
=;;d e
null;;f j
);;j k
{<< 	
RepositoryResponse== 
<== 
PaginationModel== .
<==. / 
InfoArticleViewModel==/ C
>==C D
>==D E
repositoryResponse==F X
===Y Z
await==[ ` 
InfoArticleViewModel==a u
.==u v

Repository	==v Ä
.
==Ä Å!
GetModelListByAsync
==Å î
(
==î ï
article>> 
=>>> 
article>> "
.>>" #
Specificulture>># 1
==>>2 4
CurrentLanguage>>5 D
&&?? 
(?? 
string?? 
.?? 
IsNullOrEmpty?? ,
(??, -
keyword??- 4
)??4 5
||??6 8
article??9 @
.??@ A
Title??A F
.??F G
Contains??G O
(??O P
keyword??P W
)??W X
)??X Y
&&@@ 
article@@ 
.@@ 
Status@@ %
==@@& (
(@@) *
int@@* -
)@@- .
SWStatus@@. 6
.@@6 7
Deleted@@7 >
,@@> ?
$strAA !
,AA! "
OrderByDirectionAA# 3
.AA3 4

DescendingAA4 >
,AA> ?
pageSizeBB 
,BB 
	pageIndexBB #
)BB# $
.BB$ %
ConfigureAwaitBB% 3
(BB3 4
falseBB4 9
)BB9 :
;BB: ;
returnDD 
ViewDD 
(DD 
repositoryResponseDD *
.DD* +
DataDD+ /
)DD/ 0
;DD0 1
}EE 	
[HH 	
HttpGetHH	 
]HH 
[II 	
RouteII	 
(II 
$strII 
)II 
]II 
[JJ 	
RouteJJ	 
(JJ 
$strJJ (
)JJ( )
]JJ) *
publicKK 
IActionResultKK 
CreateKK #
(KK# $
intKK$ '
?KK' (

categoryIdKK) 3
=KK4 5
nullKK6 :
)KK: ;
{LL 	
BEArticleViewModelMM 
bEArticleViewModelMM 1
=MM2 3
newMM4 7
BEArticleViewModelMM8 J
(MMJ K
newMMK N
SiocArticleMMO Z
(MMZ [
)MM[ \
{NN 
SpecificultureOO 
=OO  
CurrentLanguageOO! 0
,OO0 1
	CreatedByPP 
=PP 
UserPP  
.PP  !
IdentityPP! )
.PP) *
NamePP* .
,PP. /
CreatedDateTimeQQ 
=QQ  !
DateTimeQQ" *
.QQ* +
UtcNowQQ+ 1
}RR 
)RR 
{SS 
StatusTT 
=TT 
SWStatusTT !
.TT! "
	PublishedTT" +
}UU 
;UU 
ifVV 
(VV 

categoryIdVV 
.VV 
HasValueVV #
)VV# $
{WW $
CategoryArticleViewModelXX ($
categoryArticleViewModelXX) A
=XXB C
bEArticleViewModelXXD V
.XXV W

CategoriesXXW a
.XXa b
FindXXb f
(XXf g
cXXg h
=>XXi k
cXXl m
.XXm n

CategoryIdXXn x
==XXy {

categoryId	XX| Ü
)
XXÜ á
;
XXá à
ifYY 
(YY $
categoryArticleViewModelYY ,
!=YY- /
nullYY0 4
)YY4 5
{ZZ $
categoryArticleViewModel[[ ,
.[[, -
	IsActived[[- 6
=[[7 8
true[[9 =
;[[= >
}\\ 
}]] 
ViewBag^^ 
.^^ 

categoryId^^ 
=^^  

categoryId^^! +
;^^+ ,
return__ 
View__ 
(__ 
bEArticleViewModel__ *
)__* +
;__+ ,
}`` 	
[bb 	
HttpGetbb	 
]bb 
[cc 	
Routecc	 
(cc 
$strcc )
)cc) *
]cc* +
publicdd 
IActionResultdd 
AddEmptyPropertydd -
(dd- .
intdd. 1
indexdd2 7
)dd7 8
{ee 	
ViewDataff 
[ff 
$strff 
]ff 
=ff 
indexff  %
;ff% &
returngg 
PartialViewgg 
(gg 
newgg "
ExtraPropertygg# 0
(gg0 1
)gg1 2
)gg2 3
;gg3 4
}hh 	
[jj 	
HttpPostjj	 
]jj 
[kk 	
Routekk	 
(kk 
$strkk 
)kk 
]kk 
publicll 
IActionResultll 
	GetEditorll &
(ll& '
intll' *
indexll+ 0
,ll0 1
SWCmsConstantsll2 @
.ll@ A
DataTypellA I
typellJ N
,llN O
stringllP V
idllW Y
,llY Z
stringll[ a
namellb f
,llf g
stringllh n
valuello t
)llt u
{mm 	
ViewDatann 
[nn 
$strnn 
]nn 
=nn 
idnn 
;nn  
ViewDataoo 
[oo 
$stroo 
]oo 
=oo 
nameoo #
;oo# $
ViewDatapp 
[pp 
$strpp 
]pp  
=pp! "
typepp# '
;pp' (
ViewDataqq 
[qq 
$strqq 
]qq 
=qq 
valueqq  %
;qq% &
ViewDatarr 
[rr 
$strrr 
]rr 
=rr 
indexrr  %
;rr% &
returnss 
PartialViewss 
(ss 
$strss (
)ss( )
;ss) *
}tt 	
[yy 	
Routeyy	 
(yy 
$stryy 
)yy 
]yy 
[zz 	
Routezz	 
(zz 
$strzz (
)zz( )
]zz) *
[{{ 	
HttpPost{{	 
]{{ 
[|| 	$
ValidateAntiForgeryToken||	 !
]||! "
public}} 
async}} 
Task}} 
<}} 
IActionResult}} '
>}}' (
Create}}) /
(}}/ 0
BEArticleViewModel}}0 B
article}}C J
,}}J K
int}}L O
?}}O P

categoryId}}Q [
=}}\ ]
null}}^ b
)}}b c
{~~ 	
if 
( 

ModelState 
. 
IsValid "
)" #
{
ÄÄ 
var
ÉÉ  
repositoryResponse
ÉÉ &
=
ÉÉ' (
await
ÉÉ) .
article
ÉÉ/ 6
.
ÉÉ6 7
SaveModelAsync
ÉÉ7 E
(
ÉÉE F
true
ÉÉF J
)
ÉÉJ K
.
ÉÉK L
ConfigureAwait
ÉÉL Z
(
ÉÉZ [
false
ÉÉ[ `
)
ÉÉ` a
;
ÉÉa b
if
ÑÑ 
(
ÑÑ  
repositoryResponse
ÑÑ &
.
ÑÑ& '
	IsSucceed
ÑÑ' 0
)
ÑÑ0 1
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 

categoryId
ÜÜ "
.
ÜÜ" #
HasValue
ÜÜ# +
)
ÜÜ+ ,
{
áá 
return
àà 
RedirectToAction
àà /
(
àà/ 0
$str
àà0 :
,
àà: ;
$str
àà< C
,
ààC D
new
ààE H
{
ààI J
id
ààK M
=
ààN O

categoryId
ààP Z
}
àà[ \
)
àà\ ]
;
àà] ^
}
ââ 
else
ää 
{
ãã 
return
åå 
RedirectToAction
åå /
(
åå/ 0
$str
åå0 7
)
åå7 8
;
åå8 9
}
çç 
}
éé 
else
èè 
{
êê 
return
ëë 
View
ëë 
(
ëë  
article
ëë  '
)
ëë' (
;
ëë( )
}
íí 
}
ìì 
ViewBag
îî 
.
îî 

categoryId
îî 
=
îî  

categoryId
îî! +
;
îî+ ,
return
ïï 
View
ïï 
(
ïï 
article
ïï 
)
ïï  
;
ïï  !
}
ññ 	
[
ôô 	
HttpGet
ôô	 
]
ôô 
[
öö 	
Route
öö	 
(
öö 
$str
öö 
)
öö 
]
öö 
[
õõ 	
Route
õõ	 
(
õõ 
$str
õõ +
)
õõ+ ,
]
õõ, -
public
úú 
async
úú 
Task
úú 
<
úú 
IActionResult
úú '
>
úú' (
Edit
úú) -
(
úú- .
string
úú. 4
id
úú5 7
=
úú8 9
null
úú: >
,
úú> ?
int
úú@ C
?
úúC D

categoryId
úúE O
=
úúP Q
null
úúR V
)
úúV W
{
ùù 	
if
ûû 
(
ûû 
id
ûû 
==
ûû 
null
ûû 
)
ûû 
{
üü 
return
†† 
RedirectToAction
†† '
(
††' (
$str
††( /
)
††/ 0
;
††0 1
}
°° 
var
££  
repositoryResponse
££ "
=
££# $
await
££% * 
BEArticleViewModel
££+ =
.
££= >

Repository
££> H
.
££H I!
GetSingleModelAsync
££I \
(
££\ ]
m
§§ 
=>
§§ 
m
§§ 
.
§§ 
Id
§§ 
==
§§ 
id
§§ 
&&
§§  "
m
§§# $
.
§§$ %
Specificulture
§§% 3
==
§§4 6
CurrentLanguage
§§7 F
)
§§F G
.
§§G H
ConfigureAwait
§§H V
(
§§V W
false
§§W \
)
§§\ ]
;
§§] ^
if
•• 
(
••  
repositoryResponse
•• "
==
••# %
null
••& *
)
••* +
{
¶¶ 
return
ßß 
RedirectToAction
ßß '
(
ßß' (
$str
ßß( /
)
ßß/ 0
;
ßß0 1
}
®® 
ViewBag
©© 
.
©© 

categoryId
©© 
=
©©  

categoryId
©©! +
;
©©+ ,
return
™™ 
View
™™ 
(
™™  
repositoryResponse
™™ *
.
™™* +
Data
™™+ /
)
™™/ 0
;
™™0 1
}
´´ 	
[
∞∞ 	
Route
∞∞	 
(
∞∞ 
$str
∞∞ 
)
∞∞ 
]
∞∞ 
[
±± 	
Route
±±	 
(
±± 
$str
±± +
)
±±+ ,
]
±±, -
[
≤≤ 	
HttpPost
≤≤	 
]
≤≤ 
[
≥≥ 	&
ValidateAntiForgeryToken
≥≥	 !
]
≥≥! "
public
¥¥ 
async
¥¥ 
Task
¥¥ 
<
¥¥ 
IActionResult
¥¥ '
>
¥¥' (
Edit
¥¥) -
(
¥¥- . 
BEArticleViewModel
¥¥. @
article
¥¥A H
,
¥¥H I
string
¥¥J P
id
¥¥Q S
,
¥¥S T
int
¥¥U X
?
¥¥X Y

categoryId
¥¥Z d
=
¥¥e f
null
¥¥g k
)
¥¥k l
{
µµ 	
if
∂∂ 
(
∂∂ 
id
∂∂ 
!=
∂∂ 
article
∂∂ 
.
∂∂ 
Id
∂∂  
)
∂∂  !
{
∑∑ 
return
∏∏ 
NotFound
∏∏ 
(
∏∏  
)
∏∏  !
;
∏∏! "
}
ππ 
if
ªª 
(
ªª 

ModelState
ªª 
.
ªª 
IsValid
ªª "
)
ªª" #
{
ºº 
try
ΩΩ 
{
ææ 
var
øø  
repositoryResponse
øø *
=
øø+ ,
await
øø- 2
article
øø3 :
.
øø: ;
SaveModelAsync
øø; I
(
øøI J
true
øøJ N
)
øøN O
.
øøO P
ConfigureAwait
øøP ^
(
øø^ _
false
øø_ d
)
øød e
;
øøe f
if
¿¿ 
(
¿¿  
repositoryResponse
¿¿ *
.
¿¿* +
	IsSucceed
¿¿+ 4
)
¿¿4 5
{
¡¡ 
if
¬¬ 
(
¬¬ 

categoryId
¬¬ &
.
¬¬& '
HasValue
¬¬' /
)
¬¬/ 0
{
√√ 
return
ƒƒ "
RedirectToAction
ƒƒ# 3
(
ƒƒ3 4
$str
ƒƒ4 >
,
ƒƒ> ?
$str
ƒƒ@ G
,
ƒƒG H
new
ƒƒI L
{
ƒƒM N
id
ƒƒO Q
=
ƒƒR S

categoryId
ƒƒT ^
}
ƒƒ_ `
)
ƒƒ` a
;
ƒƒa b
}
≈≈ 
else
∆∆ 
{
«« 
return
»» "
RedirectToAction
»»# 3
(
»»3 4
$str
»»4 ;
)
»»; <
;
»»< =
}
…… 
}
   
else
ÀÀ 
{
ÃÃ 
if
ÕÕ 
(
ÕÕ  
repositoryResponse
ÕÕ .
.
ÕÕ. /
	Exception
ÕÕ/ 8
!=
ÕÕ9 ;
null
ÕÕ< @
)
ÕÕ@ A
{
ŒŒ 

ModelState
œœ &
.
œœ& '
AddModelError
œœ' 4
(
œœ4 5
string
œœ5 ;
.
œœ; <
Empty
œœ< A
,
œœA B 
repositoryResponse
œœC U
.
œœU V
	Exception
œœV _
?
œœ_ `
.
œœ` a
Message
œœa h
)
œœh i
;
œœi j
}
–– 
foreach
““ 
(
““  !
var
““! $
error
““% *
in
““+ - 
repositoryResponse
““. @
.
““@ A
Errors
““A G
)
““G H
{
”” 

ModelState
‘‘ &
.
‘‘& '
AddModelError
‘‘' 4
(
‘‘4 5
string
‘‘5 ;
.
‘‘; <
Empty
‘‘< A
,
‘‘A B
error
‘‘C H
)
‘‘H I
;
‘‘I J
}
’’ 
return
◊◊ 
View
◊◊ #
(
◊◊# $
article
◊◊$ +
)
◊◊+ ,
;
◊◊, -
}
ÿÿ 
}
ŸŸ 
catch
⁄⁄ 
(
⁄⁄ *
DbUpdateConcurrencyException
⁄⁄ 3
)
⁄⁄3 4
{
€€ 
if
‹‹ 
(
‹‹ 
!
‹‹  
BEArticleViewModel
‹‹ +
.
‹‹+ ,

Repository
‹‹, 6
.
‹‹6 7
CheckIsExists
‹‹7 D
(
‹‹D E
m
‹‹E F
=>
‹‹G I
m
‹‹J K
.
‹‹K L
Id
‹‹L N
==
‹‹O Q
article
‹‹R Y
.
‹‹Y Z
Id
‹‹Z \
)
‹‹\ ]
)
‹‹] ^
{
›› 
return
ﬁﬁ 
NotFound
ﬁﬁ '
(
ﬁﬁ' (
)
ﬁﬁ( )
;
ﬁﬁ) *
}
ﬂﬂ 
else
‡‡ 
{
·· 
throw
‚‚ 
;
‚‚ 
}
„„ 
}
‰‰ 
}
ÊÊ 
return
ÁÁ 
View
ÁÁ 
(
ÁÁ 
article
ÁÁ 
)
ÁÁ  
;
ÁÁ  !
}
ËË 	
[
ÍÍ 	
HttpGet
ÍÍ	 
]
ÍÍ 
[
ÎÎ 	
Route
ÎÎ	 
(
ÎÎ 
$str
ÎÎ 
)
ÎÎ 
]
ÎÎ 
public
ÏÏ 
async
ÏÏ 
Task
ÏÏ 
<
ÏÏ 
IActionResult
ÏÏ '
>
ÏÏ' (
Recycle
ÏÏ) 0
(
ÏÏ0 1
string
ÏÏ1 7
id
ÏÏ8 :
)
ÏÏ: ;
{
ÌÌ 	
var
ÓÓ 

getArticle
ÓÓ 
=
ÓÓ "
InfoArticleViewModel
ÓÓ 1
.
ÓÓ1 2

Repository
ÓÓ2 <
.
ÓÓ< =
GetSingleModel
ÓÓ= K
(
ÓÓK L
a
ÓÓL M
=>
ÓÓN P
a
ÓÓQ R
.
ÓÓR S
Id
ÓÓS U
==
ÓÓV X
id
ÓÓY [
)
ÓÓ[ \
;
ÓÓ\ ]
if
ÔÔ 
(
ÔÔ 

getArticle
ÔÔ 
.
ÔÔ 
	IsSucceed
ÔÔ $
)
ÔÔ$ %
{
 
var
ÒÒ "
infoArticleViewModel
ÒÒ (
=
ÒÒ) *

getArticle
ÒÒ+ 5
.
ÒÒ5 6
Data
ÒÒ6 :
;
ÒÒ: ;"
infoArticleViewModel
ÚÚ $
.
ÚÚ$ %
Status
ÚÚ% +
=
ÚÚ, -
SWStatus
ÚÚ. 6
.
ÚÚ6 7
Deleted
ÚÚ7 >
;
ÚÚ> ?
var
ÛÛ 
result
ÛÛ 
=
ÛÛ 
await
ÛÛ ""
infoArticleViewModel
ÛÛ# 7
.
ÛÛ7 8
SaveModelAsync
ÛÛ8 F
(
ÛÛF G
)
ÛÛG H
.
ÛÛH I
ConfigureAwait
ÛÛI W
(
ÛÛW X
false
ÛÛX ]
)
ÛÛ] ^
;
ÛÛ^ _
if
ÙÙ 
(
ÙÙ 
result
ÙÙ 
.
ÙÙ 
	IsSucceed
ÙÙ $
)
ÙÙ$ %
{
ıı 
return
ˆˆ 
RedirectToAction
ˆˆ +
(
ˆˆ+ ,
$str
ˆˆ, 3
)
ˆˆ3 4
;
ˆˆ4 5
}
˜˜ 
else
¯¯ 
{
˘˘ 
return
˙˙ 
RedirectToAction
˙˙ +
(
˙˙+ ,
$str
˙˙, 3
)
˙˙3 4
;
˙˙4 5
}
˚˚ 
}
¸¸ 
else
˝˝ 
{
˛˛ 
return
ˇˇ 
RedirectToAction
ˇˇ '
(
ˇˇ' (
$str
ˇˇ( /
)
ˇˇ/ 0
;
ˇˇ0 1
}
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	
HttpGet
ÉÉ	 
]
ÉÉ 
[
ÑÑ 	
Route
ÑÑ	 
(
ÑÑ 
$str
ÑÑ 
)
ÑÑ 
]
ÑÑ 
public
ÖÖ 
async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
IActionResult
ÖÖ '
>
ÖÖ' (
Restore
ÖÖ) 0
(
ÖÖ0 1
string
ÖÖ1 7
id
ÖÖ8 :
)
ÖÖ: ;
{
ÜÜ 	
var
áá 

getArticle
áá 
=
áá "
InfoArticleViewModel
áá 1
.
áá1 2

Repository
áá2 <
.
áá< =
GetSingleModel
áá= K
(
ááK L
a
ááL M
=>
ááN P
a
ááQ R
.
ááR S
Id
ááS U
==
ááV X
id
ááY [
)
áá[ \
;
áá\ ]
if
àà 
(
àà 

getArticle
àà 
.
àà 
	IsSucceed
àà $
)
àà$ %
{
ââ 
var
ää "
infoArticleViewModel
ää (
=
ää) *

getArticle
ää+ 5
.
ää5 6
Data
ää6 :
;
ää: ;"
infoArticleViewModel
ãã $
.
ãã$ %
Status
ãã% +
=
ãã, -
SWStatus
ãã. 6
.
ãã6 7
Preview
ãã7 >
;
ãã> ?
var
åå 
result
åå 
=
åå 
await
åå ""
infoArticleViewModel
åå# 7
.
åå7 8
SaveModelAsync
åå8 F
(
ååF G
)
ååG H
.
ååH I
ConfigureAwait
ååI W
(
ååW X
false
ååX ]
)
åå] ^
;
åå^ _
if
çç 
(
çç 
result
çç 
.
çç 
	IsSucceed
çç $
)
çç$ %
{
éé 
return
èè 
RedirectToAction
èè +
(
èè+ ,
$str
èè, 3
)
èè3 4
;
èè4 5
}
êê 
else
ëë 
{
íí 
return
ìì 
RedirectToAction
ìì +
(
ìì+ ,
$str
ìì, 3
)
ìì3 4
;
ìì4 5
}
îî 
}
ïï 
else
ññ 
{
óó 
return
òò 
RedirectToAction
òò '
(
òò' (
$str
òò( /
)
òò/ 0
;
òò0 1
}
ôô 
}
öö 	
[
úú 	
HttpGet
úú	 
]
úú 
[
ùù 	
Route
ùù	 
(
ùù 
$str
ùù 
)
ùù 
]
ùù 
public
ûû 
async
ûû 
Task
ûû 
<
ûû 
IActionResult
ûû '
>
ûû' (
Delete
ûû) /
(
ûû/ 0
string
ûû0 6
id
ûû7 9
)
ûû9 :
{
üü 	
var
†† 

getArticle
†† 
=
†† 
await
†† " 
BEArticleViewModel
††# 5
.
††5 6

Repository
††6 @
.
††@ A!
GetSingleModelAsync
††A T
(
††T U
m
††U V
=>
††W Y
m
††Z [
.
††[ \
Id
††\ ^
==
††_ a
id
††b d
&&
††e g
m
††h i
.
††i j
Specificulture
††j x
==
††y {
CurrentLanguage††| ã
)††ã å
.††å ç
ConfigureAwait††ç õ
(††õ ú
false††ú °
)††° ¢
;††¢ £
if
°° 
(
°° 

getArticle
°° 
.
°° 
	IsSucceed
°° $
)
°°$ %
{
¢¢ 
await
££ 

getArticle
££  
.
££  !
Data
££! %
.
££% &
RemoveModelAsync
££& 6
(
££6 7
true
££7 ;
)
££; <
.
££< =
ConfigureAwait
££= K
(
££K L
false
££L Q
)
££Q R
;
££R S
}
§§ 
return
•• 
RedirectToAction
•• #
(
••# $
$str
••$ +
,
••+ ,
$str
••- 7
)
••7 8
;
••8 9
}
¶¶ 	
}
ßß 
}®® ˚Ø
hD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\AuthController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
. 
Areas $
.$ %
Portal% +
.+ ,
Controllers, 7
{ 
[ 
Area 	
(	 

$str
 
) 
] 
[   
Route   

(  
 
$str   "
)  " #
]  # $
public!! 

class!! 
AuthController!! 
:!!  !
BaseController!!" 0
<!!0 1
AuthController!!1 ?
>!!? @
{"" 
private## 
readonly## 
UserManager## $
<##$ %
ApplicationUser##% 4
>##4 5
_userManager##6 B
;##B C
private$$ 
readonly$$ 
SignInManager$$ &
<$$& '
ApplicationUser$$' 6
>$$6 7
_signInManager$$8 F
;$$F G
private%% 
readonly%% 
RoleManager%% $
<%%$ %
IdentityRole%%% 1
>%%1 2
_roleManager%%3 ?
;%%? @
private&& 
readonly&& 
JwtSettings&& $
_options&&% -
;&&- .
private'' 
readonly'' 
IEmailSender'' %
_emailSender''& 2
;''2 3
private(( 
readonly(( 

ISmsSender(( #

_smsSender(($ .
;((. /
private)) 
readonly)) 
ILogger))  
_logger))! (
;))( )
public++ 
AuthController++ 
(++ 
IHostingEnvironment,, 
env,,  #
,,,# $
UserManager-- 
<-- 
ApplicationUser-- '
>--' (
userManager--) 4
,--4 5
SignInManager.. 
<.. 
ApplicationUser.. )
>..) *
signInManager..+ 8
,..8 9
RoleManager// 
<// 
IdentityRole// $
>//$ %
roleManager//& 1
,//1 2
IOptions00 
<00 
JwtSettings00  
>00  !
optionsAccessor00" 1
,001 2
IEmailSender11 
emailSender11 $
,11$ %

ISmsSender22 
	smsSender22  
,22  !
ILoggerFactory33 
loggerFactory33 (
)33( )
:33* +
base33, 0
(330 1
env331 4
)334 5
{44 	
_userManager55 
=55 
userManager55 &
;55& '
_signInManager66 
=66 
signInManager66 *
;66* +
_options77 
=77 
optionsAccessor77 &
.77& '
Value77' ,
;77, -
_emailSender88 
=88 
emailSender88 &
;88& '

_smsSender99 
=99 
	smsSender99 "
;99" #
_logger:: 
=:: 
loggerFactory:: #
.::# $
CreateLogger::$ 0
<::0 1
AuthController::1 ?
>::? @
(::@ A
)::A B
;::B C
};; 	
[>> 	
Route>>	 
(>> 
$str>> 
)>> 
]>> 
[?? 	
HttpGet??	 
]?? 
[@@ 	
AllowAnonymous@@	 
]@@ 
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
LoginAA) .
(AA. /
stringAA/ 5
	returnUrlAA6 ?
=AA@ A
nullAAB F
)AAF G
{BB 	
awaitDD 
HttpContextDD 
.DD 
SignOutAsyncDD *
(DD* +
IdentityConstantsDD+ <
.DD< =
ExternalSchemeDD= K
)DDK L
.DDL M
ConfigureAwaitDDM [
(DD[ \
falseDD\ a
)DDa b
;DDb c
awaitEE 
_signInManagerEE  
.EE  !
SignOutAsyncEE! -
(EE- .
)EE. /
.EE/ 0
ConfigureAwaitEE0 >
(EE> ?
falseEE? D
)EED E
;EEE F
LoginViewModelFF 
modelFF  
=FF! "
newFF# &
LoginViewModelFF' 5
(FF5 6
)FF6 7
{GG 
	ReturnUrlHH 
=HH 
	returnUrlHH %
??HH& (
$strHH) ,
}II 
;II 
returnJJ 
ViewJJ 
(JJ 
modelJJ 
)JJ 
;JJ 
}KK 	
[OO 	
RouteOO	 
(OO 
$strOO 
)OO 
]OO 
[PP 	
HttpPostPP	 
]PP 
[QQ 	
AllowAnonymousQQ	 
]QQ 
[RR 	$
ValidateAntiForgeryTokenRR	 !
]RR! "
publicSS 
asyncSS 
TaskSS 
<SS 
IActionResultSS '
>SS' (
LoginSS) .
(SS. /
LoginViewModelSS/ =
modelSS> C
)SSC D
{TT 	
ifUU 
(UU 

ModelStateUU 
.UU 
IsValidUU "
)UU" #
{VV 
varYY 
resultYY 
=YY 
awaitYY "
_signInManagerYY# 1
.YY1 2
PasswordSignInAsyncYY2 E
(YYE F
modelYYF K
.YYK L
UserNameYYL T
,YYT U
modelYYV [
.YY[ \
PasswordYY\ d
,YYd e
modelYYf k
.YYk l

RememberMeYYl v
,YYv w
lockoutOnFailure	YYx à
:
YYà â
false
YYä è
)
YYè ê
.
YYê ë
ConfigureAwait
YYë ü
(
YYü †
false
YY† •
)
YY• ¶
;
YY¶ ß
ifZZ 
(ZZ 
resultZZ 
.ZZ 
	SucceededZZ $
)ZZ$ %
{[[ 
var\\ 
claims\\ 
=\\  
new\\! $
List\\% )
<\\) *
Claim\\* /
>\\/ 0
(\\0 1
)\\1 2
{]] 
new^^ 
Claim^^ !
(^^! "

ClaimTypes^^" ,
.^^, -
Name^^- 1
,^^1 2
model^^3 8
.^^8 9
UserName^^9 A
)^^A B
}__ 
;__ 
var`` 
user`` 
=`` 
await`` $
_userManager``% 1
.``1 2
FindByNameAsync``2 A
(``A B
model``B G
.``G H
UserName``H P
)``P Q
.``Q R
ConfigureAwait``R `
(``` a
false``a f
)``f g
;``g h
claimsaa 
.aa 
AddRangeaa #
(aa# $"
ExtendedClaimsProvideraa$ :
.aa: ;
	GetClaimsaa; D
(aaD E
useraaE I
)aaI J
)aaJ K
;aaK L
varbb 
claimsIdentitybb &
=bb' (
newbb) ,
ClaimsIdentitybb- ;
(bb; <
claimsbb< B
,bbB C
$strbbD K
)bbK L
;bbL M
awaitdd 
HttpContextdd %
.dd% &
SignInAsyncdd& 1
(dd1 2(
CookieAuthenticationDefaultsee 0
.ee0 1 
AuthenticationSchemeee1 E
,eeE F
newff 
ClaimsPrincipalff '
(ff' (
claimsIdentityff( 6
)ff6 7
,ff7 8
newgg $
AuthenticationPropertiesgg 0
{hh 
IsPersistentii $
=ii% &
trueii' +
,ii+ ,

ExpiresUtcjj "
=jj# $
DateTimejj% -
.jj- .
UtcNowjj. 4
.jj4 5
AddDaysjj5 <
(jj< =
$numjj= ?
)jj? @
}kk 
)kk 
.kk 
ConfigureAwaitkk %
(kk% &
falsekk& +
)kk+ ,
;kk, -
_loggerll 
.ll 
LogInformationll *
(ll* +
$numll+ ,
,ll, -
$strll. ?
)ll? @
;ll@ A
returnmm 
RedirectToLocalmm *
(mm* +
modelmm+ 0
.mm0 1
	ReturnUrlmm1 :
)mm: ;
;mm; <
}nn 
}oo 
returnrr 
Viewrr 
(rr 
modelrr 
)rr 
;rr 
}ss 	
[ww 	
Routeww	 
(ww 
$strww 
)ww 
]ww 
[xx 	
HttpGetxx	 
]xx 
[yy 	
AllowAnonymousyy	 
]yy 
publiczz 
IActionResultzz 
Registerzz %
(zz% &
stringzz& ,
	returnUrlzz- 6
=zz7 8
nullzz9 =
)zz= >
{{{ 	
RegisterViewModel|| 
model|| #
=||$ %
new||& )
RegisterViewModel||* ;
(||; <
)||< =
{}} 
	ReturnUrl~~ 
=~~ 
	returnUrl~~ %
??~~& (
$str~~) ,
,~~, -

UserClaims 
= 
IdentityBasedData .
.. /

UserClaims/ 9
.9 :
Select: @
(@ A
cA B
=>C E
newF I
SelectListItemJ X
{
ÄÄ 
Text
ÅÅ 
=
ÅÅ 
c
ÅÅ 
,
ÅÅ 
Value
ÇÇ 
=
ÇÇ 
c
ÇÇ 
}
ÉÉ 
)
ÉÉ 
.
ÉÉ 
ToList
ÉÉ 
(
ÉÉ 
)
ÉÉ 
}
ÑÑ 
;
ÑÑ 
return
ÖÖ 
View
ÖÖ 
(
ÖÖ 
model
ÖÖ 
)
ÖÖ 
;
ÖÖ 
}
ÜÜ 	
[
ää 	
Route
ää	 
(
ää 
$str
ää 
)
ää 
]
ää 
[
ãã 	
HttpPost
ãã	 
]
ãã 
[
åå 	
AllowAnonymous
åå	 
]
åå 
[
çç 	&
ValidateAntiForgeryToken
çç	 !
]
çç! "
public
éé 
async
éé 
Task
éé 
<
éé 
IActionResult
éé '
>
éé' (
Register
éé) 1
(
éé1 2
RegisterViewModel
éé2 C
model
ééD I
,
ééI J
string
ééK Q
	returnUrl
ééR [
=
éé\ ]
null
éé^ b
)
ééb c
{
èè 	
ViewData
êê 
[
êê 
$str
êê  
]
êê  !
=
êê" #
	returnUrl
êê$ -
;
êê- .
if
ëë 
(
ëë 

ModelState
ëë 
.
ëë 
IsValid
ëë "
)
ëë" #
{
íí 
var
ìì 
user
ìì 
=
ìì 
new
ìì 
ApplicationUser
ìì .
{
îî 
UserName
ïï 
=
ïï 
model
ïï $
.
ïï$ %
UserName
ïï% -
,
ïï- .
Email
ññ 
=
ññ 
model
ññ !
.
ññ! "
Email
ññ" '
,
ññ' (
NickName
óó 
=
óó 
model
óó $
.
óó$ %
Email
óó% *
,
óó* +
	FirstName
òò 
=
òò 
model
òò  %
.
òò% &
Email
òò& +
,
òò+ ,
LastName
ôô 
=
ôô 
model
ôô $
.
ôô$ %
Email
ôô% *
}
öö 
;
öö 
var
¶¶ 
result
¶¶ 
=
¶¶ 
await
¶¶ "
_userManager
¶¶# /
.
¶¶/ 0
CreateAsync
¶¶0 ;
(
¶¶; <
user
¶¶< @
,
¶¶@ A
model
¶¶B G
.
¶¶G H
Password
¶¶H P
)
¶¶P Q
.
¶¶Q R
ConfigureAwait
¶¶R `
(
¶¶` a
false
¶¶a f
)
¶¶f g
;
¶¶g h
if
ßß 
(
ßß 
result
ßß 
.
ßß 
	Succeeded
ßß $
)
ßß$ %
{
®® 
await
ØØ 
_signInManager
ØØ (
.
ØØ( )
SignInAsync
ØØ) 4
(
ØØ4 5
user
ØØ5 9
,
ØØ9 :
isPersistent
ØØ; G
:
ØØG H
false
ØØI N
)
ØØN O
.
ØØO P
ConfigureAwait
ØØP ^
(
ØØ^ _
false
ØØ_ d
)
ØØd e
;
ØØe f
_logger
∞∞ 
.
∞∞ 
LogInformation
∞∞ *
(
∞∞* +
$num
∞∞+ ,
,
∞∞, -
$str
∞∞. Y
)
∞∞Y Z
;
∞∞Z [
return
±± 
RedirectToLocal
±± *
(
±±* +
	returnUrl
±±+ 4
)
±±4 5
;
±±5 6
}
≤≤ 
	AddErrors
≥≥ 
(
≥≥ 
result
≥≥  
)
≥≥  !
;
≥≥! "
}
¥¥ 
return
∑∑ 
View
∑∑ 
(
∑∑ 
model
∑∑ 
)
∑∑ 
;
∑∑ 
}
∏∏ 	
[
ºº 	
Route
ºº	 
(
ºº 
$str
ºº #
)
ºº# $
]
ºº$ %
[
ΩΩ 	
HttpGet
ΩΩ	 
]
ΩΩ 
[
ææ 	
AllowAnonymous
ææ	 
]
ææ 
public
øø 
async
øø 
Task
øø 
<
øø 
IActionResult
øø '
>
øø' ( 
RegisterSuperAdmin
øø) ;
(
øø; <
string
øø< B
	returnUrl
øøC L
=
øøM N
null
øøO S
)
øøS T
{
¿¿ 	
var
¡¡ 

superAdmin
¡¡ 
=
¡¡ 
await
¡¡ "
_userManager
¡¡# /
.
¡¡/ 0!
GetUsersInRoleAsync
¡¡0 C
(
¡¡C D
$str
¡¡D P
)
¡¡P Q
;
¡¡Q R
if
¬¬ 
(
¬¬ 

superAdmin
¬¬ 
.
¬¬ 
Count
¬¬  
>
¬¬! "
$num
¬¬# $
)
¬¬$ %
{
√√ 
return
ƒƒ 
RedirectToAction
ƒƒ '
(
ƒƒ' (
$str
ƒƒ( 2
)
ƒƒ2 3
;
ƒƒ3 4
}
≈≈ 
RegisterViewModel
∆∆ 
model
∆∆ #
=
∆∆$ %
new
∆∆& )
RegisterViewModel
∆∆* ;
(
∆∆; <
)
∆∆< =
{
«« 
	ReturnUrl
»» 
=
»» 
	returnUrl
»» %
??
»»& (
$str
»») ,
,
»», -

UserClaims
…… 
=
…… 
IdentityBasedData
…… .
.
……. /

UserClaims
……/ 9
.
……9 :
Select
……: @
(
……@ A
c
……A B
=>
……C E
new
……F I
SelectListItem
……J X
{
   
Text
ÀÀ 
=
ÀÀ 
c
ÀÀ 
,
ÀÀ 
Value
ÃÃ 
=
ÃÃ 
c
ÃÃ 
}
ÕÕ 
)
ÕÕ 
.
ÕÕ 
ToList
ÕÕ 
(
ÕÕ 
)
ÕÕ 
}
ŒŒ 
;
ŒŒ 
return
–– 
View
–– 
(
–– 
model
–– 
)
–– 
;
–– 
}
—— 	
[
’’ 	
Route
’’	 
(
’’ 
$str
’’ #
)
’’# $
]
’’$ %
[
÷÷ 	
HttpPost
÷÷	 
]
÷÷ 
[
◊◊ 	
AllowAnonymous
◊◊	 
]
◊◊ 
[
ÿÿ 	&
ValidateAntiForgeryToken
ÿÿ	 !
]
ÿÿ! "
public
ŸŸ 
async
ŸŸ 
Task
ŸŸ 
<
ŸŸ 
IActionResult
ŸŸ '
>
ŸŸ' ( 
RegisterSuperAdmin
ŸŸ) ;
(
ŸŸ; <
RegisterViewModel
ŸŸ< M
model
ŸŸN S
,
ŸŸS T
string
ŸŸU [
	returnUrl
ŸŸ\ e
=
ŸŸf g
null
ŸŸh l
)
ŸŸl m
{
⁄⁄ 	
var
€€ 

superAdmin
€€ 
=
€€ 
await
€€ "
_userManager
€€# /
.
€€/ 0!
GetUsersInRoleAsync
€€0 C
(
€€C D
$str
€€D P
)
€€P Q
;
€€Q R
if
‹‹ 
(
‹‹ 

superAdmin
‹‹ 
.
‹‹ 
Count
‹‹  
>
‹‹! "
$num
‹‹# $
)
‹‹$ %
{
›› 
return
ﬁﬁ 
RedirectToAction
ﬁﬁ '
(
ﬁﬁ' (
$str
ﬁﬁ( 2
)
ﬁﬁ2 3
;
ﬁﬁ3 4
}
ﬂﬂ 
ViewData
‡‡ 
[
‡‡ 
$str
‡‡  
]
‡‡  !
=
‡‡" #
	returnUrl
‡‡$ -
;
‡‡- .
if
·· 
(
·· 

ModelState
·· 
.
·· 
IsValid
·· "
)
··" #
{
‚‚ 
var
„„ 
user
„„ 
=
„„ 
new
„„ 
ApplicationUser
„„ .
{
‰‰ 
UserName
ÂÂ 
=
ÂÂ 
model
ÂÂ $
.
ÂÂ$ %
UserName
ÂÂ% -
,
ÂÂ- .
Email
ÊÊ 
=
ÊÊ 
model
ÊÊ !
.
ÊÊ! "
Email
ÊÊ" '
,
ÊÊ' (
NickName
ÁÁ 
=
ÁÁ 
model
ÁÁ $
.
ÁÁ$ %
Email
ÁÁ% *
,
ÁÁ* +
	FirstName
ËË 
=
ËË 
model
ËË  %
.
ËË% &
Email
ËË& +
,
ËË+ ,
LastName
ÈÈ 
=
ÈÈ 
model
ÈÈ $
.
ÈÈ$ %
Email
ÈÈ% *
}
ÍÍ 
;
ÍÍ 
var
ÏÏ 
result
ÏÏ 
=
ÏÏ 
await
ÏÏ "
_userManager
ÏÏ# /
.
ÏÏ/ 0
CreateAsync
ÏÏ0 ;
(
ÏÏ; <
user
ÏÏ< @
,
ÏÏ@ A
model
ÏÏB G
.
ÏÏG H
Password
ÏÏH P
)
ÏÏP Q
.
ÏÏQ R
ConfigureAwait
ÏÏR `
(
ÏÏ` a
false
ÏÏa f
)
ÏÏf g
;
ÏÏg h
await
ÌÌ 
_userManager
ÌÌ "
.
ÌÌ" #
AddToRoleAsync
ÌÌ# 1
(
ÌÌ1 2
user
ÌÌ2 6
,
ÌÌ6 7
$str
ÌÌ8 D
)
ÌÌD E
;
ÌÌE F
if
ÓÓ 
(
ÓÓ 
result
ÓÓ 
.
ÓÓ 
	Succeeded
ÓÓ $
)
ÓÓ$ %
{
ÔÔ 
InfoUserViewModel
ÒÒ %
cmsUser
ÒÒ& -
=
ÒÒ. /
new
ÒÒ0 3
InfoUserViewModel
ÒÒ4 E
(
ÒÒE F
)
ÒÒF G
{
ÚÚ 
Id
ÛÛ 
=
ÛÛ 
user
ÛÛ !
.
ÛÛ! "
Id
ÛÛ" $
,
ÛÛ$ %
Username
ÙÙ  
=
ÙÙ! "
model
ÙÙ# (
.
ÙÙ( )
UserName
ÙÙ) 1
,
ÙÙ1 2
	FirstName
ıı !
=
ıı" #
model
ıı$ )
.
ıı) *
	FirstName
ıı* 3
,
ıı3 4
LastName
ˆˆ  
=
ˆˆ! "
model
ˆˆ# (
.
ˆˆ( )
LastName
ˆˆ) 1
,
ˆˆ1 2
CreatedDateTime
˜˜ '
=
˜˜( )
DateTime
˜˜* 2
.
˜˜2 3
UtcNow
˜˜3 9
}
¯¯ 
;
¯¯ 
await
˘˘ 
cmsUser
˘˘ !
.
˘˘! "
SaveModelAsync
˘˘" 0
(
˘˘0 1
)
˘˘1 2
.
˘˘2 3
ConfigureAwait
˘˘3 A
(
˘˘A B
false
˘˘B G
)
˘˘G H
;
˘˘H I
await
˚˚ 
_signInManager
˚˚ (
.
˚˚( )
SignInAsync
˚˚) 4
(
˚˚4 5
user
˚˚5 9
,
˚˚9 :
isPersistent
˚˚; G
:
˚˚G H
false
˚˚I N
)
˚˚N O
.
˚˚O P
ConfigureAwait
˚˚P ^
(
˚˚^ _
false
˚˚_ d
)
˚˚d e
;
˚˚e f
_logger
¸¸ 
.
¸¸ 
LogInformation
¸¸ *
(
¸¸* +
$num
¸¸+ ,
,
¸¸, -
$str
¸¸. Y
)
¸¸Y Z
;
¸¸Z [
return
˝˝ 
RedirectToLocal
˝˝ *
(
˝˝* +
	returnUrl
˝˝+ 4
)
˝˝4 5
;
˝˝5 6
}
˛˛ 
	AddErrors
ˇˇ 
(
ˇˇ 
result
ˇˇ  
)
ˇˇ  !
;
ˇˇ! "
}
ÄÄ 
return
ÉÉ 
View
ÉÉ 
(
ÉÉ 
model
ÉÉ 
)
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
[
àà 	
Route
àà	 
(
àà 
$str
àà 
)
àà 
]
àà 
[
ââ 	
HttpGet
ââ	 
,
ââ 
HttpPost
ââ 
]
ââ 
public
ää 
async
ää 
Task
ää 
<
ää 
IActionResult
ää '
>
ää' (
Logout
ää) /
(
ää/ 0
)
ää0 1
{
ãã 	
await
åå 
_signInManager
åå  
.
åå  !
SignOutAsync
åå! -
(
åå- .
)
åå. /
.
åå/ 0
ConfigureAwait
åå0 >
(
åå> ?
false
åå? D
)
ååD E
;
ååE F
await
çç 
HttpContext
çç 
.
çç 
SignOutAsync
çç *
(
çç* +*
CookieAuthenticationDefaults
çç+ G
.
ççG H"
AuthenticationScheme
ççH \
)
çç\ ]
.
çç] ^
ConfigureAwait
çç^ l
(
ççl m
false
ççm r
)
ççr s
;
ççs t
_logger
éé 
.
éé 
LogInformation
éé "
(
éé" #
$num
éé# $
,
éé$ %
$str
éé& 8
)
éé8 9
;
éé9 :
return
èè 
RedirectToAction
èè #
(
èè# $
$str
èè$ *
,
èè* +
$str
èè, 2
)
èè2 3
;
èè3 4
}
êê 	
private
îî 
void
îî 
	AddErrors
îî 
(
îî 
IdentityResult
îî -
result
îî. 4
)
îî4 5
{
ïï 	
foreach
ññ 
(
ññ 
var
ññ 
error
ññ 
in
ññ !
result
ññ" (
.
ññ( )
Errors
ññ) /
)
ññ/ 0
{
óó 

ModelState
òò 
.
òò 
AddModelError
òò (
(
òò( )
string
òò) /
.
òò/ 0
Empty
òò0 5
,
òò5 6
error
òò7 <
.
òò< =
Description
òò= H
)
òòH I
;
òòI J
}
ôô 
}
öö 	
private
úú 
IActionResult
úú 
RedirectToLocal
úú -
(
úú- .
string
úú. 4
	returnUrl
úú5 >
)
úú> ?
{
ùù 	
if
ûû 
(
ûû 
Url
ûû 
.
ûû 

IsLocalUrl
ûû 
(
ûû 
	returnUrl
ûû (
)
ûû( )
)
ûû) *
{
üü 
return
†† 
Redirect
†† 
(
††  
	returnUrl
††  )
)
††) *
;
††* +
}
°° 
else
¢¢ 
{
££ 
return
§§ 
RedirectToAction
§§ '
(
§§' (
$str
§§( .
,
§§. /
$str
§§0 6
)
§§6 7
;
§§7 8
}
•• 
}
¶¶ 	
}
©© 
}™™ Õ
`D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\Common.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
. 
Areas $
.$ %
Portal% +
.+ ,
Controllers, 7
{ 
public 

class 
Common 
{ 
}		 
}

 çP
kD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\CultureController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str %
)% &
]& '
public 

class 
CultureController "
:# $
BaseController% 3
<3 4
CultureController4 E
>E F
{ 
public 
CultureController  
(  !
IHostingEnvironment! 4
env5 8
) 
: 
base 
( 
env 
) 
{ 	
} 	
[ 	
HttpGet	 
] 
[   	
Route  	 
(   
$str   
)   
]   
[!! 	
Route!!	 
(!! 
$str!! ;
)!!; <
]!!< =
["" 	
Route""	 
("" 
$str"" A
)""A B
]""B C
public## 
IActionResult## 
Index## "
(##" #
int### &
pageSize##' /
=##0 1
$num##2 4
,##4 5
int##6 9
	pageIndex##: C
=##D E
$num##F G
,##G H
string##I O
keyword##P W
=##X Y
null##Z ^
)##^ _
{$$ 	
return%% 
View%% 
(%% 
BECultureViewModel%% *
.%%* +

Repository%%+ 5
.%%5 6
GetModelList%%6 B
(%%B C
$str%%C M
,%%M N
OrderByDirection%%O _
.%%_ `
	Ascending%%` i
,&& 
pageSize&& 
,&& 
	pageIndex&& %
)&&% &
.&&& '
Data&&' +
)&&+ ,
;&&, -
}'' 	
[** 	
HttpGet**	 
]** 
[++ 	
Route++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
async,, 
Task,, 
<,, 
IActionResult,, '
>,,' (
Details,,) 0
(,,0 1
int,,1 4
?,,4 5
id,,6 8
),,8 9
{-- 	
if.. 
(.. 
id.. 
==.. 
null.. 
).. 
{// 
return00 
NotFound00 
(00  
)00  !
;00! "
}11 
var33 

ttsCulture33 
=33 
await33 "
BECultureViewModel33# 5
.335 6

Repository336 @
.33@ A
GetSingleModelAsync33A T
(33T U
m33U V
=>33W Y
m33Z [
.33[ \
Id33\ ^
==33_ a
id33b d
)33d e
.33e f
ConfigureAwait33f t
(33t u
false33u z
)33z {
;33{ |
if44 
(44 

ttsCulture44 
==44 
null44 "
)44" #
{55 
return66 
NotFound66 
(66  
)66  !
;66! "
}77 
return99 
View99 
(99 

ttsCulture99 "
)99" #
;99# $
}:: 	
[== 	
HttpGet==	 
]== 
[>> 	
Route>>	 
(>> 
$str>> 
)>> 
]>> 
public?? 
IActionResult?? 
Create?? #
(??# $
)??$ %
{@@ 	
returnAA 
ViewAA 
(AA 
newAA 
BECultureViewModelAA .
(AA. /
)AA/ 0
)AA0 1
;AA1 2
}BB 	
[GG 	
RouteGG	 
(GG 
$strGG 
)GG 
]GG 
[HH 	
HttpPostHH	 
]HH 
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
IActionResultJJ '
>JJ' (
CreateJJ) /
(JJ/ 0
BECultureViewModelJJ0 B
	vmCultureJJC L
)JJL M
{KK 	
ifLL 
(LL 

ModelStateLL 
.LL 
IsValidLL "
)LL" #
{MM 
varNN 
resultNN 
=NN 
awaitNN "
	vmCultureNN# ,
.NN, -
SaveModelAsyncNN- ;
(NN; <
)NN< =
.NN= >
ConfigureAwaitNN> L
(NNL M
falseNNM R
)NNR S
;NNS T
ifOO 
(OO 
resultOO 
.OO 
	IsSucceedOO $
)OO$ %
{PP !
GlobalLanguageServiceQQ )
.QQ) *
InstanceQQ* 2
.QQ2 3
RefreshCulturesQQ3 B
(QQB C
)QQC D
;QQD E
}RR 
returnSS 
RedirectToActionSS '
(SS' (
$strSS( /
)SS/ 0
;SS0 1
}TT 
returnUU 
ViewUU 
(UU 
	vmCultureUU !
)UU! "
;UU" #
}VV 	
[YY 	
HttpGetYY	 
]YY 
[ZZ 	
RouteZZ	 
(ZZ 
$strZZ 
)ZZ 
]ZZ 
public[[ 
async[[ 
Task[[ 
<[[ 
IActionResult[[ '
>[[' (
Edit[[) -
([[- .
int[[. 1
id[[2 4
)[[4 5
{\\ 	
var]] 

ttsCulture]] 
=]] 
await]] "
BECultureViewModel]]# 5
.]]5 6

Repository]]6 @
.]]@ A
GetSingleModelAsync]]A T
(]]T U
m]]U V
=>]]W Y
m]]Z [
.]][ \
Id]]\ ^
==]]_ a
id]]b d
)]]d e
;]]e f
if^^ 
(^^ 
!^^ 

ttsCulture^^ 
.^^ 
	IsSucceed^^ %
)^^% &
{__ 
return`` 
NotFound`` 
(``  
)``  !
;``! "
}aa 
returnbb 
Viewbb 
(bb 

ttsCulturebb "
.bb" #
Databb# '
)bb' (
;bb( )
}cc 	
[hh 	
Routehh	 
(hh 
$strhh 
)hh 
]hh 
[ii 	
HttpPostii	 
]ii 
publicjj 
asyncjj 
Taskjj 
<jj 
IActionResultjj '
>jj' (
Editjj) -
(jj- .
intjj. 1
idjj2 4
,jj4 5
[jj6 7
FromFormjj7 ?
]jj? @
BECultureViewModeljjA S
culturejjT [
)jj[ \
{kk 	
ifll 
(ll 
idll 
!=ll 
culturell 
.ll 
Idll  
)ll  !
{mm 
returnnn 
NotFoundnn 
(nn  
)nn  !
;nn! "
}oo 
ifpp 
(pp 

ModelStatepp 
.pp 
IsValidpp "
)pp" #
{qq 
tryrr 
{ss 
vartt 
resulttt 
=tt  
awaittt! &
culturett' .
.tt. /
SaveModelAsynctt/ =
(tt= >
)tt> ?
.tt? @
ConfigureAwaittt@ N
(ttN O
falsettO T
)ttT U
;ttU V
ifuu 
(uu 
resultuu 
.uu 
	IsSucceeduu (
)uu( )
{vv !
GlobalLanguageServiceww -
.ww- .
Instanceww. 6
.ww6 7
RefreshCulturesww7 F
(wwF G
)wwG H
;wwH I
}xx 
}yy 
catchzz 
(zz (
DbUpdateConcurrencyExceptionzz 3
)zz3 4
{{{ 
if|| 
(|| 
!|| 
BECultureViewModel|| +
.||+ ,

Repository||, 6
.||6 7
CheckIsExists||7 D
(||D E
c||E F
=>||G I
c||J K
.||K L
Specificulture||L Z
==||[ ]
culture||^ e
.||e f
Specificulture||f t
)||t u
)||u v
{}} 
return~~ 
NotFound~~ '
(~~' (
)~~( )
;~~) *
} 
else
ÄÄ 
{
ÅÅ 
throw
ÇÇ 
;
ÇÇ 
}
ÉÉ 
}
ÑÑ 
return
ÖÖ 
RedirectToAction
ÖÖ '
(
ÖÖ' (
$str
ÖÖ( /
)
ÖÖ/ 0
;
ÖÖ0 1
}
ÜÜ 
return
áá 
View
áá 
(
áá 
culture
áá 
)
áá  
;
áá  !
}
àà 	
[
ãã 	
Route
ãã	 
(
ãã 
$str
ãã 
)
ãã 
]
ãã 
[
åå 	
HttpGet
åå	 
]
åå 
public
çç 
async
çç 
Task
çç 
<
çç 
IActionResult
çç '
>
çç' (
Delete
çç) /
(
çç/ 0
int
çç0 3
id
çç4 6
)
çç6 7
{
éé 	
var
èè 
vm
èè 
=
èè 
await
èè  
BECultureViewModel
èè -
.
èè- .

Repository
èè. 8
.
èè8 9!
GetSingleModelAsync
èè9 L
(
èèL M
c
èèM N
=>
èèO Q
c
èèR S
.
èèS T
Id
èèT V
==
èèW Y
id
èèZ \
)
èè\ ]
;
èè] ^
if
êê 
(
êê 
vm
êê 
.
êê 
	IsSucceed
êê 
)
êê 
{
ëë 
await
íí 
vm
íí 
.
íí 
Data
íí 
.
íí 
RemoveModelAsync
íí .
(
íí. /
true
íí/ 3
)
íí3 4
;
íí4 5
}
ìì 
return
îî 
RedirectToAction
îî #
(
îî# $
$str
îî$ +
)
îî+ ,
;
îî, -
}
ïï 	
}
ññ 
}óó Ú
mD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\DashboardController.cs
	namespace

 	
Swastika


 
.

 
Cms

 
.

 
Mvc

 
.

 
Areas

  
.

  !
Portal

! '
.

' (
Controllers

( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str '
)' (
]( )
public 

class 
DashboardController $
:% &
BaseController' 5
<5 6
DashboardController6 I
>I J
{ 
public 
DashboardController "
(" #
IHostingEnvironment# 6
env7 :
) 
: 
base 
( 
env 
) 
{ 	
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[!! 	
HttpGet!!	 
]!! 
["" 	
Route""	 
("" 
$str"" ;
)""; <
]""< =
public## 
IActionResult## 
	Dashboard## &
(##& '
string##' -
keyword##. 5
,##5 6
int##7 :
pageSize##; C
=##D E
$num##F H
,##H I
int##J M
	pageIndex##N W
=##X Y
$num##Z [
)##[ \
{$$ 	
DashboardViewModel%% 
	dashboard%% (
=%%) *
new%%+ .
DashboardViewModel%%/ A
(%%A B
)%%B C
;%%C D
return&& 
View&& 
(&& 
	dashboard&& !
)&&! "
;&&" #
}'' 	
}(( 
})) ä~
hD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\FileController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str "
)" #
]# $
public 

class 
FileController 
:  !
BaseController" 0
<0 1
FileController1 ?
>? @
{ 
public 
FileController 
( 
IHostingEnvironment 1
env2 5
) 
: 
base 
( 
env 
) 
{ 	
} 	
[ 	
HttpGet	 
] 
[   	
Route  	 
(   
$str   "
)  " #
]  # $
[!! 	
Route!!	 
(!! 
$str!! +
)!!+ ,
]!!, -
public"" 
IActionResult"" 
Theme"" "
(""" #
string""# )
	themeName""* 3
,""3 4
string""5 ;
folder""< B
)""B C
{## 	
string$$ 
fullPath$$ 
=$$ 
CommonHelper$$ *
.$$* +
GetFullPath$$+ 6
($$6 7
new$$7 :
string$$; A
[$$A B
]$$B C
{%% 
SWCmsConstants&& 
.&& 

Parameters&& )
.&&) * 
TemplatesAssetFolder&&* >
,&&> ?
	themeName'' 
,'' 
folder(( 
})) 
))) 
;)) 
List** 
<** 
string** 
>** 
directories** $
=**% &
FileRepository**' 5
.**5 6
Instance**6 >
.**> ?
GetTopDirectories**? P
(**P Q
fullPath**Q Y
)**Y Z
;**Z [
List++ 
<++ 
FileViewModel++ 
>++ 
files++  %
=++& '
!++( )
string++) /
.++/ 0
IsNullOrEmpty++0 =
(++= >
folder++> D
)++D E
?++F G
FileRepository++H V
.++V W
Instance++W _
.++_ `
GetTopFiles++` k
(++k l
fullPath++l t
)++t u
:,, 
new,, 
List,, 
<,, 
FileViewModel,, (
>,,( )
(,,) *
),,* +
;,,+ ,
ViewData-- 
[-- 
$str-- 
]-- 
=-- 
	themeName-- (
;--( )
ViewData.. 
[.. 
$str.. "
].." #
=..$ %
directories..& 1
;..1 2
return// 
View// 
(// 
files// 
)// 
;// 
}00 	
[22 	
HttpGet22	 
]22 
[33 	
Route33	 
(33 
$str33 <
)33< =
]33= >
public44 
IActionResult44 
	EditTheme44 &
(44& '
string44' -
	themeName44. 7
,447 8
string449 ?
folder44@ F
,44F G
string44H N
name44O S
,44S T
string44U [
ext44\ _
)44_ `
{55 	
string66 
fullPath66 
=66 
CommonHelper66 *
.66* +
GetFullPath66+ 6
(666 7
new667 :
string66; A
[66A B
]66B C
{77
 
SWCmsConstants88 
.88 

Parameters88 )
.88) * 
TemplatesAssetFolder88* >
,88> ?
	themeName99 
,99 
folder:: 
,:: 
name;; 
}<<
 
)<< 
;<< 
string== 
filePath== 
=== 
string== $
.==$ %
Format==% +
(==+ ,
$str==, 4
,==4 5
fullPath==6 >
,==> ?
ext==@ C
)==C D
;==D E
return>> 
View>> 
(>> 
FileRepository>> &
.>>& '
Instance>>' /
.>>/ 0

GetWebFile>>0 :
(>>: ;
filePath>>; C
,>>C D
folder>>E K
)>>K L
)>>L M
;>>M N
}?? 	
[AA 	
HttpPostAA	 
]AA 
[BB 	
RouteBB	 
(BB 
$strBB <
)BB< =
]BB= >
publicCC 
IActionResultCC 
EditCC !
(CC! "
stringCC" (
	themeNameCC) 2
,CC2 3
stringCC4 :
folderCC; A
,CCA B
stringCCC I
nameCCJ N
,CCN O
stringCCP V
extCCW Z
,CCZ [
FileViewModelDD 
templateDD "
)DD" #
{EE 	
ifFF 
(FF 

ModelStateFF 
.FF 
IsValidFF "
)FF" #
{GG 
templateHH 
.HH 

FileFolderHH #
=HH$ %
CommonHelperHH& 2
.HH2 3
GetFullPathHH3 >
(HH> ?
newHH? B
stringHHC I
[HHI J
]HHJ K
{II	 

SWCmsConstantsJJ 
.JJ 

ParametersJJ )
.JJ) * 
TemplatesAssetFolderJJ* >
,JJ> ?
	themeNameKK 
,KK 
folderLL 
}MM	 

)MM
 
;MM 
varNN 
resultNN 
=NN 
FileRepositoryNN +
.NN+ ,
InstanceNN, 4
.NN4 5
SaveWebFileNN5 @
(NN@ A
templateNNA I
)NNI J
;NNJ K
ifOO 
(OO 
resultOO 
)OO 
{PP 
returnQQ 
RedirectToActionQQ +
(QQ+ ,
$strQQ, 3
,QQ3 4
newQQ5 8
{QQ9 :
	themeNameQQ; D
,QQD E
folderQQF L
}QQM N
)QQN O
;QQO P
}RR 
}SS 

ModelStateTT 
.TT 
AddModelErrorTT $
(TT$ %
stringTT% +
.TT+ ,
EmptyTT, 1
,TT1 2
$strTT3 B
)TTB C
;TTC D
returnUU 
ViewUU 
(UU 
templateUU  
)UU  !
;UU! "
}VV 	
[XX 	
HttpGetXX	 
]XX 
[YY 	
RouteYY	 
(YY 
$strYY >
)YY> ?
]YY? @
[ZZ 	
RouteZZ	 
(ZZ 
$strZZ 5
)ZZ5 6
]ZZ6 7
public[[ 
IActionResult[[ 
DeleteTheme[[ (
([[( )
string[[) /
	themeName[[0 9
,[[9 :
string[[; A
folder[[B H
,[[H I
string[[J P
name[[Q U
,[[U V
string[[W ]
ext[[^ a
)[[a b
{\\ 	
string]] 
fullPath]] 
=]] 
CommonHelper]] *
.]]* +
GetFullPath]]+ 6
(]]6 7
new]]7 :
string]]; A
[]]A B
]]]B C
{^^
 
SWCmsConstants__ 
.__ 

Parameters__ )
.__) *
WebRootPath__* 5
,__5 6
SWCmsConstants`` 
.`` 

Parameters`` )
.``) * 
TemplatesAssetFolder``* >
,``> ?
	themeNameaa 
,aa 
folderbb 
,bb 
namecc 
}dd
 
)dd 
;dd 
stringee 
filePathee 
=ee 
stringee $
.ee$ %
Formatee% +
(ee+ ,
$stree, 4
,ee4 5
fullPathee6 >
,ee> ?
extee@ C
)eeC D
;eeD E
varff 
fileff 
=ff 
FileRepositoryff %
.ff% &
Instanceff& .
.ff. /

DeleteFileff/ 9
(ff9 :
filePathff: B
)ffB C
;ffC D
returngg 
RedirectToActiongg #
(gg# $
$strgg$ +
,gg+ ,
routeValuesgg- 8
:gg8 9
newgg: =
{gg> ?
	themeNamegg@ I
,ggI J
folderggK Q
}ggR S
)ggS T
;ggT U
}hh 	
[ll 	
HttpGetll	 
]ll 
[mm 	
Routemm	 
(mm 
$strmm 
)mm 
]mm 
publicnn 
IActionResultnn 
Indexnn "
(nn" #
stringnn# )
foldernn* 0
)nn0 1
{oo 	
varpp 
	templatespp 
=pp 
FileRepositorypp *
.pp* +
Instancepp+ 3
.pp3 4
GetTopFilespp4 ?
(pp? @
folderpp@ F
)ppF G
;ppG H
varqq 
directoriesqq 
=qq 
FileRepositoryqq ,
.qq, -
Instanceqq- 5
.qq5 6
GetTopDirectoriesqq6 G
(qqG H
folderqqH N
)qqN O
;qqO P
ViewDatarr 
[rr 
$strrr "
]rr" #
=rr$ %
directoriesrr& 1
;rr1 2
ViewBagss 
.ss 
folderss 
=ss 
folderss #
;ss# $
returntt 
Viewtt 
(tt 
	templatestt !
)tt! "
;tt" #
}uu 	
[ww 	
HttpPostww	 
]ww 
[xx 	
Routexx	 
(xx 
$strxx 
)xx 
]xx 
publicyy 
IActionResultyy 
Indexyy "
(yy" #
stringyy# )
folderyy* 0
,yy0 1
	IFormFileyy2 ;
fileyy< @
)yy@ A
{zz 	
if{{ 
({{ 
file{{ 
?{{ 
.{{ 
Length{{ 
>{{ 
$num{{  
){{  !
{|| 
folder}} 
=}} 
SwCmsHelper}} $
.}}$ %
GetFullPath}}% 0
(}}0 1
new}}1 4
string}}5 ;
[}}; <
]}}< =
{~~ 
SWCmsConstants "
." #

Parameters# -
.- .

FileFolder. 8
,8 9
folder
ÄÄ 
}
ÅÅ 
)
ÅÅ 
;
ÅÅ 
FileRepository
ÉÉ 
.
ÉÉ 
Instance
ÉÉ '
.
ÉÉ' (
SaveWebFile
ÉÉ( 3
(
ÉÉ3 4
file
ÉÉ4 8
,
ÉÉ8 9
folder
ÉÉ: @
)
ÉÉ@ A
;
ÉÉA B
}
ÑÑ 
var
ÖÖ 
files
ÖÖ 
=
ÖÖ 
FileRepository
ÖÖ &
.
ÖÖ& '
Instance
ÖÖ' /
.
ÖÖ/ 0
GetTopFiles
ÖÖ0 ;
(
ÖÖ; <
folder
ÖÖ< B
)
ÖÖB C
;
ÖÖC D
var
ÜÜ 
directories
ÜÜ 
=
ÜÜ 
FileRepository
ÜÜ ,
.
ÜÜ, -
Instance
ÜÜ- 5
.
ÜÜ5 6
GetTopDirectories
ÜÜ6 G
(
ÜÜG H
folder
ÜÜH N
)
ÜÜN O
;
ÜÜO P
ViewData
áá 
[
áá 
$str
áá "
]
áá" #
=
áá$ %
directories
áá& 1
;
áá1 2
ViewBag
àà 
.
àà 
folder
àà 
=
àà 
folder
àà #
;
àà# $
return
ââ 
View
ââ 
(
ââ 
files
ââ 
)
ââ 
;
ââ 
}
ää 	
[
çç 	
HttpGet
çç	 
]
çç 
[
éé 	
Route
éé	 
(
éé 
$str
éé "
)
éé" #
]
éé# $
public
èè 
IActionResult
èè 
Edit
èè !
(
èè! "
string
èè" (
name
èè) -
,
èè- .
string
èè/ 5
ext
èè6 9
,
èè9 :
string
èè; A
folder
èèB H
)
èèH I
{
êê 	
string
ëë 
filename
ëë 
=
ëë 
string
ëë $
.
ëë$ %
Format
ëë% +
(
ëë+ ,
$str
ëë, 4
,
ëë4 5
name
ëë6 :
,
ëë: ;
ext
ëë< ?
)
ëë? @
;
ëë@ A
var
íí 
template
íí 
=
íí 
FileRepository
íí )
.
íí) *
Instance
íí* 2
.
íí2 3

GetWebFile
íí3 =
(
íí= >
filename
íí> F
,
ííF G
folder
ííH N
)
ííN O
;
ííO P
if
ìì 
(
ìì 
template
ìì 
==
ìì 
null
ìì  
)
ìì  !
{
îî 
return
ïï 
RedirectToAction
ïï '
(
ïï' (
$str
ïï( *
,
ïï* +
new
ïï, /
{
ïï0 1
folder
ïï2 8
}
ïï9 :
)
ïï: ;
;
ïï; <
}
ññ 
return
óó 
View
óó 
(
óó 
template
óó  
)
óó  !
;
óó! "
}
òò 	
[
õõ 	
HttpPost
õõ	 
]
õõ 
[
úú 	
Route
úú	 
(
úú 
$str
úú "
)
úú" #
]
úú# $
public
ùù 
IActionResult
ùù 
Edit
ùù !
(
ùù! "
FileViewModel
ùù" /
template
ùù0 8
)
ùù8 9
{
ûû 	
if
üü 
(
üü 

ModelState
üü 
.
üü 
IsValid
üü "
)
üü" #
{
†† 
var
°° 
result
°° 
=
°° 
FileRepository
°° +
.
°°+ ,
Instance
°°, 4
.
°°4 5
SaveWebFile
°°5 @
(
°°@ A
template
°°A I
)
°°I J
;
°°J K
if
¢¢ 
(
¢¢ 
result
¢¢ 
)
¢¢ 
{
££ 
return
§§ 
RedirectToAction
§§ +
(
§§+ ,
$str
§§, .
,
§§. /
new
§§0 3
{
§§4 5
folder
§§6 <
=
§§= >
template
§§? G
.
§§G H

FileFolder
§§H R
}
§§S T
)
§§T U
;
§§U V
}
•• 
}
¶¶ 

ModelState
ßß 
.
ßß 
AddModelError
ßß $
(
ßß$ %
string
ßß% +
.
ßß+ ,
Empty
ßß, 1
,
ßß1 2
$str
ßß3 B
)
ßßB C
;
ßßC D
return
®® 
View
®® 
(
®® 
template
®®  
)
®®  !
;
®®! "
}
©© 	
[
¨¨ 	
HttpGet
¨¨	 
]
¨¨ 
[
≠≠ 	
Route
≠≠	 
(
≠≠ 
$str
≠≠ $
)
≠≠$ %
]
≠≠% &
public
ÆÆ 
IActionResult
ÆÆ 
Delete
ÆÆ #
(
ÆÆ# $
string
ÆÆ$ *
name
ÆÆ+ /
,
ÆÆ/ 0
string
ÆÆ1 7
ext
ÆÆ8 ;
,
ÆÆ; <
string
ÆÆ= C
folder
ÆÆD J
)
ÆÆJ K
{
ØØ 	
string
∞∞ 
filename
∞∞ 
=
∞∞ 
string
∞∞ $
.
∞∞$ %
Format
∞∞% +
(
∞∞+ ,
$str
∞∞, 4
,
∞∞4 5
name
∞∞6 :
,
∞∞: ;
ext
∞∞< ?
)
∞∞? @
;
∞∞@ A
var
±± 
template
±± 
=
±± 
FileRepository
±± )
.
±±) *
Instance
±±* 2
.
±±2 3
DeleteWebFile
±±3 @
(
±±@ A
filename
±±A I
,
±±I J
folder
±±K Q
)
±±Q R
;
±±R S
return
≤≤ 
RedirectToAction
≤≤ #
(
≤≤# $
$str
≤≤$ &
,
≤≤& '
routeValues
≤≤( 3
:
≤≤3 4
new
≤≤5 8
{
≤≤9 :
folder
≤≤; A
}
≤≤B C
)
≤≤C D
;
≤≤D E
}
≥≥ 	
}
¥¥ 
}µµ üd
lD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\LanguageController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
. 
Areas $
.$ %
Portal% +
.+ ,
Controllers, 7
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str &
)& '
]' (
public 

class 
LanguageController #
:$ %
BaseController& 4
<4 5
LanguageController5 G
>G H
{ 
public 
LanguageController !
(! "
IHostingEnvironment" 5
env6 9
) 
:   
base   
(   
env   
)   
{!! 	
}## 	
['' 	
HttpGet''	 
]'' 
[(( 	
Route((	 
((( 
$str(( 
)(( 
](( 
[)) 	
Route))	 
()) 
$str)) 
))) 
])) 
public** 
IActionResult** 
	Languages** &
(**& '
)**' (
{++ 	
PaginationModel,, 
<,, 
BELanguageViewModel,, /
>,,/ 0
pagingPages,,1 <
=,,= >
new,,? B
PaginationModel,,C R
<,,R S
BELanguageViewModel,,S f
>,,f g
(,,g h
),,h i
{-- 
Items.. 
=.. !
GlobalLanguageService.. -
...- .
ListLanguage... :
...: ;
Where..; @
(..@ A
m..A B
=>..C E
m..F G
...G H
Specificulture..H V
==..W Y
CurrentLanguage..Z i
)..i j
...j k
ToList..k q
(..q r
)..r s
,..s t
	PageIndex// 
=// 
$num// 
,// 
PageSize00 
=00 !
GlobalLanguageService00 0
.000 1
ListLanguage001 =
.00= >
Count00> C
(00C D
m00D E
=>00F H
m00I J
.00J K
Specificulture00K Y
==00Z \
CurrentLanguage00] l
)00l m
,00m n

TotalItems11 
=11 !
GlobalLanguageService11 2
.112 3
ListLanguage113 ?
.11? @
Count11@ E
(11E F
m11F G
=>11H J
m11K L
.11L M
Specificulture11M [
==11\ ^
CurrentLanguage11_ n
)11n o
,11o p
	TotalPage22 
=22 
$num22 
}33 
;33 
return77 
View77 
(77 
pagingPages77 #
)77# $
;77$ %
}88 	
[;; 	
HttpGet;;	 
];; 
[<< 	
Route<<	 
(<< 
$str<< 
)<< 
]<< 
public== 
IActionResult== 
CreateLanguage== +
(==+ ,
)==, -
{>> 	
BELanguageViewModel?? 
ttsLanguage??  +
=??, -
new??. 1
BELanguageViewModel??2 E
(??E F
new@@ 
SiocLanguage@@  
(@@  !
)@@! "
{AA 
SpecificultureCC "
=CC# $
CurrentLanguageCC% 4
}DD 
)DD 
;DD 
returnEE 
ViewEE 
(EE 
ttsLanguageEE #
)EE# $
;EE$ %
}FF 	
[KK 	
RouteKK	 
(KK 
$strKK 
)KK 
]KK 
[LL 	
HttpPostLL	 
]LL 
[MM 	$
ValidateAntiForgeryTokenMM	 !
]MM! "
publicNN 
asyncNN 
TaskNN 
<NN 
IActionResultNN '
>NN' (
CreateLanguageNN) 7
(NN7 8
BELanguageViewModelNN8 K
languageNNL T
)NNT U
{OO 	
ifPP 
(PP 

ModelStatePP 
.PP 
IsValidPP "
)PP" #
{QQ 
varRR 
resultRR 
=RR 
awaitRR "
languageRR# +
.RR+ ,
SaveModelAsyncRR, :
(RR: ;
)RR; <
.RR< =
ConfigureAwaitRR= K
(RRK L
falseRRL Q
)RRQ R
;RRR S
ifSS 
(SS 
resultSS 
.SS 
	IsSucceedSS $
)SS$ %
{TT !
GlobalLanguageServiceUU )
.UU) *
InstanceUU* 2
.UU2 3
RefreshUU3 :
(UU: ;
)UU; <
;UU< =
returnVV 
RedirectToActionVV +
(VV+ ,
$strVV, 7
)VV7 8
;VV8 9
}WW 
elseXX 
{YY 
ifZZ 
(ZZ 
resultZZ 
.ZZ 
	ExceptionZZ (
!=ZZ) +
nullZZ, 0
)ZZ0 1
{[[ 

ModelState\\ "
.\\" #
AddModelError\\# 0
(\\0 1
string\\1 7
.\\7 8
Empty\\8 =
,\\= >
result\\? E
.\\E F
	Exception\\F O
?\\O P
.\\P Q
Message\\Q X
)\\X Y
;\\Y Z
}]] 
foreach__ 
(__ 
var__  
error__! &
in__' )
result__* 0
.__0 1
Errors__1 7
)__7 8
{`` 

ModelStateaa "
.aa" #
AddModelErroraa# 0
(aa0 1
stringaa1 7
.aa7 8
Emptyaa8 =
,aa= >
erroraa? D
)aaD E
;aaE F
}bb 
returndd 
Viewdd 
(dd  
languagedd  (
)dd( )
;dd) *
}ee 
}ff 
elsegg 
{hh 
returnii 
Viewii 
(ii 
languageii $
)ii$ %
;ii% &
}jj 
}kk 	
[nn 	
HttpGetnn	 
]nn 
[oo 	
Routeoo	 
(oo 
$stroo 
)oo 
]oo 
publicpp 
asyncpp 
Taskpp 
<pp 
IActionResultpp '
>pp' (
EditLanguagepp) 5
(pp5 6
stringpp6 <
idpp= ?
)pp? @
{qq 	
ifrr 
(rr 
idrr 
==rr 
nullrr 
)rr 
{ss 
returntt 
NotFoundtt 
(tt  
)tt  !
;tt! "
}uu 
varww 
ttsLanguageww 
=ww 
awaitww #
BELanguageViewModelww$ 7
.ww7 8

Repositoryww8 B
.wwB C
GetSingleModelAsyncwwC V
(wwV W
mxx 
=>xx 
mxx 
.xx 
Keywordxx 
==xx !
idxx" $
&&xx% '
mxx( )
.xx) *
Specificulturexx* 8
==xx9 ;
CurrentLanguagexx< K
)xxK L
.xxL M
ConfigureAwaitxxM [
(xx[ \
falsexx\ a
)xxa b
;xxb c
ifyy 
(yy 
ttsLanguageyy 
==yy 
nullyy #
)yy# $
{zz 
return{{ 
NotFound{{ 
({{  
){{  !
;{{! "
}|| 
return}} 
View}} 
(}} 
ttsLanguage}} #
.}}# $
Data}}$ (
)}}( )
;}}) *
}~~ 	
[
ÉÉ 	
Route
ÉÉ	 
(
ÉÉ 
$str
ÉÉ 
)
ÉÉ 
]
ÉÉ 
[
ÑÑ 	
HttpPost
ÑÑ	 
]
ÑÑ 
[
ÖÖ 	&
ValidateAntiForgeryToken
ÖÖ	 !
]
ÖÖ! "
public
ÜÜ 
async
ÜÜ 
Task
ÜÜ 
<
ÜÜ 
IActionResult
ÜÜ '
>
ÜÜ' (
EditLanguage
ÜÜ) 5
(
ÜÜ5 6
string
ÜÜ6 <
id
ÜÜ= ?
,
ÜÜ? @!
BELanguageViewModel
ÜÜA T!
beLanguageViewModel
ÜÜU h
)
ÜÜh i
{
áá 	
if
àà 
(
àà 

ModelState
àà 
.
àà 
IsValid
àà "
)
àà" #
{
ââ 
try
ää 
{
ãã 
var
åå 
result
åå 
=
åå  
await
åå! &!
beLanguageViewModel
åå' :
.
åå: ;
SaveModelAsync
åå; I
(
ååI J
)
ååJ K
.
ååK L
ConfigureAwait
ååL Z
(
ååZ [
false
åå[ `
)
åå` a
;
ååa b
if
çç 
(
çç 
result
çç 
.
çç 
	IsSucceed
çç (
)
çç( )
{
éé #
GlobalLanguageService
èè -
.
èè- .
Instance
èè. 6
.
èè6 7
Refresh
èè7 >
(
èè> ?
)
èè? @
;
èè@ A
}
êê 
else
ëë 
{
íí 
if
ìì 
(
ìì 
result
ìì "
.
ìì" #
	Exception
ìì# ,
!=
ìì- /
null
ìì0 4
)
ìì4 5
{
îî 

ModelState
ïï &
.
ïï& '
AddModelError
ïï' 4
(
ïï4 5
string
ïï5 ;
.
ïï; <
Empty
ïï< A
,
ïïA B
result
ïïC I
.
ïïI J
	Exception
ïïJ S
?
ïïS T
.
ïïT U
Message
ïïU \
)
ïï\ ]
;
ïï] ^
}
ññ 
foreach
òò 
(
òò  !
var
òò! $
error
òò% *
in
òò+ -
result
òò. 4
.
òò4 5
Errors
òò5 ;
)
òò; <
{
ôô 

ModelState
öö &
.
öö& '
AddModelError
öö' 4
(
öö4 5
string
öö5 ;
.
öö; <
Empty
öö< A
,
ööA B
error
ööC H
)
ööH I
;
ööI J
}
õõ 
}
úú 
}
ùù 
catch
ûû 
(
ûû *
DbUpdateConcurrencyException
ûû 3
)
ûû3 4
{
üü 
if
†† 
(
†† 
!
†† !
BELanguageViewModel
†† ,
.
††, -

Repository
††- 7
.
††7 8
CheckIsExists
††8 E
(
††E F
c
††F G
=>
††H J
c
††K L
.
††L M
Specificulture
††M [
==
††\ ^!
beLanguageViewModel
††_ r
.
††r s
Specificulture††s Å
)††Å Ç
)††Ç É
{
°° 
return
¢¢ 
NotFound
¢¢ '
(
¢¢' (
)
¢¢( )
;
¢¢) *
}
££ 
else
§§ 
{
•• 
throw
¶¶ 
;
¶¶ 
}
ßß 
}
®® 
return
©© 
RedirectToAction
©© '
(
©©' (
$str
©©( 3
)
©©3 4
;
©©4 5
}
™™ 
return
´´ 
View
´´ 
(
´´ !
beLanguageViewModel
´´ +
)
´´+ ,
;
´´, -
}
¨¨ 	
[
ÆÆ 	
HttpGet
ÆÆ	 
]
ÆÆ 
[
ØØ 	
Route
ØØ	 
(
ØØ 
$str
ØØ 
)
ØØ 
]
ØØ 
public
∞∞ 
async
∞∞ 
Task
∞∞ 
<
∞∞ 
IActionResult
∞∞ '
>
∞∞' (
DeleteLanguage
∞∞) 7
(
∞∞7 8
string
∞∞8 >
id
∞∞? A
)
∞∞A B
{
±± 	
var
≤≤ 
result
≤≤ 
=
≤≤ 
await
≤≤ !
BELanguageViewModel
≤≤ 2
.
≤≤2 3

Repository
≤≤3 =
.
≤≤= >
RemoveModelAsync
≤≤> N
(
≤≤N O
m
≤≤O P
=>
≤≤Q S
m
≤≤T U
.
≤≤U V
Keyword
≤≤V ]
==
≤≤^ `
id
≤≤a c
&&
≤≤d f
m
≤≤g h
.
≤≤h i
Specificulture
≤≤i w
==
≤≤x z
CurrentLanguage≤≤{ ä
)≤≤ä ã
.≤≤ã å
ConfigureAwait≤≤å ö
(≤≤ö õ
false≤≤õ †
)≤≤† °
;≤≤° ¢
if
≥≥ 
(
≥≥ 
result
≥≥ 
.
≥≥ 
	IsSucceed
≥≥  
)
≥≥  !
{
¥¥ #
GlobalLanguageService
µµ %
.
µµ% &
Instance
µµ& .
.
µµ. /
Refresh
µµ/ 6
(
µµ6 7
)
µµ7 8
;
µµ8 9
}
∂∂ 
return
∑∑ 
RedirectToAction
∑∑ #
(
∑∑# $
$str
∑∑$ /
)
∑∑/ 0
;
∑∑0 1
}
∏∏ 	
}
ªª 
}ºº ü
iD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\MediaController.cs
	namespace		 	
Swastika		
 
.		 
Cms		 
.		 
Mvc		 
.		 
Areas		  
.		  !
Portal		! '
.		' (
Controllers		( 3
{

 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str #
)# $
]$ %
public 

class 
MediaController  
:! "
BaseController# 1
<1 2
MediaController2 A
>A B
{ 
public 
MediaController 
( 
IHostingEnvironment 2
env3 6
) 
: 
base 
( 
env 
) 
{ 	
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str 1
)1 2
]2 3
[ 	
Route	 
( 
$str 7
)7 8
]8 9
public 
IActionResult 
Index "
(" #
string# )
keyword* 1
,1 2
int3 6
Mediaize7 ?
=@ A
$numB D
,D E
intF I
	pageIndexJ S
=T U
$numV W
)W X
{ 	
return 
View 
( 
) 
; 
} 	
} 
}   Ë‘
jD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\ModuleController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str $
)$ %
]% &
public 

class 
ModuleController !
:" #
BaseController$ 2
<2 3
ModuleController3 C
>C D
{ 
public!! 
ModuleController!! 
(!!  
IHostingEnvironment!!  3
env!!4 7
)%% 
:&& 
base&& 
(&& 
env&& 
)&& 
{'' 	
})) 	
[,, 	
HttpGet,,	 
],, 
[-- 	
Route--	 
(-- 
$str-- 
)-- 
]-- 
[.. 	
Route..	 
(.. 
$str.. 
).. 
].. 
[// 	
Route//	 
(// 
$str// ;
)//; <
]//< =
[00 	
Route00	 
(00 
$str00 A
)00A B
]00B C
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
Index11) .
(11. /
int11/ 2
pageSize113 ;
=11< =
$num11> @
,11@ A
int11B E
	pageIndex11F O
=11P Q
$num11R S
,11S T
string11U [
keyword11\ c
=11d e
null11f j
)11j k
{22 	
var33 
pagingPages33 
=33 
await33 #
InfoModuleViewModel44 #
.44# $

Repository44$ .
.44. /
GetModelListByAsync44/ B
(44B C
m55 
=>55 
m55 
.55 
Specificulture55 %
==55& (
CurrentLanguage55) 8
&&66 
(66 
string66 
.66 
IsNullOrEmpty66 ,
(66, -
keyword66- 4
)664 5
||666 8
m669 :
.66: ;
Name66; ?
.66? @
Contains66@ H
(66H I
keyword66I P
)66P Q
)66Q R
,66R S
$str77 
,77 
OrderByDirection77 ,
.77, -
	Ascending77- 6
,776 7
pageSize88 
,88 
	pageIndex88 #
)88# $
.88$ %
ConfigureAwait88% 3
(883 4
false884 9
)889 :
;88: ;
return:: 
View:: 
(:: 
pagingPages:: #
.::# $
Data::$ (
)::( )
;::) *
};; 	
[>> 	
HttpGet>>	 
]>> 
[?? 	
Route??	 
(?? 
$str?? 
)?? 
]?? 
public@@ 
IActionResult@@ 
Create@@ #
(@@# $
)@@$ %
{AA 	
varBB 
ModuleBB 
=BB 
newBB 
BEModuleViewModelBB .
(BB. /
newBB/ 2

SiocModuleBB3 =
(BB= >
)BB> ?
{CC 
SpecificultureDD 
=DD  
CurrentLanguageDD! 0
,DD0 1
StatusEE 
=EE 
(EE 
intEE 
)EE 
CommonEE $
.EE$ %
UtilityEE% ,
.EE, -
EnumsEE- 2
.EE2 3
SWStatusEE3 ;
.EE; <
	PublishedEE< E
}FF 
)FF 
;FF 
returnGG 
ViewGG 
(GG 
ModuleGG 
)GG 
;GG  
}HH 	
[MM 	
RouteMM	 
(MM 
$strMM 
)MM 
]MM 
[NN 	
HttpPostNN	 
]NN 
[OO 	$
ValidateAntiForgeryTokenOO	 !
]OO! "
publicPP 
asyncPP 
TaskPP 
<PP 
IActionResultPP '
>PP' (
CreatePP) /
(PP/ 0
BEModuleViewModelPP0 A
ModulePPB H
)PPH I
{QQ 	
ifRR 
(RR 

ModelStateRR 
.RR 
IsValidRR "
)RR" #
{SS 
varTT 
resultTT 
=TT 
awaitTT "
ModuleTT# )
.TT) *
SaveModelAsyncTT* 8
(TT8 9
trueTT9 =
)TT= >
.TT> ?
ConfigureAwaitTT? M
(TTM N
falseTTN S
)TTS T
;TTT U
ifUU 
(UU 
resultUU 
.UU 
	IsSucceedUU $
)UU$ %
{VV 
returnWW 
RedirectToActionWW +
(WW+ ,
$strWW, 5
,WW5 6
newWW7 :
{WW; <
idWW= ?
=WW@ A
ModuleWWB H
.WWH I
IdWWI K
}WWL M
)WWM N
;WWN O
}XX 
elseYY 
{ZZ 
throw[[ 
new[[ 
	Exception[[ '
([[' (
result[[( .
.[[. /
	Exception[[/ 8
.[[8 9

StackTrace[[9 C
)[[C D
;[[D E
}\\ 
}]] 
return^^ 
View^^ 
(^^ 
Module^^ 
)^^ 
;^^  
}__ 	
[bb 	
HttpGetbb	 
]bb 
[cc 	
Routecc	 
(cc 
$strcc 
)cc 
]cc 
publicdd 
asyncdd 
Taskdd 
<dd 
IActionResultdd '
>dd' (
Editdd) -
(dd- .
intdd. 1
iddd2 4
)dd4 5
{ee 	
varff 
Moduleff 
=ff 
awaitff 
BEModuleViewModelff 0
.ff0 1

Repositoryff1 ;
.ff; <
GetSingleModelAsyncff< O
(ffO P
mffP Q
=>ffR T
mgg 
.gg 
Idgg 
==gg 
idgg 
&&gg 
mgg 
.gg 
Specificulturegg *
==gg+ -
CurrentLanguagegg. =
)gg= >
.gg> ?
ConfigureAwaitgg? M
(ggM N
falseggN S
)ggS T
;ggT U
ifhh 
(hh 
Modulehh 
==hh 
nullhh 
)hh 
{ii 
returnjj 
RedirectToActionjj '
(jj' (
$strjj( /
)jj/ 0
;jj0 1
}kk 
returnll 
Viewll 
(ll 
Modulell 
.ll 
Datall #
)ll# $
;ll$ %
}mm 	
[rr 	
Routerr	 
(rr 
$strrr 
)rr 
]rr 
[ss 	
HttpPostss	 
]ss 
[tt 	$
ValidateAntiForgeryTokentt	 !
]tt! "
publicuu 
asyncuu 
Taskuu 
<uu 
IActionResultuu '
>uu' (
Edituu) -
(uu- .
intuu. 1
iduu2 4
,uu4 5
BEModuleViewModeluu6 G
ModuleuuH N
)uuN O
{vv 	
ifww 
(ww 
idww 
!=ww 
Moduleww 
.ww 
Idww 
)ww  
{xx 
returnyy 
NotFoundyy 
(yy  
)yy  !
;yy! "
}zz 
if|| 
(|| 

ModelState|| 
.|| 
IsValid|| "
)||" #
{}} 
try~~ 
{ 
var
ÄÄ 
result
ÄÄ 
=
ÄÄ  
await
ÄÄ! &
Module
ÄÄ' -
.
ÄÄ- .
SaveModelAsync
ÄÄ. <
(
ÄÄ< =
true
ÄÄ= A
)
ÄÄA B
.
ÄÄB C
ConfigureAwait
ÄÄC Q
(
ÄÄQ R
false
ÄÄR W
)
ÄÄW X
;
ÄÄX Y
if
ÅÅ 
(
ÅÅ 
result
ÅÅ 
.
ÅÅ 
	IsSucceed
ÅÅ (
)
ÅÅ( )
{
ÇÇ 
return
ÉÉ 
RedirectToAction
ÉÉ /
(
ÉÉ/ 0
$str
ÉÉ0 9
,
ÉÉ9 :
new
ÉÉ; >
{
ÉÉ? @
id
ÉÉA C
=
ÉÉD E
Module
ÉÉF L
.
ÉÉL M
Id
ÉÉM O
}
ÉÉP Q
)
ÉÉQ R
;
ÉÉR S
}
ÑÑ 
else
ÖÖ 
{
ÜÜ 

ModelState
áá "
.
áá" #
AddModelError
áá# 0
(
áá0 1
string
áá1 7
.
áá7 8
Empty
áá8 =
,
áá= >
result
áá? E
.
ááE F
	Exception
ááF O
.
ááO P
Message
ááP W
)
ááW X
;
ááX Y
return
àà 
View
àà #
(
àà# $
Module
àà$ *
)
àà* +
;
àà+ ,
}
ââ 
}
ää 
catch
ãã 
(
ãã *
DbUpdateConcurrencyException
ãã 3
)
ãã3 4
{
åå 
if
çç 
(
çç 
!
çç 
BEModuleViewModel
çç *
.
çç* +

Repository
çç+ 5
.
çç5 6
CheckIsExists
çç6 C
(
ççC D
m
ççD E
=>
ççF H
m
ççI J
.
ççJ K
Id
ççK M
==
ççN P
Module
ççQ W
.
ççW X
Id
ççX Z
)
ççZ [
)
çç[ \
{
éé 
return
èè 
NotFound
èè '
(
èè' (
)
èè( )
;
èè) *
}
êê 
else
ëë 
{
íí 
throw
ìì 
;
ìì 
}
îî 
}
ïï 
}
óó 
ViewData
òò 
[
òò 
$str
òò 
]
òò 
=
òò  
$str
òò! '
;
òò' (
ViewData
ôô 
[
ôô 
$str
ôô !
]
ôô! "
=
ôô# $
$str
ôô% ,
;
ôô, -
return
öö 
View
öö 
(
öö 
Module
öö 
)
öö 
;
öö  
}
õõ 	
[
ùù 	
HttpGet
ùù	 
]
ùù 
[
ûû 	
Route
ûû	 
(
ûû 
$str
ûû 
)
ûû 
]
ûû 
public
üü 
async
üü 
Task
üü 
<
üü 
IActionResult
üü '
>
üü' (
Delete
üü) /
(
üü/ 0
int
üü0 3
id
üü4 6
)
üü6 7
{
†† 	
var
°° 
Module
°° 
=
°° 
await
°° 
BEModuleViewModel
°° 0
.
°°0 1

Repository
°°1 ;
.
°°; <
RemoveModelAsync
°°< L
(
°°L M
m
°°M N
=>
°°O Q
m
°°R S
.
°°S T
Id
°°T V
==
°°W Y
id
°°Z \
&&
°°] _
m
°°` a
.
°°a b
Specificulture
°°b p
==
°°q s
CurrentLanguage°°t É
)°°É Ñ
.°°Ñ Ö
ConfigureAwait°°Ö ì
(°°ì î
false°°î ô
)°°ô ö
;°°ö õ
return
¢¢ 
RedirectToAction
¢¢ #
(
¢¢# $
$str
¢¢$ +
)
¢¢+ ,
;
¢¢, -
}
££ 	
[
•• 	
HttpGet
••	 
]
•• 
[
¶¶ 	
Route
¶¶	 
(
¶¶ 
$str
¶¶ &
)
¶¶& '
]
¶¶' (
public
ßß 
IActionResult
ßß 
AddEmptyField
ßß *
(
ßß* +
int
ßß+ .
index
ßß/ 4
)
ßß4 5
{
®® 	
ViewData
©© 
[
©© 
$str
©© 
]
©© 
=
©© 
index
©©  %
;
©©% &
return
™™ 
PartialView
™™ 
(
™™ 
new
™™ ""
ModuleFieldViewModel
™™# 7
(
™™7 8
)
™™8 9
{
™™: ;
Width
™™< A
=
™™B C
$num
™™D E
,
™™E F
	IsDisplay
™™G P
=
™™Q R
true
™™S W
}
™™X Y
)
™™Y Z
;
™™Z [
}
´´ 	
[
≠≠ 	
HttpGet
≠≠	 
]
≠≠ 
[
ÆÆ 	
Route
ÆÆ	 
(
ÆÆ 
$str
ÆÆ 4
)
ÆÆ4 5
]
ÆÆ5 6
public
ØØ 
async
ØØ 
Task
ØØ 
<
ØØ 
IActionResult
ØØ '
>
ØØ' (
	DeleteNav
ØØ) 2
(
ØØ2 3
int
ØØ3 6
id
ØØ7 9
,
ØØ9 :
string
ØØ; A
	productId
ØØB K
)
ØØK L
{
∞∞ 	
var
±± 
Module
±± 
=
±± 
await
±± '
NavModuleProductViewModel
±± 8
.
±±8 9

Repository
±±9 C
.
±±C D
RemoveModelAsync
±±D T
(
±±T U
m
≤≤ 
=>
≤≤ 
m
≤≤ 
.
≤≤ 
ModuleId
≤≤ 
==
≤≤  "
id
≤≤# %
&&
≤≤& (
m
≤≤) *
.
≤≤* +
	ProductId
≤≤+ 4
==
≤≤5 7
	productId
≤≤8 A
&&
≤≤B D
m
≤≤E F
.
≤≤F G
Specificulture
≤≤G U
==
≤≤V X
CurrentLanguage
≤≤Y h
)
≤≤h i
.
≤≤i j
ConfigureAwait
≤≤j x
(
≤≤x y
false
≤≤y ~
)
≤≤~ 
;≤≤ Ä
return
≥≥ 
RedirectToAction
≥≥ #
(
≥≥# $
$str
≥≥$ -
,
≥≥- .
new
≥≥/ 2
{
≥≥3 4
id
≥≥5 7
}
≥≥8 9
)
≥≥9 :
;
≥≥: ;
}
¥¥ 	
[
ãã 	
HttpGet
ãã	 
]
ãã 
[
åå 	
Route
åå	 
(
åå 
$str
åå 
)
åå 
]
åå 
[
çç 	
Route
çç	 
(
çç 
$str
çç >
)
çç> ?
]
çç? @
[
éé 	
Route
éé	 
(
éé 
$str
éé H
)
ééH I
]
ééI J
public
èè 
async
èè 
Task
èè 
<
èè 
IActionResult
èè '
>
èè' (
Details
èè) 0
(
èè0 1
int
èè1 4
id
èè5 7
,
èè7 8
int
èè9 <
pageSize
èè= E
=
èèF G
$num
èèH J
,
èèJ K
int
èèL O
	pageIndex
èèP Y
=
èèZ [
$num
èè\ ]
,
èè] ^
string
èè_ e
keyword
èèf m
=
èèn o
null
èèp t
)
èèt u
{
êê 	
var
ëë 
	getModule
ëë 
=
ëë 
await
ëë !
BEModuleViewModel
ëë" 3
.
ëë3 4

Repository
ëë4 >
.
ëë> ?!
GetSingleModelAsync
ëë? R
(
íí 
m
íí 
=>
íí 
m
íí 
.
íí 
Specificulture
íí &
==
íí' )
CurrentLanguage
íí* 9
&&
íí: <
m
íí= >
.
íí> ?
Id
íí? A
==
ííB D
id
ííE G
)
ííG H
.
ííH I
ConfigureAwait
ííI W
(
ííW X
false
ííX ]
)
íí] ^
;
íí^ _
if
ìì 
(
ìì 
	getModule
ìì 
.
ìì 
	IsSucceed
ìì #
)
ìì# $
{
îî 
var
ïï 
module
ïï 
=
ïï 
	getModule
ïï &
.
ïï& '
Data
ïï' +
;
ïï+ ,
return
ññ 
View
ññ 
(
ññ 
module
ññ "
)
ññ" #
;
ññ# $
}
óó 
else
òò 
{
ôô 
return
öö 
RedirectToAction
öö '
(
öö' (
$str
öö( /
)
öö/ 0
;
öö0 1
}
õõ 
}
úú 	
[
üü 	
HttpGet
üü	 
]
üü 
[
†† 	
Route
††	 
(
†† 
$str
†† '
)
††' (
]
††( )
public
°° 
async
°° 
Task
°° 
<
°° 
IActionResult
°° '
>
°°' (
AddModuleData
°°) 6
(
°°6 7
int
°°7 :
id
°°; =
)
°°= >
{
¢¢ 	
var
££ 
	getModule
££ 
=
££ 
await
££ !!
InfoModuleViewModel
££" 5
.
££5 6

Repository
££6 @
.
££@ A!
GetSingleModelAsync
££A T
(
££T U
m
§§ 
=>
§§ 
m
§§ 
.
§§ 
Id
§§ 
==
§§ 
id
§§ 
&&
§§  "
m
§§# $
.
§§$ %
Specificulture
§§% 3
==
§§4 6
CurrentLanguage
§§7 F
)
§§F G
.
§§G H
ConfigureAwait
§§H V
(
§§V W
false
§§W \
)
§§\ ]
;
§§] ^
if
•• 
(
•• 
	getModule
•• 
.
•• 
	IsSucceed
•• #
)
••# $
{
¶¶ 
var
ßß 

ModuleData
ßß 
=
ßß  
new
ßß! $#
BEModuleDataViewModel
ßß% :
(
ßß: ;
new
®® 
SiocModuleData
®® &
(
®®& '
)
®®' (
{
©© 
ModuleId
™™  
=
™™! "
id
™™# %
,
™™% &
Specificulture
´´ &
=
´´' (
CurrentLanguage
´´) 8
,
´´8 9
Fields
¨¨ 
=
¨¨  
	getModule
¨¨! *
.
¨¨* +
Data
¨¨+ /
.
¨¨/ 0
Fields
¨¨0 6
}
≠≠ 
)
≠≠ 
;
≠≠ 
return
ÆÆ 
View
ÆÆ 
(
ÆÆ 

ModuleData
ÆÆ &
)
ÆÆ& '
;
ÆÆ' (
}
ØØ 
else
∞∞ 
{
±± 
return
≤≤ 
NotFound
≤≤ 
(
≤≤  
)
≤≤  !
;
≤≤! "
}
≥≥ 
}
¥¥ 	
[
ππ 	
Route
ππ	 
(
ππ 
$str
ππ '
)
ππ' (
]
ππ( )
[
∫∫ 	
HttpPost
∫∫	 
]
∫∫ 
[
ªª 	&
ValidateAntiForgeryToken
ªª	 !
]
ªª! "
public
ºº 
async
ºº 
Task
ºº 
<
ºº 
IActionResult
ºº '
>
ºº' (
AddModuleData
ºº) 6
(
ºº6 7#
BEModuleDataViewModel
ºº7 L

ModuleData
ººM W
)
ººW X
{
ΩΩ 	
if
ææ 
(
ææ 

ModelState
ææ 
.
ææ 
IsValid
ææ "
)
ææ" #
{
øø 

ModuleData
¿¿ 
.
¿¿ 
CreatedDateTime
¿¿ *
=
¿¿+ ,
DateTime
¿¿- 5
.
¿¿5 6
UtcNow
¿¿6 <
;
¿¿< =
var
¡¡ 
result
¡¡ 
=
¡¡ 
await
¡¡ "

ModuleData
¡¡# -
.
¡¡- .
SaveModelAsync
¡¡. <
(
¡¡< =
)
¡¡= >
.
¡¡> ?
ConfigureAwait
¡¡? M
(
¡¡M N
false
¡¡N S
)
¡¡S T
;
¡¡T U
if
¬¬ 
(
¬¬ 
result
¬¬ 
.
¬¬ 
	IsSucceed
¬¬ $
)
¬¬$ %
{
√√ 
return
ƒƒ 
RedirectToAction
ƒƒ +
(
ƒƒ+ ,
$str
ƒƒ, 5
,
ƒƒ5 6
new
ƒƒ7 :
{
ƒƒ; <
id
ƒƒ= ?
=
ƒƒ@ A

ModuleData
ƒƒB L
.
ƒƒL M
ModuleId
ƒƒM U
}
ƒƒV W
)
ƒƒW X
;
ƒƒX Y
}
≈≈ 
else
∆∆ 
{
«« 
throw
»» 
new
»» 
	Exception
»» '
(
»»' (
result
»»( .
.
»». /
	Exception
»»/ 8
.
»»8 9

StackTrace
»»9 C
)
»»C D
;
»»D E
}
…… 
}
   
return
ÀÀ 
View
ÀÀ 
(
ÀÀ 

ModuleData
ÀÀ "
)
ÀÀ" #
;
ÀÀ# $
}
ÃÃ 	
[
œœ 	
HttpGet
œœ	 
]
œœ 
[
–– 	
Route
––	 
(
–– 
$str
–– -
)
––- .
]
––. /
public
—— 
async
—— 
Task
—— 
<
—— 
IActionResult
—— '
>
——' (
EditModuleData
——) 7
(
——7 8
int
——8 ;
id
——< >
,
——> ?
string
——@ F
dataId
——G M
)
——M N
{
““ 	
var
”” 

ModuleData
”” 
=
”” 
await
”” "#
BEModuleDataViewModel
””# 8
.
””8 9

Repository
””9 C
.
””C D!
GetSingleModelAsync
””D W
(
””W X
m
‘‘ 
=>
‘‘ 
m
‘‘ 
.
‘‘ 
Id
‘‘ 
==
‘‘ 
dataId
‘‘ #
&&
‘‘$ &
m
‘‘' (
.
‘‘( )
Specificulture
‘‘) 7
==
‘‘8 :
CurrentLanguage
‘‘; J
)
‘‘J K
.
‘‘K L
ConfigureAwait
‘‘L Z
(
‘‘Z [
false
‘‘[ `
)
‘‘` a
;
‘‘a b
var
’’ 
file
’’ 
=
’’ 
FileRepository
’’ %
.
’’% &
Instance
’’& .
.
’’. /

GetWebFile
’’/ 9
(
’’9 :
$str
’’: E
,
’’E F
$str
’’G e
)
’’e f
;
’’f g
if
◊◊ 
(
◊◊ 
!
◊◊ 

ModuleData
◊◊ 
.
◊◊ 
	IsSucceed
◊◊ %
)
◊◊% &
{
ÿÿ 
return
ŸŸ 
RedirectToAction
ŸŸ '
(
ŸŸ' (
$str
ŸŸ( /
)
ŸŸ/ 0
;
ŸŸ0 1
}
⁄⁄ 
return
€€ 
View
€€ 
(
€€ 

ModuleData
€€ "
.
€€" #
Data
€€# '
)
€€' (
;
€€( )
}
‹‹ 	
[
·· 	
Route
··	 
(
·· 
$str
·· -
)
··- .
]
··. /
[
‚‚ 	
HttpPost
‚‚	 
]
‚‚ 
[
„„ 	&
ValidateAntiForgeryToken
„„	 !
]
„„! "
public
‰‰ 
async
‰‰ 
Task
‰‰ 
<
‰‰ 
IActionResult
‰‰ '
>
‰‰' (
EditModuleData
‰‰) 7
(
‰‰7 8#
BEModuleDataViewModel
‰‰8 M

ModuleData
‰‰N X
)
‰‰X Y
{
ÂÂ 	
if
ÊÊ 
(
ÊÊ 

ModelState
ÊÊ 
.
ÊÊ 
IsValid
ÊÊ "
)
ÊÊ" #
{
ÁÁ 
try
ËË 
{
ÈÈ 
var
ÍÍ 
result
ÍÍ 
=
ÍÍ  
await
ÍÍ! &

ModuleData
ÍÍ' 1
.
ÍÍ1 2
SaveModelAsync
ÍÍ2 @
(
ÍÍ@ A
)
ÍÍA B
.
ÍÍB C
ConfigureAwait
ÍÍC Q
(
ÍÍQ R
false
ÍÍR W
)
ÍÍW X
;
ÍÍX Y
if
ÎÎ 
(
ÎÎ 
result
ÎÎ 
.
ÎÎ 
	IsSucceed
ÎÎ (
)
ÎÎ( )
{
ÏÏ 
return
ÌÌ 
RedirectToAction
ÌÌ /
(
ÌÌ/ 0
$str
ÌÌ0 9
,
ÌÌ9 :
new
ÌÌ; >"
RouteValueDictionary
ÌÌ? S
(
ÌÌS T
new
ÓÓ 
{
ÓÓ  !
id
ÓÓ" $
=
ÓÓ% &

ModuleData
ÓÓ' 1
.
ÓÓ1 2
ModuleId
ÓÓ2 :
}
ÓÓ; <
)
ÓÓ< =
)
ÓÓ= >
;
ÓÓ> ?
}
ÔÔ 
else
 
{
ÒÒ 

ModelState
ÚÚ "
.
ÚÚ" #
AddModelError
ÚÚ# 0
(
ÚÚ0 1
string
ÚÚ1 7
.
ÚÚ7 8
Empty
ÚÚ8 =
,
ÚÚ= >
result
ÚÚ? E
.
ÚÚE F
	Exception
ÚÚF O
.
ÚÚO P
Message
ÚÚP W
)
ÚÚW X
;
ÚÚX Y
return
ÛÛ 
View
ÛÛ #
(
ÛÛ# $

ModuleData
ÛÛ$ .
)
ÛÛ. /
;
ÛÛ/ 0
}
ÙÙ 
}
ıı 
catch
ˆˆ 
(
ˆˆ *
DbUpdateConcurrencyException
ˆˆ 3
)
ˆˆ3 4
{
˜˜ 
if
¯¯ 
(
¯¯ 
!
¯¯ %
InfoModuleDataViewModel
¯¯ 0
.
¯¯0 1

Repository
¯¯1 ;
.
¯¯; <
CheckIsExists
¯¯< I
(
¯¯I J
m
˘˘ 
=>
˘˘ 
m
˘˘ 
.
˘˘ 
Id
˘˘ !
==
˘˘" $

ModuleData
˘˘% /
.
˘˘/ 0
Id
˘˘0 2
&&
˘˘3 5
m
˘˘6 7
.
˘˘7 8
Specificulture
˘˘8 F
==
˘˘G I
CurrentLanguage
˘˘J Y
)
˘˘Y Z
)
˘˘Z [
{
˙˙ 
return
˚˚ 
NotFound
˚˚ '
(
˚˚' (
)
˚˚( )
;
˚˚) *
}
¸¸ 
else
˝˝ 
{
˛˛ 
throw
ˇˇ 
;
ˇˇ 
}
ÄÄ 
}
ÅÅ 
}
ÉÉ 
return
ÑÑ 
View
ÑÑ 
(
ÑÑ 

ModuleData
ÑÑ "
)
ÑÑ" #
;
ÑÑ# $
}
ÖÖ 	
[
áá 	
HttpGet
áá	 
]
áá 
[
àà 	
Route
àà	 
(
àà 
$str
àà &
)
àà& '
]
àà' (
public
ââ 
async
ââ 
Task
ââ 
<
ââ 
IActionResult
ââ '
>
ââ' (
DeleteModuleData
ââ) 9
(
ââ9 :
string
ââ: @
id
ââA C
)
ââC D
{
ää 	
var
ãã 
getData
ãã 
=
ãã 
await
ãã %
InfoModuleDataViewModel
ãã  7
.
ãã7 8

Repository
ãã8 B
.
ããB C!
GetSingleModelAsync
ããC V
(
ããV W
m
ããW X
=>
ããY [
m
ãã\ ]
.
ãã] ^
Id
ãã^ `
==
ããa c
id
ããd f
)
ããf g
.
ããg h
ConfigureAwait
ããh v
(
ããv w
false
ããw |
)
ãã| }
;
ãã} ~
if
åå 
(
åå 
getData
åå 
.
åå 
	IsSucceed
åå !
)
åå! "
{
çç 
var
éé 
result
éé 
=
éé 
await
éé "
getData
éé# *
.
éé* +
Data
éé+ /
.
éé/ 0
RemoveModelAsync
éé0 @
(
éé@ A
)
ééA B
.
ééB C
ConfigureAwait
ééC Q
(
ééQ R
false
ééR W
)
ééW X
;
ééX Y
if
èè 
(
èè 
result
èè 
.
èè 
	IsSucceed
èè $
)
èè$ %
{
êê 
return
ëë 
RedirectToAction
ëë +
(
ëë+ ,
$str
ëë, 5
,
ëë5 6
new
ëë7 :"
RouteValueDictionary
ëë; O
(
ëëO P
new
ëëP S
{
íí 
id
ìì 
=
ìì 
getData
ìì $
.
ìì$ %
Data
ìì% )
.
ìì) *
ModuleId
ìì* 2
}
îî 
)
îî 
)
îî 
;
îî 
}
ïï 
else
ññ 
{
óó 
return
òò 
RedirectToAction
òò +
(
òò+ ,
$str
òò, 3
)
òò3 4
;
òò4 5
}
ôô 
}
öö 
else
õõ 
{
úú 
return
ùù 
RedirectToAction
ùù '
(
ùù' (
$str
ùù( /
)
ùù/ 0
;
ùù0 1
}
ûû 
}
üü 	
}
¢¢ 
}££ Öc
iD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\PagesController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str #
)# $
]$ %
public 

class 
PagesController  
:! "
BaseController# 1
<1 2
PagesController2 A
>A B
{ 
public 
PagesController 
( 
IHostingEnvironment 2
env3 6
) 
: 
base 
( 
env 
) 
{ 	
} 	
[ 	
HttpGet	 
] 
[   	
Route  	 
(   
$str   1
)  1 2
]  2 3
[!! 	
Route!!	 
(!! 
$str!! 7
)!!7 8
]!!8 9
public"" 
IActionResult"" 
Index"" "
(""" #
string""# )
keyword""* 1
,""1 2
int""3 6
pageSize""7 ?
=""@ A
$num""B D
,""D E
int""F I
	pageIndex""J S
=""T U
$num""V W
)""W X
{## 	
return** 
View** 
(** 
)** 
;** 
}++ 	
[-- 	
HttpGet--	 
]-- 
[.. 	
Route..	 
(.. 
$str.. 
).. 
].. 
public// 
IActionResult// 
Create// #
(//# $
)//$ %
{00 	
var22 
ttsMenu22 
=22 
new22 
BECategoryViewModel22 1
(221 2
new222 5
SiocCategory226 B
(22B C
)22C D
{33 
Specificulture44 
=44  
CurrentLanguage44! 0
,440 1
	CreatedBy55 
=55 
User55  
.55  !
Identity55! )
.55) *
Name55* .
,55. /
}77 
)77 
;77 
return88 
View88 
(88 
ttsMenu88 
)88  
;88  !
}99 	
[>> 	
Route>>	 
(>> 
$str>> 
)>> 
]>> 
[?? 	
HttpPost??	 
]?? 
[@@ 	$
ValidateAntiForgeryToken@@	 !
]@@! "
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
CreateAA) /
(AA/ 0
BECategoryViewModelAA0 C
menuAAD H
)AAH I
{BB 	
ifCC 
(CC 

ModelStateCC 
.CC 
IsValidCC "
)CC" #
{DD 
varEE 
resultEE 
=EE 
awaitEE "
menuEE# '
.EE' (
SaveModelAsyncEE( 6
(EE6 7
trueEE7 ;
)EE; <
.EE< =
ConfigureAwaitEE= K
(EEK L
falseEEL Q
)EEQ R
;EER S
ifFF 
(FF 
resultFF 
.FF 
	IsSucceedFF $
)FF$ %
{GG 
returnHH 
RedirectToActionHH +
(HH+ ,
$strHH, 3
)HH3 4
;HH4 5
}II 
elseJJ 
{KK 
returnLL 
ViewLL 
(LL  
menuLL  $
)LL$ %
;LL% &
}MM 
}NN 
returnOO 
ViewOO 
(OO 
menuOO 
)OO 
;OO 
}PP 	
[SS 	
HttpGetSS	 
]SS 
[TT 	
RouteTT	 
(TT 
$strTT 
)TT 
]TT 
[UU 	
RouteUU	 
(UU 
$strUU %
)UU% &
]UU& '
publicVV 
asyncVV 
TaskVV 
<VV 
IActionResultVV '
>VV' (
EditVV) -
(VV- .
intVV. 1
?VV1 2
idVV3 5
,VV5 6
stringVV7 =
pageNameVV> F
)VVF G
{WW 	
ifXX 
(XX 
idXX 
==XX 
nullXX 
)XX 
{YY 
returnZZ 
NotFoundZZ 
(ZZ  
)ZZ  !
;ZZ! "
}[[ 
var]] 
getCategory]] 
=]] 
await]] #
BECategoryViewModel]]$ 7
.]]7 8

Repository]]8 B
.]]B C
GetSingleModelAsync]]C V
(]]V W
m^^ 
=>^^ 
m^^ 
.^^ 
Id^^ 
==^^ 
id^^ 
&&^^  "
m^^# $
.^^$ %
Specificulture^^% 3
==^^4 6
CurrentLanguage^^7 F
)__ 
.__ 
ConfigureAwait__  
(__  !
false__! &
)__& '
;__' (
if`` 
(`` 
!`` 
getCategory`` 
.`` 
	IsSucceed`` &
)``& '
{aa 
returnbb 
RedirectToActionbb '
(bb' (
$strbb( /
)bb/ 0
;bb0 1
}cc 
returndd 
Viewdd 
(dd 
getCategorydd #
.dd# $
Datadd$ (
)dd( )
;dd) *
}ee 	
[jj 	
Routejj	 
(jj 
$strjj 
)jj 
]jj 
[kk 	
Routekk	 
(kk 
$strkk %
)kk% &
]kk& '
[ll 	
HttpPostll	 
]ll 
[mm 	$
ValidateAntiForgeryTokenmm	 !
]mm! "
publicnn 
asyncnn 
Tasknn 
<nn 
IActionResultnn '
>nn' (
Editnn) -
(nn- .
intnn. 1
idnn2 4
,nn4 5
BECategoryViewModelnn6 I
ttsMenunnJ Q
)nnQ R
{oo 	
ifpp 
(pp 
idpp 
!=pp 
ttsMenupp 
.pp 
Idpp  
)pp  !
{qq 
returnrr 
NotFoundrr 
(rr  
)rr  !
;rr! "
}ss 
ifuu 
(uu 

ModelStateuu 
.uu 
IsValiduu "
)uu" #
{vv 
tryww 
{xx 
varyy 
resultyy 
=yy  
awaityy! &
ttsMenuyy' .
.yy. /
SaveModelAsyncyy/ =
(yy= >
trueyy> B
)yyB C
.yyC D
ConfigureAwaityyD R
(yyR S
falseyyS X
)yyX Y
;yyY Z
ifzz 
(zz 
resultzz 
.zz 
	IsSucceedzz (
)zz( )
{{{ 
return|| 
RedirectToAction|| /
(||/ 0
$str||0 7
)||7 8
;||8 9
}}} 
else~~ 
{ 

ModelState
ÄÄ "
.
ÄÄ" #
AddModelError
ÄÄ# 0
(
ÄÄ0 1
string
ÄÄ1 7
.
ÄÄ7 8
Empty
ÄÄ8 =
,
ÄÄ= >
result
ÄÄ? E
.
ÄÄE F
	Exception
ÄÄF O
.
ÄÄO P
Message
ÄÄP W
)
ÄÄW X
;
ÄÄX Y
return
ÅÅ 
View
ÅÅ #
(
ÅÅ# $
ttsMenu
ÅÅ$ +
)
ÅÅ+ ,
;
ÅÅ, -
}
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ *
DbUpdateConcurrencyException
ÑÑ 3
)
ÑÑ3 4
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
!
ÜÜ !
BECategoryViewModel
ÜÜ ,
.
ÜÜ, -

Repository
ÜÜ- 7
.
ÜÜ7 8
CheckIsExists
ÜÜ8 E
(
ÜÜE F
m
áá 
=>
áá 
m
áá 
.
áá 
Id
áá !
==
áá" $
ttsMenu
áá% ,
.
áá, -
Id
áá- /
)
áá/ 0
)
áá0 1
{
àà 
return
ââ 
NotFound
ââ '
(
ââ' (
)
ââ( )
;
ââ) *
}
ää 
else
ãã 
{
åå 
throw
çç 
;
çç 
}
éé 
}
èè 
}
ëë 
ViewData
íí 
[
íí 
$str
íí 
]
íí 
=
íí  
$str
íí! '
;
íí' (
ViewData
ìì 
[
ìì 
$str
ìì !
]
ìì! "
=
ìì# $
$str
ìì% ,
;
ìì, -
return
îî 
View
îî 
(
îî 
ttsMenu
îî 
)
îî  
;
îî  !
}
ïï 	
[
óó 	
HttpGet
óó	 
]
óó 
[
òò 	
Route
òò	 
(
òò 
$str
òò 
)
òò 
]
òò 
public
ôô 
async
ôô 
Task
ôô 
<
ôô 
IActionResult
ôô '
>
ôô' (
Delete
ôô) /
(
ôô/ 0
int
ôô0 3
?
ôô3 4
id
ôô5 7
)
ôô7 8
{
öö 	
var
õõ 
ttsMenu
õõ 
=
õõ 
await
õõ !
BECategoryViewModel
õõ  3
.
õõ3 4

Repository
õõ4 >
.
õõ> ?
RemoveModelAsync
õõ? O
(
õõO P
m
úú 
=>
úú 
m
úú 
.
úú 
Id
úú 
==
úú 
id
úú 
&&
úú  "
m
úú# $
.
úú$ %
Specificulture
úú% 3
==
úú4 6
CurrentLanguage
úú7 F
)
úúF G
.
úúG H
ConfigureAwait
úúH V
(
úúV W
false
úúW \
)
úú\ ]
;
úú] ^
return
ùù 
RedirectToAction
ùù #
(
ùù# $
$str
ùù$ +
)
ùù+ ,
;
ùù, -
}
ûû 	
[
†† 	
HttpGet
††	 
]
†† 
[
°° 	
Route
°°	 
(
°° 
$str
°° 
)
°° 
]
°°  
[
¢¢ 	
Route
¢¢	 
(
¢¢ 
$str
¢¢ J
)
¢¢J K
]
¢¢K L
[
££ 	
Route
££	 
(
££ 
$str
££ )
)
££) *
]
££* +
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
IActionResult
§§ '
>
§§' (
Contents
§§) 1
(
§§1 2
int
§§2 5
id
§§6 8
,
§§8 9
string
§§: @
pageName
§§A I
,
•• 
int
•• 
?
•• 
pageSize
•• 
,
•• 
int
••  
?
••  !
	pageIndex
••" +
,
••+ ,
string
••- 3
orderBy
••4 ;
=
••< =
SWCmsConstants
••> L
.
••L M
Default
••M T
.
••T U
OrderBy
••U \
)
••\ ]
{
¶¶ 	
pageSize
ßß 
=
ßß 
pageSize
ßß 
??
ßß  "
SWCmsConstants
ßß# 1
.
ßß1 2
Default
ßß2 9
.
ßß9 :
PageSizeArticle
ßß: I
;
ßßI J
	pageIndex
®® 
=
®® 
	pageIndex
®® !
??
®®" $
$num
®®% &
;
®®& '
var
©© 
articles
©© 
=
©© 
await
©©  "
InfoArticleViewModel
©©! 5
.
©©5 6)
GetModelListByCategoryAsync
©©6 Q
(
©©Q R
id
™™ 
,
™™ 
CurrentLanguage
™™ #
,
™™# $
orderBy
™™% ,
,
™™, -
OrderByDirection
™™. >
.
™™> ?
	Ascending
™™? H
,
™™H I
pageSize
´´ 
,
´´ 
	pageIndex
´´ #
)
´´# $
.
´´$ %
ConfigureAwait
´´% 3
(
´´3 4
false
´´4 9
)
´´9 :
;
´´: ;
if
≠≠ 
(
≠≠ 
!
≠≠ 
articles
≠≠ 
.
≠≠ 
	IsSucceed
≠≠ #
)
≠≠# $
{
ÆÆ 
return
ØØ 
NotFound
ØØ 
(
ØØ  
)
ØØ  !
;
ØØ! "
}
∞∞ 
ViewBag
±± 
.
±± 

categoryId
±± 
=
±±  
id
±±! #
;
±±# $
return
≤≤ 
View
≤≤ 
(
≤≤ 
articles
≤≤  
.
≤≤  !
Data
≤≤! %
)
≤≤% &
;
≤≤& '
}
≥≥ 	
}
¥¥ 
}µµ ˜ê
jD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\PortalController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
PortalController !
:" #
BaseController$ 2
<2 3
PortalController3 C
>C D
{ 
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
private 
readonly 
RoleManager $
<$ %
IdentityRole% 1
>1 2
_roleManager3 ?
;? @
public 
PortalController 
(  
IHostingEnvironment  3
env4 7
,7 8
IConfigurationRoot9 K
configurationL Y
,Y Z
UserManager   
<   
ApplicationUser   '
>  ' (
userManager  ) 4
,  4 5
RoleManager!! 
<!! 
IdentityRole!! $
>!!$ %
roleManager!!& 1
)"" 
:## 
base## 
(## 
env## 
,## 
configuration## %
)##% &
{$$ 	
this%% 
.%% 
_userManager%% 
=%% 
userManager%%  +
;%%+ ,
this&& 
.&& 
_roleManager&& 
=&& 
roleManager&&  +
;&&+ ,
}'' 	
[)) 	
HttpGet))	 
])) 
[** 	
Route**	 
(** 
$str** 
)** 
]** 
public++ 
IActionResult++ 
Index++ "
(++" #
)++# $
{,, 	
return.. 
View.. 
(.. 
).. 
;.. 
}// 	
[11 	
HttpGet11	 
]11 
[22 	
Route22	 
(22 
$str22 
)22 
]22 
public33 
IActionResult33 
Init33 !
(33! "
)33" #
{44 	
var55 
model55 
=55 
new55 
InitCmsViewModel55 ,
(55, -
)55- .
{66 
LocalDbName77 
=77 
$str77 6
,776 7#
LocalDbConnectionString88 '
=88( )
$"88* ,Å
tServer=(localdb)\\mssqllocaldb;Database=aspnet-swastika.Cms.Db;Trusted_Connection=True;MultipleActiveResultSets=true	88, †
"
88† °
}99 
;99 
return:: 
View:: 
(:: 
model:: 
):: 
;:: 
};; 	
[== 	
HttpPost==	 
]== 
[>> 	
Route>>	 
(>> 
$str>> 
)>> 
]>> 
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
Init??) -
(??- .
InitCmsViewModel??. >
model??? D
)??D E
{@@ 	
ifAA 
(AA 

ModelStateAA 
.AA 
IsValidAA "
)AA" #
{BB 
stringCC 
	cnnStringCC  
=CC! "
stringCC# )
.CC) *
EmptyCC* /
;CC/ 0
ifDD 
(DD 
!DD 
modelDD 
.DD 

IsUseLocalDD %
)DD% &
{EE 
	cnnStringFF 
=FF 
stringFF  &
.FF& '
FormatFF' -
(FF- .
$strFF. v
,GG 
modelGG 
.GG 
DataBaseServerGG -
,GG- .
modelGG/ 4
.GG4 5
DataBaseNameGG5 A
,GGA B
modelGGC H
.GGH I
DataBaseUserGGI U
,GGU V
modelGGW \
.GG\ ]
DataBasePasswordGG] m
)GGm n
;GGn o
}HH 
elseII 
{JJ 
	cnnStringKK 
=KK 
modelKK  %
.KK% &#
LocalDbConnectionStringKK& =
;KK= >
}LL 
varMM 
settingsMM 
=MM 
FileRepositoryMM -
.MM- .
InstanceMM. 6
.MM6 7
GetFileMM7 >
(MM> ?
$strMM? L
,MML M
$strMMN U
,MMU V
stringMMW ]
.MM] ^
EmptyMM^ c
,MMc d
trueMMe i
,MMi j
$strMMk o
)MMo p
;MMp q
ifNN 
(NN 
settingsNN 
!=NN 
nullNN  $
)NN$ %
{OO 
JObjectPP 
jsonSettingsPP (
=PP) *
JObjectPP+ 2
.PP2 3
ParsePP3 8
(PP8 9
settingsPP9 A
.PPA B
ContentPPB I
)PPI J
;PPJ K
jsonSettingsQQ  
[QQ  !
$strQQ! 4
]QQ4 5
[QQ5 6
SWCmsConstantsQQ6 D
.QQD E$
CONST_DEFAULT_CONNECTIONQQE ]
]QQ] ^
=QQ_ `
	cnnStringQQa j
;QQj k
jsonSettingsSS  
[SS  !
$strSS! 4
]SS4 5
[SS5 6
$strSS6 I
]SSI J
=SSK L
	cnnStringSSM V
;SSV W
settingsTT 
.TT 
ContentTT $
=TT% &
jsonSettingsTT' 3
.TT3 4
ToStringTT4 <
(TT< =
)TT= >
;TT> ?
FileRepositoryUU "
.UU" #
InstanceUU# +
.UU+ ,
SaveFileUU, 4
(UU4 5
settingsUU5 =
)UU= >
;UU> ?
}VV &
GlobalConfigurationServiceWW *
.WW* +
InstanceWW+ 3
.WW3 4
ConnectionStringWW4 D
=WWE F
	cnnStringWWG P
;WWP Q
varXX 

initResultXX 
=XX  
awaitXX! &&
GlobalConfigurationServiceXX' A
.XXA B
InstanceXXB J
.XXJ K
	InitSWCmsXXK T
(XXT U
_userManagerXXU a
,XXa b
_roleManagerXXc o
)XXo p
;XXp q
ifYY 
(YY 

initResultYY 
.YY 
	IsSucceedYY (
)YY( )
{ZZ 
await]] 
InitRolesAsync]] (
(]]( )
)]]) *
;]]* +
return^^ 
RedirectToAction^^ +
(^^+ ,
$str^^, @
,^^@ A
$str^^B H
,^^H I
new^^J M
{^^N O
culture^^P W
=^^X Y
SWCmsConstants^^Z h
.^^h i
Default^^i p
.^^p q
Specificulture^^q 
}
^^Ä Å
)
^^Å Ç
;
^^Ç É
}__ 
else`` 
{aa 
settingsbb 
=bb 
FileRepositorybb -
.bb- .
Instancebb. 6
.bb6 7
GetFilebb7 >
(bb> ?
$strbb? L
,bbL M
$strbbN U
,bbU V
stringbbW ]
.bb] ^
Emptybb^ c
)bbc d
;bbd e
JObjectcc 
jsonSettingscc (
=cc) *
JObjectcc+ 2
.cc2 3
Parsecc3 8
(cc8 9
settingscc9 A
.ccA B
ContentccB I
)ccI J
;ccJ K
jsonSettingsdd  
[dd  !
$strdd! 4
]dd4 5
[dd5 6
SWCmsConstantsdd6 D
.ddD E$
CONST_DEFAULT_CONNECTIONddE ]
]dd] ^
=dd_ `
nulldda e
;dde f
jsonSettingsee  
[ee  !
$stree! 4
]ee4 5
[ee5 6
$stree6 I
]eeI J
=eeK L
nulleeM Q
;eeQ R
settingsff 
.ff 
Contentff $
=ff% &
jsonSettingsff' 3
.ff3 4
ToStringff4 <
(ff< =
)ff= >
;ff> ?
FileRepositorygg "
.gg" #
Instancegg# +
.gg+ ,
SaveFilegg, 4
(gg4 5
settingsgg5 =
)gg= >
;gg> ?
ifhh 
(hh 

initResulthh "
.hh" #
	Exceptionhh# ,
!=hh- /
nullhh0 4
)hh4 5
{ii 

ModelStatejj "
.jj" #
AddModelErrorjj# 0
(jj0 1
$strjj1 3
,jj3 4

initResultjj5 ?
.jj? @
	Exceptionjj@ I
.jjI J
MessagejjJ Q
)jjQ R
;jjR S
}kk 
foreachll 
(ll 
varll  
itemll! %
inll& (

initResultll) 3
.ll3 4
Errorsll4 :
)ll: ;
{mm 

ModelStatenn "
.nn" #
AddModelErrornn# 0
(nn0 1
$strnn1 3
,nn3 4
itemnn5 9
)nn9 :
;nn: ;
}oo 
}pp 
}qq 
returnrr 
Viewrr 
(rr 
modelrr 
)rr 
;rr 
}ss 	
privateuu 
asyncuu 
Taskuu 
<uu 
booluu 
>uu  
InitRolesAsyncuu! /
(uu/ 0
)uu0 1
{vv 	
boolww 
	isSucceedww 
=ww 
trueww !
;ww! "
varxx 
getRolesxx 
=xx 
awaitxx  
RoleViewModelxx! .
.xx. /

Repositoryxx/ 9
.xx9 :
GetModelListAsyncxx: K
(xxK L
)xxL M
;xxM N
ifyy 
(yy 
getRolesyy 
.yy 
	IsSucceedyy "
&&yy# %
getRolesyy& .
.yy. /
Datayy/ 3
.yy3 4
Countyy4 9
==yy: <
$numyy= >
)yy> ?
{zz 
var{{ 

saveResult{{ 
={{  
await{{! &
_roleManager{{' 3
.{{3 4
CreateAsync{{4 ?
({{? @
new{{@ C
IdentityRole{{D P
({{P Q
){{Q R
{|| 
Id}} 
=}} 
Guid}} 
.}} 
NewGuid}} %
(}}% &
)}}& '
.}}' (
ToString}}( 0
(}}0 1
)}}1 2
,}}2 3
Name~~ 
=~~ 
$str~~ '
} 
) 
; 
	isSucceed
ÄÄ 
=
ÄÄ 

saveResult
ÄÄ &
.
ÄÄ& '
	Succeeded
ÄÄ' 0
;
ÄÄ0 1
}
ÅÅ 
return
ÇÇ 
	isSucceed
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
[
ãã 	
HttpGet
ãã	 
,
ãã 
HttpPost
ãã 
]
ãã 
[
åå 	
Route
åå	 
(
åå 
$str
åå 
)
åå 
]
åå 
public
çç 
async
çç 
Task
çç 
<
çç 
IActionResult
çç '
>
çç' (
Search
çç) /
(
çç/ 0
string
çç0 6
keyword
çç7 >
,
çç> ?
SWCmsConstants
çç@ N
.
ççN O

SearchType
ççO Y

searchType
ççZ d
)
ççd e
{
éé 	
switch
èè 
(
èè 

searchType
èè 
)
èè 
{
êê 
case
ëë 
SWCmsConstants
ëë #
.
ëë# $

SearchType
ëë$ .
.
ëë. /
All
ëë/ 2
:
ëë2 3
ViewData
íí 
[
íí 
$str
íí '
]
íí' (
=
íí) *
(
íí+ ,
await
íí, 1"
InfoArticleViewModel
íí2 F
.
ííF G

Repository
ííG Q
.
ííQ R!
GetModelListByAsync
ííR e
(
ííe f
c
ìì 
=>
ìì 
c
ìì 
.
ìì 
Specificulture
ìì -
==
ìì. 0
CurrentLanguage
ìì1 @
&&
ììA C
(
ììD E
c
ììE F
.
ììF G
Title
ììG L
.
ììL M
Contains
ììM U
(
ììU V
keyword
ììV ]
)
ìì] ^
||
ìì_ a
c
ììb c
.
ììc d
Excerpt
ììd k
.
ììk l
Contains
ììl t
(
ììt u
keyword
ììu |
)
ìì| }
||ìì~ Ä
cììÅ Ç
.ììÇ É
ContentììÉ ä
.ììä ã
Containsììã ì
(ììì î
keywordììî õ
)ììõ ú
)ììú ù
)ììù û
.ììû ü
ConfigureAwaitììü ≠
(ìì≠ Æ
falseììÆ ≥
)ìì≥ ¥
)
îî 
.
îî 
Data
îî 
;
îî 
ViewData
ïï 
[
ïï 
$str
ïï $
]
ïï$ %
=
ïï& '
(
ïï( )#
InfoCategoryViewModel
ïï) >
.
ïï> ?

Repository
ïï? I
.
ïïI J
GetModelListBy
ïïJ X
(
ïïX Y
c
ññ 
=>
ññ 
c
ññ 
.
ññ 
Specificulture
ññ -
==
ññ. 0
CurrentLanguage
ññ1 @
&&
óó 
(
óó 
c
óó 
.
óó 
Title
óó #
.
óó# $
Contains
óó$ ,
(
óó, -
keyword
óó- 4
)
óó4 5
||
óó6 8
c
óó9 :
.
óó: ;
Excerpt
óó; B
.
óóB C
Contains
óóC K
(
óóK L
keyword
óóL S
)
óóS T
)
óóT U
)
óóU V
)
òò 
.
òò 
Data
òò 
;
òò 
ViewData
ôô 
[
ôô 
$str
ôô &
]
ôô& '
=
ôô( )
(
ôô* +!
InfoModuleViewModel
ôô+ >
.
ôô> ?

Repository
ôô? I
.
ôôI J
GetModelListBy
ôôJ X
(
ôôX Y
c
öö 
=>
öö 
c
öö 
.
öö 
Specificulture
öö -
==
öö. 0
CurrentLanguage
öö1 @
&&
ööA C
(
ööD E
c
ööE F
.
ööF G
Title
ööG L
.
ööL M
Contains
ööM U
(
ööU V
keyword
ööV ]
)
öö] ^
||
õõ 
c
õõ 
.
õõ 
Description
õõ (
.
õõ( )
Contains
õõ) 1
(
õõ1 2
keyword
õõ2 9
)
õõ9 :
)
õõ: ;
)
õõ; <
)
úú 
.
úú 
Data
úú 
;
úú 
break
ùù 
;
ùù 
case
üü 
SWCmsConstants
üü #
.
üü# $

SearchType
üü$ .
.
üü. /
Article
üü/ 6
:
üü6 7
ViewData
†† 
[
†† 
$str
†† '
]
††' (
=
††) *
(
††+ ,
await
††, 1"
InfoArticleViewModel
††2 F
.
††F G

Repository
††G Q
.
††Q R!
GetModelListByAsync
††R e
(
††e f
c
°° 
=>
°° 
c
°° 
.
°° 
Specificulture
°° -
==
°°. 0
CurrentLanguage
°°1 @
&&
°°A C
(
°°D E
c
°°E F
.
°°F G
Title
°°G L
.
°°L M
Contains
°°M U
(
°°U V
keyword
°°V ]
)
°°] ^
||
°°_ a
c
°°b c
.
°°c d
Excerpt
°°d k
.
°°k l
Contains
°°l t
(
°°t u
keyword
°°u |
)
°°| }
||°°~ Ä
c°°Å Ç
.°°Ç É
Content°°É ä
.°°ä ã
Contains°°ã ì
(°°ì î
keyword°°î õ
)°°õ ú
)°°ú ù
)°°ù û
.°°û ü
ConfigureAwait°°ü ≠
(°°≠ Æ
false°°Æ ≥
)°°≥ ¥
)
¢¢ 
.
¢¢ 
Data
¢¢ 
;
¢¢ 
break
££ 
;
££ 
case
•• 
SWCmsConstants
•• #
.
••# $

SearchType
••$ .
.
••. /
Module
••/ 5
:
••5 6
ViewData
¶¶ 
[
¶¶ 
$str
¶¶ &
]
¶¶& '
=
¶¶( )
(
¶¶* +!
InfoModuleViewModel
¶¶+ >
.
¶¶> ?

Repository
¶¶? I
.
¶¶I J
GetModelListBy
¶¶J X
(
¶¶X Y
c
ßß 
=>
ßß 
c
ßß 
.
ßß 
Specificulture
ßß -
==
ßß. 0
CurrentLanguage
ßß1 @
&&
ßßA C
(
ßßD E
c
ßßE F
.
ßßF G
Title
ßßG L
.
ßßL M
Contains
ßßM U
(
ßßU V
keyword
ßßV ]
)
ßß] ^
||
ßß_ a
c
ßßb c
.
ßßc d
Description
ßßd o
.
ßßo p
Contains
ßßp x
(
ßßx y
keywordßßy Ä
)ßßÄ Å
)ßßÅ Ç
)ßßÇ É
)
®® 
.
®® 
Data
®® 
;
®® 
break
©© 
;
©© 
case
´´ 
SWCmsConstants
´´ #
.
´´# $

SearchType
´´$ .
.
´´. /
Page
´´/ 3
:
´´3 4
ViewData
¨¨ 
[
¨¨ 
$str
¨¨ $
]
¨¨$ %
=
¨¨& '
(
¨¨( )#
InfoCategoryViewModel
¨¨) >
.
¨¨> ?

Repository
¨¨? I
.
¨¨I J
GetModelListBy
¨¨J X
(
¨¨X Y
c
≠≠ 
=>
≠≠ 
c
≠≠ 
.
≠≠ 
Specificulture
≠≠ -
==
≠≠. 0
CurrentLanguage
≠≠1 @
&&
ÆÆ 
(
ÆÆ 
c
ÆÆ 
.
ÆÆ 
Title
ÆÆ #
.
ÆÆ# $
Contains
ÆÆ$ ,
(
ÆÆ, -
keyword
ÆÆ- 4
)
ÆÆ4 5
||
ÆÆ6 8
c
ÆÆ9 :
.
ÆÆ: ;
Excerpt
ÆÆ; B
.
ÆÆB C
Contains
ÆÆC K
(
ÆÆK L
keyword
ÆÆL S
)
ÆÆS T
)
ÆÆT U
)
ÆÆU V
)
ØØ 
.
ØØ 
Data
ØØ 
;
ØØ 
break
∞∞ 
;
∞∞ 
default
≤≤ 
:
≤≤ 
break
≥≥ 
;
≥≥ 
}
¥¥ 
ViewBag
µµ 
.
µµ 

searchType
µµ 
=
µµ  

searchType
µµ! +
;
µµ+ ,
return
∂∂ 
View
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
}
∑∑ 	
}
∏∏ 
}ππ ¢∑
kD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\ProductController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str %
)% &
]& '
public 

class 
ProductController "
:# $
BaseController% 3
<3 4
ProductController4 E
>E F
{ 
public 
ProductController  
(  !
IHostingEnvironment! 4
env5 8
) 
: 
base 
( 
env 
) 
{ 	
}   	
[## 	
HttpPost##	 
,## 
HttpGet## 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
[%% 	
Route%%	 
(%% 
$str%% 
)%% 
]%% 
[&& 	
Route&&	 
(&& 
$str&& ;
)&&; <
]&&< =
['' 	
Route''	 
('' 
$str'' 1
)''1 2
]''2 3
[(( 	
Route((	 
((( 
$str(( A
)((A B
]((B C
[)) 	
Route))	 
()) 
$str)) 7
)))7 8
]))8 9
public** 
async** 
Task** 
<** 
IActionResult** '
>**' (
Index**) .
(**. /
int**/ 2
pageSize**3 ;
=**< =
$num**> @
,**@ A
int**B E
	pageIndex**F O
=**P Q
$num**R S
,**S T
string**U [
keyword**\ c
=**d e
null**f j
)**j k
{++ 	
RepositoryResponse,, 
<,, 
PaginationModel,, .
<,,. / 
InfoProductViewModel,,/ C
>,,C D
>,,D E

getProduct,,F P
=,,Q R
await--  
InfoProductViewModel-- *
.--* +

Repository--+ 5
.--5 6
GetModelListByAsync--6 I
(--I J
product.. 
=>.. 
product.. "
..." #
Specificulture..# 1
==..2 4
CurrentLanguage..5 D
&&// 
product// 
.// 
Status// %
!=//& (
(//) *
int//* -
)//- .
SWStatus//. 6
.//6 7
Deleted//7 >
&&00 
(00 
string00 
.00 
IsNullOrEmpty00 ,
(00, -
keyword00- 4
)004 5
||006 8
product009 @
.00@ A
Title00A F
.00F G
Contains00G O
(00O P
keyword00P W
)00W X
)00X Y
,00Y Z
$str11 
,11 
OrderByDirection11 ,
.11, -
	Ascending11- 6
,22 
pageSize22 
,22 
	pageIndex22 %
)22% &
.22& '
ConfigureAwait22' 5
(225 6
false226 ;
)22; <
;22< =
ViewBag33 
.33 
keyword33 
=33 
keyword33 %
;33% &
return44 
View44 
(44 

getProduct44 "
.44" #
Data44# '
)44' (
;44( )
}55 	
[88 	
HttpGet88	 
]88 
[99 	
Route99	 
(99 
$str99 
)99 
]99 
[:: 	
Route::	 
(:: 
$str:: A
)::A B
]::B C
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
Draft;;) .
(;;. /
int;;/ 2
pageSize;;3 ;
=;;< =
$num;;> @
,;;@ A
int;;B E
	pageIndex;;F O
=;;P Q
$num;;R S
,;;S T
string;;U [
keyword;;\ c
=;;d e
null;;f j
);;j k
{<< 	
var== 

getProduct== 
=== 
await== " 
InfoProductViewModel==# 7
.==7 8

Repository==8 B
.==B C
GetModelListByAsync==C V
(==V W
product>> 
=>>> 
product>> "
.>>" #
Specificulture>># 1
==>>2 4
CurrentLanguage>>5 D
&&?? 
(?? 
string?? 
.?? 
IsNullOrEmpty?? ,
(??, -
keyword??- 4
)??4 5
||??6 8
product??9 @
.??@ A
Title??A F
.??F G
Contains??G O
(??O P
keyword??P W
)??W X
)??X Y
&&@@ 
product@@ 
.@@ 
Status@@ %
==@@& (
(@@) *
int@@* -
)@@- .
SWStatus@@. 6
.@@6 7
Deleted@@7 >
,@@> ?
$strAA !
,AA! "
OrderByDirectionAA# 3
.AA3 4

DescendingAA4 >
,AA> ?
pageSizeBB 
,BB 
	pageIndexBB #
)BB# $
.BB$ %
ConfigureAwaitBB% 3
(BB3 4
falseBB4 9
)BB9 :
;BB: ;
returnDD 
ViewDD 
(DD 

getProductDD "
.DD" #
DataDD# '
)DD' (
;DD( )
}EE 	
[HH 	
HttpGetHH	 
]HH 
[II 	
RouteII	 
(II 
$strII 
)II 
]II 
[JJ 	
RouteJJ	 
(JJ 
$strJJ (
)JJ( )
]JJ) *
publicKK 
IActionResultKK 
CreateKK #
(KK# $
intKK$ '
?KK' (

categoryIdKK) 3
=KK4 5
nullKK6 :
)KK: ;
{LL 	
varMM 
	vmProductMM 
=MM 
newMM 
BEProductViewModelMM  2
(MM2 3
newMM3 6
SiocProductMM7 B
(MMB C
)MMC D
{NN 
IdOO 
=OO 
GuidOO 
.OO 
NewGuidOO !
(OO! "
)OO" #
.OO# $
ToStringOO$ ,
(OO, -
)OO- .
,OO. /
SpecificulturePP 
=PP  
CurrentLanguagePP! 0
,PP0 1
	CreatedByQQ 
=QQ 
UserQQ  
.QQ  !
IdentityQQ! )
.QQ) *
NameQQ* .
,QQ. /
CreatedDateTimeRR 
=RR  !
DateTimeRR" *
.RR* +
UtcNowRR+ 1
}SS 
)SS 
{TT 
StatusUU 
=UU 
SWStatusUU !
.UU! "
	PublishedUU" +
}VV 
;VV 
ifWW 
(WW 

categoryIdWW 
.WW 
HasValueWW #
)WW# $
{XX 
varYY 

activeCateYY 
=YY  
	vmProductYY! *
.YY* +

CategoriesYY+ 5
.YY5 6
FindYY6 :
(YY: ;
cYY; <
=>YY= ?
cYY@ A
.YYA B

CategoryIdYYB L
==YYM O

categoryIdYYP Z
)YYZ [
;YY[ \
ifZZ 
(ZZ 

activeCateZZ 
!=ZZ !
nullZZ" &
)ZZ& '
{[[ 

activeCate\\ 
.\\ 
	IsActived\\ (
=\\) *
true\\+ /
;\\/ 0
}]] 
}^^ 
ViewBag__ 
.__ 

categoryId__ 
=__  

categoryId__! +
;__+ ,
return`` 
View`` 
(`` 
	vmProduct`` !
)``! "
;``" #
}aa 	
[ff 	
Routeff	 
(ff 
$strff 
)ff 
]ff 
[gg 	
Routegg	 
(gg 
$strgg (
)gg( )
]gg) *
[hh 	
HttpPosthh	 
]hh 
[ii 	$
ValidateAntiForgeryTokenii	 !
]ii! "
publicjj 
asyncjj 
Taskjj 
<jj 
IActionResultjj '
>jj' (
Createjj) /
(jj/ 0
BEProductViewModeljj0 B
productjjC J
,jjJ K
intjjL O
?jjO P

categoryIdjjQ [
=jj\ ]
nulljj^ b
)jjb c
{kk 	
ifll 
(ll 

ModelStatell 
.ll 
IsValidll "
)ll" #
{mm 
varpp 
resultpp 
=pp 
awaitpp "
productpp# *
.pp* +
SaveModelAsyncpp+ 9
(pp9 :
truepp: >
)pp> ?
.pp? @
ConfigureAwaitpp@ N
(ppN O
falseppO T
)ppT U
;ppU V
ifqq 
(qq 
resultqq 
.qq 
	IsSucceedqq $
)qq$ %
{rr 
ifss 
(ss 

categoryIdss "
.ss" #
HasValuess# +
)ss+ ,
{tt 
returnuu 
RedirectToActionuu /
(uu/ 0
$struu0 :
,uu: ;
$struu< C
,uuC D
newuuE H
{uuI J
iduuK M
=uuN O

categoryIduuP Z
}uu[ \
)uu\ ]
;uu] ^
}vv 
elseww 
{xx 
returnyy 
RedirectToActionyy /
(yy/ 0
$stryy0 7
)yy7 8
;yy8 9
}zz 
}{{ 
else|| 
{}} 
return~~ 
View~~ 
(~~  
product~~  '
)~~' (
;~~( )
} 
}
ÄÄ 
ViewBag
ÅÅ 
.
ÅÅ 

categoryId
ÅÅ 
=
ÅÅ  

categoryId
ÅÅ! +
;
ÅÅ+ ,
return
ÇÇ 
View
ÇÇ 
(
ÇÇ 
product
ÇÇ 
)
ÇÇ  
;
ÇÇ  !
}
ÉÉ 	
[
ÜÜ 	
HttpGet
ÜÜ	 
]
ÜÜ 
[
áá 	
Route
áá	 
(
áá 
$str
áá 
)
áá 
]
áá 
[
àà 	
Route
àà	 
(
àà 
$str
àà +
)
àà+ ,
]
àà, -
public
ââ 
async
ââ 
Task
ââ 
<
ââ 
IActionResult
ââ '
>
ââ' (
Edit
ââ) -
(
ââ- .
string
ââ. 4
id
ââ5 7
=
ââ8 9
null
ââ: >
,
ââ> ?
int
ââ@ C
?
ââC D

categoryId
ââE O
=
ââP Q
null
ââR V
)
ââV W
{
ää 	
return
òò 
View
òò 
(
òò 
)
òò 
;
òò 
}
ôô 	
[
ûû 	
Route
ûû	 
(
ûû 
$str
ûû 
)
ûû 
]
ûû 
[
üü 	
Route
üü	 
(
üü 
$str
üü +
)
üü+ ,
]
üü, -
[
†† 	
HttpPost
††	 
]
†† 
[
°° 	&
ValidateAntiForgeryToken
°°	 !
]
°°! "
public
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
IActionResult
¢¢ '
>
¢¢' (
Edit
¢¢) -
(
¢¢- . 
BEProductViewModel
¢¢. @
product
¢¢A H
,
¢¢H I
string
¢¢J P
id
¢¢Q S
,
¢¢S T
int
¢¢U X
?
¢¢X Y

categoryId
¢¢Z d
=
¢¢e f
null
¢¢g k
)
¢¢k l
{
££ 	
if
§§ 
(
§§ 
id
§§ 
!=
§§ 
product
§§ 
.
§§ 
Id
§§  
)
§§  !
{
•• 
return
¶¶ 
NotFound
¶¶ 
(
¶¶  
)
¶¶  !
;
¶¶! "
}
ßß 
if
©© 
(
©© 

ModelState
©© 
.
©© 
IsValid
©© "
)
©©" #
{
™™ 
try
´´ 
{
¨¨ 
var
≠≠ 
result
≠≠ 
=
≠≠  
await
≠≠! &
product
≠≠' .
.
≠≠. /
SaveModelAsync
≠≠/ =
(
≠≠= >
true
≠≠> B
)
≠≠B C
.
≠≠C D
ConfigureAwait
≠≠D R
(
≠≠R S
false
≠≠S X
)
≠≠X Y
;
≠≠Y Z
if
ÆÆ 
(
ÆÆ 
result
ÆÆ 
.
ÆÆ 
	IsSucceed
ÆÆ (
)
ÆÆ( )
{
ØØ 
if
∞∞ 
(
∞∞ 

categoryId
∞∞ &
.
∞∞& '
HasValue
∞∞' /
)
∞∞/ 0
{
±± 
return
≤≤ "
RedirectToAction
≤≤# 3
(
≤≤3 4
$str
≤≤4 >
,
≤≤> ?
$str
≤≤@ G
,
≤≤G H
new
≤≤I L
{
≤≤M N
id
≤≤O Q
=
≤≤R S

categoryId
≤≤T ^
}
≤≤_ `
)
≤≤` a
;
≤≤a b
}
≥≥ 
else
¥¥ 
{
µµ 
return
∂∂ "
RedirectToAction
∂∂# 3
(
∂∂3 4
$str
∂∂4 ;
)
∂∂; <
;
∂∂< =
}
∑∑ 
}
∏∏ 
else
ππ 
{
∫∫ 
if
ªª 
(
ªª 
result
ªª "
.
ªª" #
	Exception
ªª# ,
!=
ªª- /
null
ªª0 4
)
ªª4 5
{
ºº 

ModelState
ΩΩ &
.
ΩΩ& '
AddModelError
ΩΩ' 4
(
ΩΩ4 5
string
ΩΩ5 ;
.
ΩΩ; <
Empty
ΩΩ< A
,
ΩΩA B
result
ΩΩC I
.
ΩΩI J
	Exception
ΩΩJ S
?
ΩΩS T
.
ΩΩT U
Message
ΩΩU \
)
ΩΩ\ ]
;
ΩΩ] ^
}
ææ 
foreach
¿¿ 
(
¿¿  !
var
¿¿! $
error
¿¿% *
in
¿¿+ -
result
¿¿. 4
.
¿¿4 5
Errors
¿¿5 ;
)
¿¿; <
{
¡¡ 

ModelState
¬¬ &
.
¬¬& '
AddModelError
¬¬' 4
(
¬¬4 5
string
¬¬5 ;
.
¬¬; <
Empty
¬¬< A
,
¬¬A B
error
¬¬C H
)
¬¬H I
;
¬¬I J
}
√√ 
return
ƒƒ 
View
ƒƒ #
(
ƒƒ# $
product
ƒƒ$ +
)
ƒƒ+ ,
;
ƒƒ, -
}
≈≈ 
}
∆∆ 
catch
«« 
(
«« *
DbUpdateConcurrencyException
«« 3
)
««3 4
{
»» 
if
…… 
(
…… 
!
……  
BEProductViewModel
…… +
.
……+ ,

Repository
……, 6
.
……6 7
CheckIsExists
……7 D
(
……D E
m
……E F
=>
……G I
m
……J K
.
……K L
Id
……L N
==
……O Q
product
……R Y
.
……Y Z
Id
……Z \
)
……\ ]
)
……] ^
{
   
return
ÀÀ 
NotFound
ÀÀ '
(
ÀÀ' (
)
ÀÀ( )
;
ÀÀ) *
}
ÃÃ 
else
ÕÕ 
{
ŒŒ 
throw
œœ 
;
œœ 
}
–– 
}
—— 
}
”” 
return
‘‘ 
View
‘‘ 
(
‘‘ 
product
‘‘ 
)
‘‘  
;
‘‘  !
}
’’ 	
[
◊◊ 	
HttpGet
◊◊	 
]
◊◊ 
[
ÿÿ 	
Route
ÿÿ	 
(
ÿÿ 
$str
ÿÿ 
)
ÿÿ 
]
ÿÿ 
public
ŸŸ 
async
ŸŸ 
Task
ŸŸ 
<
ŸŸ 
IActionResult
ŸŸ '
>
ŸŸ' (
Recycle
ŸŸ) 0
(
ŸŸ0 1
string
ŸŸ1 7
id
ŸŸ8 :
)
ŸŸ: ;
{
⁄⁄ 	
var
€€ 

getProduct
€€ 
=
€€ "
InfoProductViewModel
€€ 1
.
€€1 2

Repository
€€2 <
.
€€< =
GetSingleModel
€€= K
(
€€K L
a
€€L M
=>
€€N P
a
€€Q R
.
€€R S
Id
€€S U
==
€€V X
id
€€Y [
)
€€[ \
;
€€\ ]
if
‹‹ 
(
‹‹ 

getProduct
‹‹ 
.
‹‹ 
	IsSucceed
‹‹ $
)
‹‹$ %
{
›› 
var
ﬁﬁ "
infoProductViewModel
ﬁﬁ (
=
ﬁﬁ) *

getProduct
ﬁﬁ+ 5
.
ﬁﬁ5 6
Data
ﬁﬁ6 :
;
ﬁﬁ: ;"
infoProductViewModel
ﬂﬂ $
.
ﬂﬂ$ %
Status
ﬂﬂ% +
=
ﬂﬂ, -
SWStatus
ﬂﬂ. 6
.
ﬂﬂ6 7
Deleted
ﬂﬂ7 >
;
ﬂﬂ> ?
var
‡‡ 
result
‡‡ 
=
‡‡ 
await
‡‡ ""
infoProductViewModel
‡‡# 7
.
‡‡7 8
SaveModelAsync
‡‡8 F
(
‡‡F G
)
‡‡G H
.
‡‡H I
ConfigureAwait
‡‡I W
(
‡‡W X
false
‡‡X ]
)
‡‡] ^
;
‡‡^ _
if
·· 
(
·· 
result
·· 
.
·· 
	IsSucceed
·· $
)
··$ %
{
‚‚ 
return
„„ 
RedirectToAction
„„ +
(
„„+ ,
$str
„„, 3
)
„„3 4
;
„„4 5
}
‰‰ 
else
ÂÂ 
{
ÊÊ 
return
ÁÁ 
RedirectToAction
ÁÁ +
(
ÁÁ+ ,
$str
ÁÁ, 3
)
ÁÁ3 4
;
ÁÁ4 5
}
ËË 
}
ÈÈ 
else
ÍÍ 
{
ÎÎ 
return
ÏÏ 
RedirectToAction
ÏÏ '
(
ÏÏ' (
$str
ÏÏ( /
)
ÏÏ/ 0
;
ÏÏ0 1
}
ÌÌ 
}
ÓÓ 	
[
 	
HttpGet
	 
]
 
[
ÒÒ 	
Route
ÒÒ	 
(
ÒÒ 
$str
ÒÒ 
)
ÒÒ 
]
ÒÒ 
public
ÚÚ 
async
ÚÚ 
Task
ÚÚ 
<
ÚÚ 
IActionResult
ÚÚ '
>
ÚÚ' (
Restore
ÚÚ) 0
(
ÚÚ0 1
string
ÚÚ1 7
id
ÚÚ8 :
)
ÚÚ: ;
{
ÛÛ 	
var
ÙÙ 

getProduct
ÙÙ 
=
ÙÙ "
InfoProductViewModel
ÙÙ 1
.
ÙÙ1 2

Repository
ÙÙ2 <
.
ÙÙ< =
GetSingleModel
ÙÙ= K
(
ÙÙK L
a
ÙÙL M
=>
ÙÙN P
a
ÙÙQ R
.
ÙÙR S
Id
ÙÙS U
==
ÙÙV X
id
ÙÙY [
)
ÙÙ[ \
;
ÙÙ\ ]
if
ıı 
(
ıı 

getProduct
ıı 
.
ıı 
	IsSucceed
ıı $
)
ıı$ %
{
ˆˆ 
var
˜˜ "
infoProductViewModel
˜˜ (
=
˜˜) *

getProduct
˜˜+ 5
.
˜˜5 6
Data
˜˜6 :
;
˜˜: ;"
infoProductViewModel
¯¯ $
.
¯¯$ %
Status
¯¯% +
=
¯¯, -
SWStatus
¯¯. 6
.
¯¯6 7
Preview
¯¯7 >
;
¯¯> ?
var
˘˘ 
result
˘˘ 
=
˘˘ 
await
˘˘ ""
infoProductViewModel
˘˘# 7
.
˘˘7 8
SaveModelAsync
˘˘8 F
(
˘˘F G
)
˘˘G H
.
˘˘H I
ConfigureAwait
˘˘I W
(
˘˘W X
false
˘˘X ]
)
˘˘] ^
;
˘˘^ _
if
˙˙ 
(
˙˙ 
result
˙˙ 
.
˙˙ 
	IsSucceed
˙˙ $
)
˙˙$ %
{
˚˚ 
return
¸¸ 
RedirectToAction
¸¸ +
(
¸¸+ ,
$str
¸¸, 3
)
¸¸3 4
;
¸¸4 5
}
˝˝ 
else
˛˛ 
{
ˇˇ 
return
ÄÄ 
RedirectToAction
ÄÄ +
(
ÄÄ+ ,
$str
ÄÄ, 3
)
ÄÄ3 4
;
ÄÄ4 5
}
ÅÅ 
}
ÇÇ 
else
ÉÉ 
{
ÑÑ 
return
ÖÖ 
RedirectToAction
ÖÖ '
(
ÖÖ' (
$str
ÖÖ( /
)
ÖÖ/ 0
;
ÖÖ0 1
}
ÜÜ 
}
áá 	
[
ââ 	
HttpGet
ââ	 
]
ââ 
[
ää 	
Route
ää	 
(
ää 
$str
ää 
)
ää 
]
ää 
public
ãã 
async
ãã 
Task
ãã 
<
ãã 
IActionResult
ãã '
>
ãã' (
Delete
ãã) /
(
ãã/ 0
string
ãã0 6
id
ãã7 9
)
ãã9 :
{
åå 	
var
çç 

getProduct
çç 
=
çç 
await
çç " 
BEProductViewModel
çç# 5
.
çç5 6

Repository
çç6 @
.
çç@ A!
GetSingleModelAsync
ççA T
(
ççT U
m
ççU V
=>
ççW Y
m
ççZ [
.
çç[ \
Id
çç\ ^
==
çç_ a
id
ççb d
&&
ççe g
m
ççh i
.
ççi j
Specificulture
ççj x
==
ççy {
CurrentLanguageçç| ã
)ççã å
.ççå ç
ConfigureAwaitççç õ
(ççõ ú
falseççú °
)çç° ¢
;çç¢ £
if
éé 
(
éé 

getProduct
éé 
.
éé 
	IsSucceed
éé $
)
éé$ %
{
èè 
await
êê 

getProduct
êê  
.
êê  !
Data
êê! %
.
êê% &
RemoveModelAsync
êê& 6
(
êê6 7
true
êê7 ;
)
êê; <
.
êê< =
ConfigureAwait
êê= K
(
êêK L
false
êêL Q
)
êêQ R
;
êêR S
}
ëë 
return
íí 
RedirectToAction
íí #
(
íí# $
$str
íí$ +
,
íí+ ,
$str
íí- 6
)
íí6 7
;
íí7 8
}
ìì 	
[
ïï 	
HttpGet
ïï	 
]
ïï 
[
ññ 	
Route
ññ	 
(
ññ 
$str
ññ )
)
ññ) *
]
ññ* +
public
óó 
IActionResult
óó 
AddEmptyProperty
óó -
(
óó- .
int
óó. 1
index
óó2 7
)
óó7 8
{
òò 	
ViewData
ôô 
[
ôô 
$str
ôô 
]
ôô 
=
ôô 
index
ôô  %
;
ôô% &
return
öö 
PartialView
öö 
(
öö 
new
öö "
ExtraProperty
öö# 0
(
öö0 1
)
öö1 2
)
öö2 3
;
öö3 4
}
õõ 	
[
ùù 	
HttpPost
ùù	 
]
ùù 
[
ûû 	
Route
ûû	 
(
ûû 
$str
ûû 
)
ûû 
]
ûû 
public
üü 
IActionResult
üü 
	GetEditor
üü &
(
üü& '
int
üü' *
index
üü+ 0
,
üü0 1
SWCmsConstants
üü2 @
.
üü@ A
DataType
üüA I
type
üüJ N
,
üüN O
string
üüP V
id
üüW Y
,
üüY Z
string
üü[ a
name
üüb f
,
üüf g
string
üüh n
value
üüo t
)
üüt u
{
†† 	
ViewData
°° 
[
°° 
$str
°° 
]
°° 
=
°° 
id
°° 
;
°°  
ViewData
¢¢ 
[
¢¢ 
$str
¢¢ 
]
¢¢ 
=
¢¢ 
name
¢¢ #
;
¢¢# $
ViewData
££ 
[
££ 
$str
££ 
]
££  
=
££! "
type
££# '
;
££' (
ViewData
§§ 
[
§§ 
$str
§§ 
]
§§ 
=
§§ 
value
§§  %
;
§§% &
ViewData
•• 
[
•• 
$str
•• 
]
•• 
=
•• 
index
••  %
;
••% &
return
¶¶ 
PartialView
¶¶ 
(
¶¶ 
$str
¶¶ (
)
¶¶( )
;
¶¶) *
}
ßß 	
}
®® 
}©© ù®
kD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\ProfileController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
ProfileController "
:# $

Controller% /
{ 
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
private 
readonly 
SignInManager &
<& '
ApplicationUser' 6
>6 7
_signInManager8 F
;F G
private 
readonly 
IEmailSender %
_emailSender& 2
;2 3
private 
readonly 

ISmsSender #

_smsSender$ .
;. /
private 
readonly 
ILogger  
_logger! (
;( )
public 
ProfileController  
(  !
UserManager
 
< 
ApplicationUser %
>% &
userManager' 2
,2 3
SignInManager
 
< 
ApplicationUser '
>' (
signInManager) 6
,6 7
IEmailSender  
 
emailSender   "
,  " #

ISmsSender!!
 
	smsSender!! 
,!! 
ILoggerFactory""
 
loggerFactory"" &
)""& '
{## 	
_userManager$$ 
=$$ 
userManager$$ &
;$$& '
_signInManager%% 
=%% 
signInManager%% *
;%%* +
_emailSender&& 
=&& 
emailSender&& &
;&&& '

_smsSender'' 
='' 
	smsSender'' "
;''" #
_logger(( 
=(( 
loggerFactory(( #
.((# $
CreateLogger(($ 0
<((0 1
ProfileController((1 B
>((B C
(((C D
)((D E
;((E F
})) 	
[-- 	
HttpGet--	 
]-- 
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' (
Index..) .
(... /
ManageMessageId../ >
?..> ?
message..@ G
=..H I
null..J N
)..N O
{// 	
ViewData00 
[00 
$str00 $
]00$ %
=00& '
message11 
==11 
ManageMessageId11 *
.11* +!
ChangePasswordSuccess11+ @
?11A B
$str11C d
:22 
message22 
==22 
ManageMessageId22 ,
.22, -
SetPasswordSuccess22- ?
?22@ A
$str22B _
:33 
message33 
==33 
ManageMessageId33 ,
.33, -
SetTwoFactorSuccess33- @
?33A B
$str33C z
:44 
message44 
==44 
ManageMessageId44 ,
.44, -
Error44- 2
?443 4
$str445 M
:55 
message55 
==55 
ManageMessageId55 ,
.55, -
AddPhoneSuccess55- <
?55= >
$str55? ]
:66 
message66 
==66 
ManageMessageId66 ,
.66, -
RemovePhoneSuccess66- ?
?66@ A
$str66B b
:77 
$str77 
;77 
var99 
user99 
=99 
await99 
GetCurrentUserAsync99 0
(990 1
)991 2
.992 3
ConfigureAwait993 A
(99A B
false99B G
)99G H
;99H I
if:: 
(:: 
user:: 
==:: 
null:: 
):: 
{;; 
return<< 
View<< 
(<< 
$str<< #
)<<# $
;<<$ %
}== 
var>> 
model>> 
=>> 
new>> 
IndexViewModel>> *
{?? 
HasPassword@@ 
=@@ 
await@@ #
_userManager@@$ 0
.@@0 1
HasPasswordAsync@@1 A
(@@A B
user@@B F
)@@F G
.@@G H
ConfigureAwait@@H V
(@@V W
false@@W \
)@@\ ]
,@@] ^
PhoneNumberAA 
=AA 
awaitAA #
_userManagerAA$ 0
.AA0 1
GetPhoneNumberAsyncAA1 D
(AAD E
userAAE I
)AAI J
.AAJ K
ConfigureAwaitAAK Y
(AAY Z
falseAAZ _
)AA_ `
,AA` a
	TwoFactorBB 
=BB 
awaitBB !
_userManagerBB" .
.BB. /$
GetTwoFactorEnabledAsyncBB/ G
(BBG H
userBBH L
)BBL M
.BBM N
ConfigureAwaitBBN \
(BB\ ]
falseBB] b
)BBb c
,BBc d
LoginsCC 
=CC 
awaitCC 
_userManagerCC +
.CC+ ,
GetLoginsAsyncCC, :
(CC: ;
userCC; ?
)CC? @
.CC@ A
ConfigureAwaitCCA O
(CCO P
falseCCP U
)CCU V
,CCV W
BrowserRememberedDD !
=DD" #
awaitDD$ )
_signInManagerDD* 8
.DD8 9,
 IsTwoFactorClientRememberedAsyncDD9 Y
(DDY Z
userDDZ ^
)DD^ _
.DD_ `
ConfigureAwaitDD` n
(DDn o
falseDDo t
)DDt u
}EE 
;EE 
returnFF 
ViewFF 
(FF 
modelFF 
)FF 
;FF 
}GG 	
[KK 	
HttpPostKK	 
]KK 
[LL 	$
ValidateAntiForgeryTokenLL	 !
]LL! "
publicMM 
asyncMM 
TaskMM 
<MM 
IActionResultMM '
>MM' (
RemoveLoginMM) 4
(MM4 5 
RemoveLoginViewModelMM5 I
accountMMJ Q
)MMQ R
{NN 	
ManageMessageIdOO 
?OO 
messageOO $
=OO% &
ManageMessageIdOO' 6
.OO6 7
ErrorOO7 <
;OO< =
varPP 
userPP 
=PP 
awaitPP 
GetCurrentUserAsyncPP 0
(PP0 1
)PP1 2
.PP2 3
ConfigureAwaitPP3 A
(PPA B
falsePPB G
)PPG H
;PPH I
ifQQ 
(QQ 
userQQ 
!=QQ 
nullQQ 
)QQ 
{RR 
varSS 
resultSS 
=SS 
awaitSS "
_userManagerSS# /
.SS/ 0
RemoveLoginAsyncSS0 @
(SS@ A
userSSA E
,SSE F
accountSSG N
.SSN O
LoginProviderSSO \
,SS\ ]
accountSS^ e
.SSe f
ProviderKeySSf q
)SSq r
.SSr s
ConfigureAwait	SSs Å
(
SSÅ Ç
false
SSÇ á
)
SSá à
;
SSà â
ifTT 
(TT 
resultTT 
.TT 
	SucceededTT $
)TT$ %
{UU 
awaitVV 
_signInManagerVV (
.VV( )
SignInAsyncVV) 4
(VV4 5
userVV5 9
,VV9 :
isPersistentVV; G
:VVG H
falseVVI N
)VVN O
.VVO P
ConfigureAwaitVVP ^
(VV^ _
falseVV_ d
)VVd e
;VVe f
messageWW 
=WW 
ManageMessageIdWW -
.WW- .
RemoveLoginSuccessWW. @
;WW@ A
}XX 
}YY 
returnZZ 
RedirectToActionZZ #
(ZZ# $
nameofZZ$ *
(ZZ* +
ManageLoginsZZ+ 7
)ZZ7 8
,ZZ8 9
newZZ: =
{ZZ> ?
MessageZZ@ G
=ZZH I
messageZZJ Q
}ZZR S
)ZZS T
;ZZT U
}[[ 	
public__ 
IActionResult__ 
AddPhoneNumber__ +
(__+ ,
)__, -
{`` 	
returnaa 
Viewaa 
(aa 
)aa 
;aa 
}bb 	
[ff 	
HttpPostff	 
]ff 
[gg 	$
ValidateAntiForgeryTokengg	 !
]gg! "
publichh 
asynchh 
Taskhh 
<hh 
IActionResulthh '
>hh' (
AddPhoneNumberhh) 7
(hh7 8#
AddPhoneNumberViewModelhh8 O
modelhhP U
)hhU V
{ii 	
ifjj 
(jj 
!jj 

ModelStatejj 
.jj 
IsValidjj #
)jj# $
{kk 
returnll 
Viewll 
(ll 
modelll !
)ll! "
;ll" #
}mm 
varoo 
useroo 
=oo 
awaitoo 
GetCurrentUserAsyncoo 0
(oo0 1
)oo1 2
.oo2 3
ConfigureAwaitoo3 A
(ooA B
falseooB G
)ooG H
;ooH I
ifpp 
(pp 
userpp 
==pp 
nullpp 
)pp 
{qq 
returnrr 
Viewrr 
(rr 
$strrr #
)rr# $
;rr$ %
}ss 
vartt 
codett 
=tt 
awaittt 
_userManagertt )
.tt) */
#GenerateChangePhoneNumberTokenAsynctt* M
(ttM N
userttN R
,ttR S
modelttT Y
.ttY Z
PhoneNumberttZ e
)tte f
.ttf g
ConfigureAwaitttg u
(ttu v
falsettv {
)tt{ |
;tt| }
awaituu 

_smsSenderuu 
.uu 
SendSmsAsyncuu )
(uu) *
modeluu* /
.uu/ 0
PhoneNumberuu0 ;
,uu; <
$struu= V
+uuW X
codeuuY ]
)uu] ^
.uu^ _
ConfigureAwaituu_ m
(uum n
falseuun s
)uus t
;uut u
returnvv 
RedirectToActionvv #
(vv# $
nameofvv$ *
(vv* +
VerifyPhoneNumbervv+ <
)vv< =
,vv= >
newvv? B
{vvC D
modelvvE J
.vvJ K
PhoneNumbervvK V
}vvW X
)vvX Y
;vvY Z
}ww 	
[{{ 	
HttpPost{{	 
]{{ 
[|| 	$
ValidateAntiForgeryToken||	 !
]||! "
public}} 
async}} 
Task}} 
<}} 
IActionResult}} '
>}}' ()
EnableTwoFactorAuthentication}}) F
(}}F G
)}}G H
{~~ 	
var 
user 
= 
await 
GetCurrentUserAsync 0
(0 1
)1 2
.2 3
ConfigureAwait3 A
(A B
falseB G
)G H
;H I
if
ÄÄ 
(
ÄÄ 
user
ÄÄ 
!=
ÄÄ 
null
ÄÄ 
)
ÄÄ 
{
ÅÅ 
await
ÇÇ 
_userManager
ÇÇ "
.
ÇÇ" #&
SetTwoFactorEnabledAsync
ÇÇ# ;
(
ÇÇ; <
user
ÇÇ< @
,
ÇÇ@ A
true
ÇÇB F
)
ÇÇF G
.
ÇÇG H
ConfigureAwait
ÇÇH V
(
ÇÇV W
false
ÇÇW \
)
ÇÇ\ ]
;
ÇÇ] ^
await
ÉÉ 
_signInManager
ÉÉ $
.
ÉÉ$ %
SignInAsync
ÉÉ% 0
(
ÉÉ0 1
user
ÉÉ1 5
,
ÉÉ5 6
isPersistent
ÉÉ7 C
:
ÉÉC D
false
ÉÉE J
)
ÉÉJ K
.
ÉÉK L
ConfigureAwait
ÉÉL Z
(
ÉÉZ [
false
ÉÉ[ `
)
ÉÉ` a
;
ÉÉa b
_logger
ÑÑ 
.
ÑÑ 
LogInformation
ÑÑ &
(
ÑÑ& '
$num
ÑÑ' (
,
ÑÑ( )
$str
ÑÑ* S
)
ÑÑS T
;
ÑÑT U
}
ÖÖ 
return
ÜÜ 
RedirectToAction
ÜÜ #
(
ÜÜ# $
nameof
ÜÜ$ *
(
ÜÜ* +
Index
ÜÜ+ 0
)
ÜÜ0 1
,
ÜÜ1 2
$str
ÜÜ3 ;
)
ÜÜ; <
;
ÜÜ< =
}
áá 	
[
ãã 	
HttpPost
ãã	 
]
ãã 
[
åå 	&
ValidateAntiForgeryToken
åå	 !
]
åå! "
public
çç 
async
çç 
Task
çç 
<
çç 
IActionResult
çç '
>
çç' (,
DisableTwoFactorAuthentication
çç) G
(
ççG H
)
ççH I
{
éé 	
var
èè 
user
èè 
=
èè 
await
èè !
GetCurrentUserAsync
èè 0
(
èè0 1
)
èè1 2
.
èè2 3
ConfigureAwait
èè3 A
(
èèA B
false
èèB G
)
èèG H
;
èèH I
if
êê 
(
êê 
user
êê 
!=
êê 
null
êê 
)
êê 
{
ëë 
await
íí 
_userManager
íí "
.
íí" #&
SetTwoFactorEnabledAsync
íí# ;
(
íí; <
user
íí< @
,
íí@ A
false
ííB G
)
ííG H
.
ííH I
ConfigureAwait
ííI W
(
ííW X
false
ííX ]
)
íí] ^
;
íí^ _
await
ìì 
_signInManager
ìì $
.
ìì$ %
SignInAsync
ìì% 0
(
ìì0 1
user
ìì1 5
,
ìì5 6
isPersistent
ìì7 C
:
ììC D
false
ììE J
)
ììJ K
.
ììK L
ConfigureAwait
ììL Z
(
ììZ [
false
ìì[ `
)
ìì` a
;
ììa b
_logger
îî 
.
îî 
LogInformation
îî &
(
îî& '
$num
îî' (
,
îî( )
$str
îî* T
)
îîT U
;
îîU V
}
ïï 
return
ññ 
RedirectToAction
ññ #
(
ññ# $
nameof
ññ$ *
(
ññ* +
Index
ññ+ 0
)
ññ0 1
,
ññ1 2
$str
ññ3 ;
)
ññ; <
;
ññ< =
}
óó 	
[
õõ 	
HttpGet
õõ	 
]
õõ 
public
úú 
async
úú 
Task
úú 
<
úú 
IActionResult
úú '
>
úú' (
VerifyPhoneNumber
úú) :
(
úú: ;
string
úú; A
phoneNumber
úúB M
)
úúM N
{
ùù 	
var
ûû 
user
ûû 
=
ûû 
await
ûû !
GetCurrentUserAsync
ûû 0
(
ûû0 1
)
ûû1 2
.
ûû2 3
ConfigureAwait
ûû3 A
(
ûûA B
false
ûûB G
)
ûûG H
;
ûûH I
if
üü 
(
üü 
user
üü 
==
üü 
null
üü 
)
üü 
{
†† 
return
°° 
View
°° 
(
°° 
$str
°° #
)
°°# $
;
°°$ %
}
¢¢ 
var
££ 
code
££ 
=
££ 
await
££ 
_userManager
££ )
.
££) *1
#GenerateChangePhoneNumberTokenAsync
££* M
(
££M N
user
££N R
,
££R S
phoneNumber
££T _
)
££_ `
.
££` a
ConfigureAwait
££a o
(
££o p
false
££p u
)
££u v
;
££v w
return
•• 
phoneNumber
•• 
==
•• !
null
••" &
?
••' (
View
••) -
(
••- .
$str
••. 5
)
••5 6
:
••7 8
View
••9 =
(
••= >
new
••> A(
VerifyPhoneNumberViewModel
••B \
{
••] ^
PhoneNumber
••_ j
=
••k l
phoneNumber
••m x
}
••y z
)
••z {
;
••{ |
}
¶¶ 	
[
™™ 	
HttpPost
™™	 
]
™™ 
[
´´ 	&
ValidateAntiForgeryToken
´´	 !
]
´´! "
public
¨¨ 
async
¨¨ 
Task
¨¨ 
<
¨¨ 
IActionResult
¨¨ '
>
¨¨' (
VerifyPhoneNumber
¨¨) :
(
¨¨: ;(
VerifyPhoneNumberViewModel
¨¨; U
model
¨¨V [
)
¨¨[ \
{
≠≠ 	
if
ÆÆ 
(
ÆÆ 
!
ÆÆ 

ModelState
ÆÆ 
.
ÆÆ 
IsValid
ÆÆ #
)
ÆÆ# $
{
ØØ 
return
∞∞ 
View
∞∞ 
(
∞∞ 
model
∞∞ !
)
∞∞! "
;
∞∞" #
}
±± 
var
≤≤ 
user
≤≤ 
=
≤≤ 
await
≤≤ !
GetCurrentUserAsync
≤≤ 0
(
≤≤0 1
)
≤≤1 2
.
≤≤2 3
ConfigureAwait
≤≤3 A
(
≤≤A B
false
≤≤B G
)
≤≤G H
;
≤≤H I
if
≥≥ 
(
≥≥ 
user
≥≥ 
!=
≥≥ 
null
≥≥ 
)
≥≥ 
{
¥¥ 
var
µµ 
result
µµ 
=
µµ 
await
µµ "
_userManager
µµ# /
.
µµ/ 0$
ChangePhoneNumberAsync
µµ0 F
(
µµF G
user
µµG K
,
µµK L
model
µµM R
.
µµR S
PhoneNumber
µµS ^
,
µµ^ _
model
µµ` e
.
µµe f
Code
µµf j
)
µµj k
.
µµk l
ConfigureAwait
µµl z
(
µµz {
falseµµ{ Ä
)µµÄ Å
;µµÅ Ç
if
∂∂ 
(
∂∂ 
result
∂∂ 
.
∂∂ 
	Succeeded
∂∂ $
)
∂∂$ %
{
∑∑ 
await
∏∏ 
_signInManager
∏∏ (
.
∏∏( )
SignInAsync
∏∏) 4
(
∏∏4 5
user
∏∏5 9
,
∏∏9 :
isPersistent
∏∏; G
:
∏∏G H
false
∏∏I N
)
∏∏N O
.
∏∏O P
ConfigureAwait
∏∏P ^
(
∏∏^ _
false
∏∏_ d
)
∏∏d e
;
∏∏e f
return
ππ 
RedirectToAction
ππ +
(
ππ+ ,
nameof
ππ, 2
(
ππ2 3
Index
ππ3 8
)
ππ8 9
,
ππ9 :
new
ππ; >
{
ππ? @
Message
ππA H
=
ππI J
ManageMessageId
ππK Z
.
ππZ [
AddPhoneSuccess
ππ[ j
}
ππk l
)
ππl m
;
ππm n
}
∫∫ 
}
ªª 

ModelState
ΩΩ 
.
ΩΩ 
AddModelError
ΩΩ $
(
ΩΩ$ %
string
ΩΩ% +
.
ΩΩ+ ,
Empty
ΩΩ, 1
,
ΩΩ1 2
$str
ΩΩ3 R
)
ΩΩR S
;
ΩΩS T
return
ææ 
View
ææ 
(
ææ 
model
ææ 
)
ææ 
;
ææ 
}
øø 	
[
√√ 	
HttpPost
√√	 
]
√√ 
[
ƒƒ 	&
ValidateAntiForgeryToken
ƒƒ	 !
]
ƒƒ! "
public
≈≈ 
async
≈≈ 
Task
≈≈ 
<
≈≈ 
IActionResult
≈≈ '
>
≈≈' (
RemovePhoneNumber
≈≈) :
(
≈≈: ;
)
≈≈; <
{
∆∆ 	
var
«« 
user
«« 
=
«« 
await
«« !
GetCurrentUserAsync
«« 0
(
««0 1
)
««1 2
.
««2 3
ConfigureAwait
««3 A
(
««A B
false
««B G
)
««G H
;
««H I
if
»» 
(
»» 
user
»» 
!=
»» 
null
»» 
)
»» 
{
…… 
var
   
result
   
=
   
await
   "
_userManager
  # /
.
  / 0!
SetPhoneNumberAsync
  0 C
(
  C D
user
  D H
,
  H I
null
  J N
)
  N O
.
  O P
ConfigureAwait
  P ^
(
  ^ _
false
  _ d
)
  d e
;
  e f
if
ÀÀ 
(
ÀÀ 
result
ÀÀ 
.
ÀÀ 
	Succeeded
ÀÀ $
)
ÀÀ$ %
{
ÃÃ 
await
ÕÕ 
_signInManager
ÕÕ (
.
ÕÕ( )
SignInAsync
ÕÕ) 4
(
ÕÕ4 5
user
ÕÕ5 9
,
ÕÕ9 :
isPersistent
ÕÕ; G
:
ÕÕG H
false
ÕÕI N
)
ÕÕN O
.
ÕÕO P
ConfigureAwait
ÕÕP ^
(
ÕÕ^ _
false
ÕÕ_ d
)
ÕÕd e
;
ÕÕe f
return
ŒŒ 
RedirectToAction
ŒŒ +
(
ŒŒ+ ,
nameof
ŒŒ, 2
(
ŒŒ2 3
Index
ŒŒ3 8
)
ŒŒ8 9
,
ŒŒ9 :
new
ŒŒ; >
{
ŒŒ? @
Message
ŒŒA H
=
ŒŒI J
ManageMessageId
ŒŒK Z
.
ŒŒZ [ 
RemovePhoneSuccess
ŒŒ[ m
}
ŒŒn o
)
ŒŒo p
;
ŒŒp q
}
œœ 
}
–– 
return
—— 
RedirectToAction
—— #
(
——# $
nameof
——$ *
(
——* +
Index
——+ 0
)
——0 1
,
——1 2
new
——3 6
{
——7 8
Message
——9 @
=
——A B
ManageMessageId
——C R
.
——R S
Error
——S X
}
——Y Z
)
——Z [
;
——[ \
}
““ 	
[
÷÷ 	
HttpGet
÷÷	 
]
÷÷ 
public
◊◊ 
IActionResult
◊◊ 
ChangePassword
◊◊ +
(
◊◊+ ,
)
◊◊, -
{
ÿÿ 	
return
ŸŸ 
View
ŸŸ 
(
ŸŸ 
)
ŸŸ 
;
ŸŸ 
}
⁄⁄ 	
[
ﬁﬁ 	
HttpPost
ﬁﬁ	 
]
ﬁﬁ 
[
ﬂﬂ 	&
ValidateAntiForgeryToken
ﬂﬂ	 !
]
ﬂﬂ! "
public
‡‡ 
async
‡‡ 
Task
‡‡ 
<
‡‡ 
IActionResult
‡‡ '
>
‡‡' (
ChangePassword
‡‡) 7
(
‡‡7 8%
ChangePasswordViewModel
‡‡8 O
model
‡‡P U
)
‡‡U V
{
·· 	
if
‚‚ 
(
‚‚ 
!
‚‚ 

ModelState
‚‚ 
.
‚‚ 
IsValid
‚‚ #
)
‚‚# $
{
„„ 
return
‰‰ 
View
‰‰ 
(
‰‰ 
model
‰‰ !
)
‰‰! "
;
‰‰" #
}
ÂÂ 
var
ÊÊ 
user
ÊÊ 
=
ÊÊ 
await
ÊÊ !
GetCurrentUserAsync
ÊÊ 0
(
ÊÊ0 1
)
ÊÊ1 2
.
ÊÊ2 3
ConfigureAwait
ÊÊ3 A
(
ÊÊA B
false
ÊÊB G
)
ÊÊG H
;
ÊÊH I
if
ÁÁ 
(
ÁÁ 
user
ÁÁ 
!=
ÁÁ 
null
ÁÁ 
)
ÁÁ 
{
ËË 
var
ÈÈ 
result
ÈÈ 
=
ÈÈ 
await
ÈÈ "
_userManager
ÈÈ# /
.
ÈÈ/ 0!
ChangePasswordAsync
ÈÈ0 C
(
ÈÈC D
user
ÈÈD H
,
ÈÈH I
model
ÈÈJ O
.
ÈÈO P
OldPassword
ÈÈP [
,
ÈÈ[ \
model
ÈÈ] b
.
ÈÈb c
NewPassword
ÈÈc n
)
ÈÈn o
.
ÈÈo p
ConfigureAwait
ÈÈp ~
(
ÈÈ~ 
falseÈÈ Ñ
)ÈÈÑ Ö
;ÈÈÖ Ü
if
ÍÍ 
(
ÍÍ 
result
ÍÍ 
.
ÍÍ 
	Succeeded
ÍÍ $
)
ÍÍ$ %
{
ÎÎ 
await
ÏÏ 
_signInManager
ÏÏ (
.
ÏÏ( )
SignInAsync
ÏÏ) 4
(
ÏÏ4 5
user
ÏÏ5 9
,
ÏÏ9 :
isPersistent
ÏÏ; G
:
ÏÏG H
false
ÏÏI N
)
ÏÏN O
.
ÏÏO P
ConfigureAwait
ÏÏP ^
(
ÏÏ^ _
false
ÏÏ_ d
)
ÏÏd e
;
ÏÏe f
_logger
ÌÌ 
.
ÌÌ 
LogInformation
ÌÌ *
(
ÌÌ* +
$num
ÌÌ+ ,
,
ÌÌ, -
$str
ÌÌ. Y
)
ÌÌY Z
;
ÌÌZ [
return
ÓÓ 
RedirectToAction
ÓÓ +
(
ÓÓ+ ,
nameof
ÓÓ, 2
(
ÓÓ2 3
Index
ÓÓ3 8
)
ÓÓ8 9
,
ÓÓ9 :
new
ÓÓ; >
{
ÓÓ? @
Message
ÓÓA H
=
ÓÓI J
ManageMessageId
ÓÓK Z
.
ÓÓZ [#
ChangePasswordSuccess
ÓÓ[ p
}
ÓÓq r
)
ÓÓr s
;
ÓÓs t
}
ÔÔ 
	AddErrors
 
(
 
result
  
)
  !
;
! "
return
ÒÒ 
View
ÒÒ 
(
ÒÒ 
model
ÒÒ !
)
ÒÒ! "
;
ÒÒ" #
}
ÚÚ 
return
ÛÛ 
RedirectToAction
ÛÛ #
(
ÛÛ# $
nameof
ÛÛ$ *
(
ÛÛ* +
Index
ÛÛ+ 0
)
ÛÛ0 1
,
ÛÛ1 2
new
ÛÛ3 6
{
ÛÛ7 8
Message
ÛÛ9 @
=
ÛÛA B
ManageMessageId
ÛÛC R
.
ÛÛR S
Error
ÛÛS X
}
ÛÛY Z
)
ÛÛZ [
;
ÛÛ[ \
}
ÙÙ 	
[
¯¯ 	
HttpGet
¯¯	 
]
¯¯ 
public
˘˘ 
IActionResult
˘˘ 
SetPassword
˘˘ (
(
˘˘( )
)
˘˘) *
{
˙˙ 	
return
˚˚ 
View
˚˚ 
(
˚˚ 
)
˚˚ 
;
˚˚ 
}
¸¸ 	
[
ÄÄ 	
HttpPost
ÄÄ	 
]
ÄÄ 
[
ÅÅ 	&
ValidateAntiForgeryToken
ÅÅ	 !
]
ÅÅ! "
public
ÇÇ 
async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
IActionResult
ÇÇ '
>
ÇÇ' (
SetPassword
ÇÇ) 4
(
ÇÇ4 5"
SetPasswordViewModel
ÇÇ5 I
model
ÇÇJ O
)
ÇÇO P
{
ÉÉ 	
if
ÑÑ 
(
ÑÑ 
!
ÑÑ 

ModelState
ÑÑ 
.
ÑÑ 
IsValid
ÑÑ #
)
ÑÑ# $
{
ÖÖ 
return
ÜÜ 
View
ÜÜ 
(
ÜÜ 
model
ÜÜ !
)
ÜÜ! "
;
ÜÜ" #
}
áá 
var
ââ 
user
ââ 
=
ââ 
await
ââ !
GetCurrentUserAsync
ââ 0
(
ââ0 1
)
ââ1 2
.
ââ2 3
ConfigureAwait
ââ3 A
(
ââA B
false
ââB G
)
ââG H
;
ââH I
if
ää 
(
ää 
user
ää 
!=
ää 
null
ää 
)
ää 
{
ãã 
var
åå 
result
åå 
=
åå 
await
åå "
_userManager
åå# /
.
åå/ 0
AddPasswordAsync
åå0 @
(
åå@ A
user
ååA E
,
ååE F
model
ååG L
.
ååL M
NewPassword
ååM X
)
ååX Y
.
ååY Z
ConfigureAwait
ååZ h
(
ååh i
false
ååi n
)
åån o
;
ååo p
if
çç 
(
çç 
result
çç 
.
çç 
	Succeeded
çç $
)
çç$ %
{
éé 
await
èè 
_signInManager
èè (
.
èè( )
SignInAsync
èè) 4
(
èè4 5
user
èè5 9
,
èè9 :
isPersistent
èè; G
:
èèG H
false
èèI N
)
èèN O
.
èèO P
ConfigureAwait
èèP ^
(
èè^ _
false
èè_ d
)
èèd e
;
èèe f
return
êê 
RedirectToAction
êê +
(
êê+ ,
nameof
êê, 2
(
êê2 3
Index
êê3 8
)
êê8 9
,
êê9 :
new
êê; >
{
êê? @
Message
êêA H
=
êêI J
ManageMessageId
êêK Z
.
êêZ [ 
SetPasswordSuccess
êê[ m
}
êên o
)
êêo p
;
êêp q
}
ëë 
	AddErrors
íí 
(
íí 
result
íí  
)
íí  !
;
íí! "
return
ìì 
View
ìì 
(
ìì 
model
ìì !
)
ìì! "
;
ìì" #
}
îî 
return
ïï 
RedirectToAction
ïï #
(
ïï# $
nameof
ïï$ *
(
ïï* +
Index
ïï+ 0
)
ïï0 1
,
ïï1 2
new
ïï3 6
{
ïï7 8
Message
ïï9 @
=
ïïA B
ManageMessageId
ïïC R
.
ïïR S
Error
ïïS X
}
ïïY Z
)
ïïZ [
;
ïï[ \
}
ññ 	
[
ôô 	
HttpGet
ôô	 
]
ôô 
public
öö 
async
öö 
Task
öö 
<
öö 
IActionResult
öö '
>
öö' (
ManageLogins
öö) 5
(
öö5 6
ManageMessageId
öö6 E
?
ööE F
message
ööG N
=
ööO P
null
ööQ U
)
ööU V
{
õõ 	
ViewData
úú 
[
úú 
$str
úú $
]
úú$ %
=
úú& '
message
ùù 
==
ùù 
ManageMessageId
ùù *
.
ùù* + 
RemoveLoginSuccess
ùù+ =
?
ùù> ?
$str
ùù@ a
:
ûû 
message
ûû 
==
ûû 
ManageMessageId
ûû ,
.
ûû, -
AddLoginSuccess
ûû- <
?
ûû= >
$str
ûû? ^
:
üü 
message
üü 
==
üü 
ManageMessageId
üü ,
.
üü, -
Error
üü- 2
?
üü3 4
$str
üü5 M
:
†† 
$str
†† 
;
†† 
var
°° 
user
°° 
=
°° 
await
°° !
GetCurrentUserAsync
°° 0
(
°°0 1
)
°°1 2
.
°°2 3
ConfigureAwait
°°3 A
(
°°A B
false
°°B G
)
°°G H
;
°°H I
if
¢¢ 
(
¢¢ 
user
¢¢ 
==
¢¢ 
null
¢¢ 
)
¢¢ 
{
££ 
return
§§ 
View
§§ 
(
§§ 
$str
§§ #
)
§§# $
;
§§$ %
}
•• 
var
¶¶ 

userLogins
¶¶ 
=
¶¶ 
await
¶¶ "
_userManager
¶¶# /
.
¶¶/ 0
GetLoginsAsync
¶¶0 >
(
¶¶> ?
user
¶¶? C
)
¶¶C D
.
¶¶D E
ConfigureAwait
¶¶E S
(
¶¶S T
false
¶¶T Y
)
¶¶Y Z
;
¶¶Z [
var
ßß 
schemes
ßß 
=
ßß 
await
ßß 
_signInManager
ßß  .
.
ßß. /3
%GetExternalAuthenticationSchemesAsync
ßß/ T
(
ßßT U
)
ßßU V
.
ßßV W
ConfigureAwait
ßßW e
(
ßße f
false
ßßf k
)
ßßk l
;
ßßl m
var
®® 
otherLogins
®® 
=
®® 
schemes
®® %
.
®®% &
Where
®®& +
(
®®+ ,
auth
®®, 0
=>
®®1 3

userLogins
®®4 >
.
®®> ?
All
®®? B
(
®®B C
ul
®®C E
=>
®®F H
auth
®®I M
.
®®M N
Name
®®N R
!=
®®S U
ul
®®V X
.
®®X Y
LoginProvider
®®Y f
)
®®f g
)
®®g h
.
®®h i
ToList
®®i o
(
®®o p
)
®®p q
;
®®q r
ViewData
©© 
[
©© 
$str
©© '
]
©©' (
=
©©) *
user
©©+ /
.
©©/ 0
PasswordHash
©©0 <
!=
©©= ?
null
©©@ D
||
©©E G

userLogins
©©H R
.
©©R S
Count
©©S X
>
©©Y Z
$num
©©[ \
;
©©\ ]
return
™™ 
View
™™ 
(
™™ 
new
™™ #
ManageLoginsViewModel
™™ 1
{
´´ 
CurrentLogins
¨¨ 
=
¨¨ 

userLogins
¨¨  *
,
¨¨* +
OtherLogins
≠≠ 
=
≠≠ 
otherLogins
≠≠ )
}
ÆÆ 
)
ÆÆ 
;
ÆÆ 
}
ØØ 	
[
≥≥ 	
HttpPost
≥≥	 
]
≥≥ 
[
¥¥ 	&
ValidateAntiForgeryToken
¥¥	 !
]
¥¥! "
public
µµ 
async
µµ 
Task
µµ 
<
µµ 
IActionResult
µµ '
>
µµ' (
	LinkLogin
µµ) 2
(
µµ2 3
string
µµ3 9
provider
µµ: B
)
µµB C
{
∂∂ 	
await
∏∏ 
HttpContext
∏∏ 
.
∏∏ 
SignOutAsync
∏∏ *
(
∏∏* +
IdentityConstants
∏∏+ <
.
∏∏< =
ExternalScheme
∏∏= K
)
∏∏K L
.
∏∏L M
ConfigureAwait
∏∏M [
(
∏∏[ \
false
∏∏\ a
)
∏∏a b
;
∏∏b c
var
ªª 
redirectUrl
ªª 
=
ªª 
Url
ªª !
.
ªª! "
Action
ªª" (
(
ªª( )
nameof
ªª) /
(
ªª/ 0
LinkLoginCallback
ªª0 A
)
ªªA B
,
ªªB C
$str
ªªD L
)
ªªL M
;
ªªM N
var
ºº 

properties
ºº 
=
ºº 
_signInManager
ºº +
.
ºº+ ,7
)ConfigureExternalAuthenticationProperties
ºº, U
(
ººU V
provider
ººV ^
,
ºº^ _
redirectUrl
ºº` k
,
ººk l
_userManager
ººm y
.
ººy z
	GetUserIdººz É
(ººÉ Ñ
UserººÑ à
)ººà â
)ººâ ä
;ººä ã
return
ΩΩ 
	Challenge
ΩΩ 
(
ΩΩ 

properties
ΩΩ '
,
ΩΩ' (
provider
ΩΩ) 1
)
ΩΩ1 2
;
ΩΩ2 3
}
ææ 	
[
¬¬ 	
HttpGet
¬¬	 
]
¬¬ 
public
√√ 
async
√√ 
Task
√√ 
<
√√ 
ActionResult
√√ &
>
√√& '
LinkLoginCallback
√√( 9
(
√√9 :
)
√√: ;
{
ƒƒ 	
var
≈≈ 
user
≈≈ 
=
≈≈ 
await
≈≈ !
GetCurrentUserAsync
≈≈ 0
(
≈≈0 1
)
≈≈1 2
.
≈≈2 3
ConfigureAwait
≈≈3 A
(
≈≈A B
false
≈≈B G
)
≈≈G H
;
≈≈H I
if
∆∆ 
(
∆∆ 
user
∆∆ 
==
∆∆ 
null
∆∆ 
)
∆∆ 
{
«« 
return
»» 
View
»» 
(
»» 
$str
»» #
)
»»# $
;
»»$ %
}
…… 
var
   
info
   
=
   
await
   
_signInManager
   +
.
  + ,'
GetExternalLoginInfoAsync
  , E
(
  E F
await
  F K
_userManager
  L X
.
  X Y
GetUserIdAsync
  Y g
(
  g h
user
  h l
)
  l m
.
  m n
ConfigureAwait
  n |
(
  | }
false  } Ç
)  Ç É
)  É Ñ
.  Ñ Ö
ConfigureAwait  Ö ì
(  ì î
false  î ô
)  ô ö
;  ö õ
if
ÀÀ 
(
ÀÀ 
info
ÀÀ 
==
ÀÀ 
null
ÀÀ 
)
ÀÀ 
{
ÃÃ 
return
ÕÕ 
RedirectToAction
ÕÕ '
(
ÕÕ' (
nameof
ÕÕ( .
(
ÕÕ. /
ManageLogins
ÕÕ/ ;
)
ÕÕ; <
,
ÕÕ< =
new
ÕÕ> A
{
ÕÕB C
Message
ÕÕD K
=
ÕÕL M
ManageMessageId
ÕÕN ]
.
ÕÕ] ^
Error
ÕÕ^ c
}
ÕÕd e
)
ÕÕe f
;
ÕÕf g
}
ŒŒ 
var
œœ 
result
œœ 
=
œœ 
await
œœ 
_userManager
œœ +
.
œœ+ ,
AddLoginAsync
œœ, 9
(
œœ9 :
user
œœ: >
,
œœ> ?
info
œœ@ D
)
œœD E
.
œœE F
ConfigureAwait
œœF T
(
œœT U
false
œœU Z
)
œœZ [
;
œœ[ \
var
–– 
message
–– 
=
–– 
ManageMessageId
–– )
.
––) *
Error
––* /
;
––/ 0
if
—— 
(
—— 
result
—— 
.
—— 
	Succeeded
——  
)
——  !
{
““ 
message
”” 
=
”” 
ManageMessageId
”” )
.
””) *
AddLoginSuccess
””* 9
;
””9 :
await
’’ 
HttpContext
’’ !
.
’’! "
SignOutAsync
’’" .
(
’’. /
IdentityConstants
’’/ @
.
’’@ A
ExternalScheme
’’A O
)
’’O P
.
’’P Q
ConfigureAwait
’’Q _
(
’’_ `
false
’’` e
)
’’e f
;
’’f g
}
÷÷ 
return
◊◊ 
RedirectToAction
◊◊ #
(
◊◊# $
nameof
◊◊$ *
(
◊◊* +
ManageLogins
◊◊+ 7
)
◊◊7 8
,
◊◊8 9
new
◊◊: =
{
◊◊> ?
Message
◊◊@ G
=
◊◊H I
message
◊◊J Q
}
◊◊R S
)
◊◊S T
;
◊◊T U
}
ÿÿ 	
private
‹‹ 
void
‹‹ 
	AddErrors
‹‹ 
(
‹‹ 
IdentityResult
‹‹ -
result
‹‹. 4
)
‹‹4 5
{
›› 	
foreach
ﬁﬁ 
(
ﬁﬁ 
var
ﬁﬁ 
error
ﬁﬁ 
in
ﬁﬁ !
result
ﬁﬁ" (
.
ﬁﬁ( )
Errors
ﬁﬁ) /
)
ﬁﬁ/ 0
{
ﬂﬂ 

ModelState
‡‡ 
.
‡‡ 
AddModelError
‡‡ (
(
‡‡( )
string
‡‡) /
.
‡‡/ 0
Empty
‡‡0 5
,
‡‡5 6
error
‡‡7 <
.
‡‡< =
Description
‡‡= H
)
‡‡H I
;
‡‡I J
}
·· 
}
‚‚ 	
public
‰‰ 
enum
‰‰ 
ManageMessageId
‰‰ #
{
ÂÂ 	
AddPhoneSuccess
ÊÊ 
,
ÊÊ 
AddLoginSuccess
ÁÁ 
,
ÁÁ #
ChangePasswordSuccess
ËË !
,
ËË! "!
SetTwoFactorSuccess
ÈÈ 
,
ÈÈ   
SetPasswordSuccess
ÍÍ 
,
ÍÍ  
RemoveLoginSuccess
ÎÎ 
,
ÎÎ  
RemovePhoneSuccess
ÏÏ 
,
ÏÏ 
Error
ÌÌ 
}
ÓÓ 	
private
 
Task
 
<
 
ApplicationUser
 $
>
$ %!
GetCurrentUserAsync
& 9
(
9 :
)
: ;
{
ÒÒ 	
return
ÚÚ 
_userManager
ÚÚ 
.
ÚÚ  
GetUserAsync
ÚÚ  ,
(
ÚÚ, -
HttpContext
ÚÚ- 8
.
ÚÚ8 9
User
ÚÚ9 =
)
ÚÚ= >
;
ÚÚ> ?
}
ÛÛ 	
}
ˆˆ 
}˜˜ ‘V
kD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\SettingController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str %
)% &
]& '
public 

class 
SettingController "
:# $
BaseController% 3
<3 4
SettingController4 E
>E F
{ 
public 
SettingController  
(  !
IHostingEnvironment! 4
env5 8
) 
: 
base 
( 
env 
) 
{ 	
} 	
[## 	
HttpGet##	 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
[%% 	
Route%%	 
(%% 
$str%% 
)%%  
]%%  !
[&& 	
Route&&	 
(&& 
$str&& 
)&& 
]&& 
public'' 
IActionResult'' 
Configurations'' +
(''+ ,
)'', -
{(( 	
PaginationModel)) 
<)) "
ConfigurationViewModel)) 2
>))2 3
pagingPages))4 ?
=))@ A
new))B E
PaginationModel))F U
<))U V"
ConfigurationViewModel))V l
>))l m
())m n
)))n o
{** 
Items++ 
=++ &
GlobalConfigurationService++ 2
.++2 3
ListConfiguration++3 D
.++D E
Where++E J
(++J K
m++K L
=>++M O
m++P Q
.++Q R
Specificulture++R `
==++a c
CurrentLanguage++d s
)++s t
.++t u
ToList++u {
(++{ |
)++| }
,++} ~
	PageIndex,, 
=,, 
$num,, 
,,, 
PageSize-- 
=-- &
GlobalConfigurationService-- 5
.--5 6
ListConfiguration--6 G
.--G H
Count--H M
(--M N
m--N O
=>--P R
m--S T
.--T U
Specificulture--U c
==--d f
CurrentLanguage--g v
)--v w
,--w x

TotalItems.. 
=.. &
GlobalConfigurationService.. 7
...7 8
ListConfiguration..8 I
...I J
Count..J O
(..O P
m..P Q
=>..R T
m..U V
...V W
Specificulture..W e
==..f h
CurrentLanguage..i x
)..x y
,..y z
	TotalPage// 
=// 
$num// 
}00 
;00 
return44 
View44 
(44 
pagingPages44 #
)44# $
;44$ %
}55 	
[88 	
HttpGet88	 
]88 
[99 	
Route99	 
(99 
$str99 &
)99& '
]99' (
public:: 
IActionResult:: 
CreateConfiguration:: 0
(::0 1
)::1 2
{;; 	"
ConfigurationViewModel<< "
ttsConfiguration<<# 3
=<<4 5
new<<6 9"
ConfigurationViewModel<<: P
(<<P Q
new== 
SiocConfiguration== %
(==% &
)==& '
{>> 
Specificulture@@ "
=@@# $
CurrentLanguage@@% 4
}AA 
)AA 
;AA 
returnBB 
ViewBB 
(BB 
ttsConfigurationBB (
)BB( )
;BB) *
}CC 	
[HH 	
RouteHH	 
(HH 
$strHH &
)HH& '
]HH' (
[II 	
HttpPostII	 
]II 
[JJ 	$
ValidateAntiForgeryTokenJJ	 !
]JJ! "
publicKK 
asyncKK 
TaskKK 
<KK 
IActionResultKK '
>KK' (
CreateConfigurationKK) <
(KK< ="
ConfigurationViewModelKK= S
configurationKKT a
)KKa b
{LL 	
ifMM 
(MM 

ModelStateMM 
.MM 
IsValidMM "
)MM" #
{NN 
varOO 
resultOO 
=OO 
awaitOO "
configurationOO# 0
.OO0 1
SaveModelAsyncOO1 ?
(OO? @
)OO@ A
.OOA B
ConfigureAwaitOOB P
(OOP Q
falseOOQ V
)OOV W
;OOW X
ifPP 
(PP 
resultPP 
.PP 
	IsSucceedPP $
)PP$ %
{QQ &
GlobalConfigurationServiceRR .
.RR. /
InstanceRR/ 7
.RR7 8
RefreshRR8 ?
(RR? @
)RR@ A
;RRA B
returnSS 
RedirectToActionSS +
(SS+ ,
$strSS, <
)SS< =
;SS= >
}TT 
elseUU 
{VV 
returnWW 
ViewWW 
(WW  
configurationWW  -
)WW- .
;WW. /
}XX 
}YY 
elseZZ 
{[[ 
return\\ 
View\\ 
(\\ 
configuration\\ )
)\\) *
;\\* +
}]] 
}^^ 	
[aa 	
HttpGetaa	 
]aa 
[bb 	
Routebb	 
(bb 
$strbb )
)bb) *
]bb* +
publiccc 
asynccc 
Taskcc 
<cc 
IActionResultcc '
>cc' (
EditConfigurationcc) :
(cc: ;
stringcc; A
idccB D
)ccD E
{dd 	
ifee 
(ee 
idee 
==ee 
nullee 
)ee 
{ff 
returngg 
NotFoundgg 
(gg  
)gg  !
;gg! "
}hh 
varjj 
ttsConfigurationjj  
=jj! "
awaitjj# ("
ConfigurationViewModeljj) ?
.jj? @

Repositoryjj@ J
.jjJ K
GetSingleModelAsyncjjK ^
(jj^ _
mkk 
=>kk 
mkk 
.kk 
Keywordkk 
==kk !
idkk" $
&&kk% '
mkk( )
.kk) *
Specificulturekk* 8
==kk9 ;
CurrentLanguagekk< K
)kkK L
.kkL M
ConfigureAwaitkkM [
(kk[ \
falsekk\ a
)kka b
;kkb c
ifll 
(ll 
ttsConfigurationll  
==ll! #
nullll$ (
)ll( )
{mm 
returnnn 
NotFoundnn 
(nn  
)nn  !
;nn! "
}oo 
returnpp 
Viewpp 
(pp 
ttsConfigurationpp (
.pp( )
Datapp) -
)pp- .
;pp. /
}qq 	
[vv 	
Routevv	 
(vv 
$strvv )
)vv) *
]vv* +
[ww 	
HttpPostww	 
]ww 
[xx 	$
ValidateAntiForgeryTokenxx	 !
]xx! "
publicyy 
asyncyy 
Taskyy 
<yy 
IActionResultyy '
>yy' (
EditConfigurationyy) :
(yy: ;
stringyy; A
idyyB D
,yyD E"
ConfigurationViewModelyyF \
ttsConfigurationyy] m
)yym n
{zz 	
if{{ 
({{ 

ModelState{{ 
.{{ 
IsValid{{ "
){{" #
{|| 
try}} 
{~~ 
var 
result 
=  
await! &
ttsConfiguration' 7
.7 8
SaveModelAsync8 F
(F G
)G H
.H I
ConfigureAwaitI W
(W X
falseX ]
)] ^
;^ _
if
ÄÄ 
(
ÄÄ 
result
ÄÄ 
.
ÄÄ 
	IsSucceed
ÄÄ (
)
ÄÄ( )
{
ÅÅ (
GlobalConfigurationService
ÇÇ 2
.
ÇÇ2 3
Instance
ÇÇ3 ;
.
ÇÇ; <
Refresh
ÇÇ< C
(
ÇÇC D
)
ÇÇD E
;
ÇÇE F
}
ÉÉ 
}
ÑÑ 
catch
ÖÖ 
(
ÖÖ *
DbUpdateConcurrencyException
ÖÖ 3
)
ÖÖ3 4
{
ÜÜ 
if
áá 
(
áá 
!
áá $
ConfigurationViewModel
áá /
.
áá/ 0

Repository
áá0 :
.
áá: ;
CheckIsExists
áá; H
(
ááH I
c
ááI J
=>
ááK M
c
ááN O
.
ááO P
Specificulture
ááP ^
==
áá_ a
ttsConfiguration
ááb r
.
áár s
Specificultureáás Å
)ááÅ Ç
)ááÇ É
{
àà 
return
ââ 
NotFound
ââ '
(
ââ' (
)
ââ( )
;
ââ) *
}
ää 
else
ãã 
{
åå 
throw
çç 
;
çç 
}
éé 
}
èè 
return
êê 
RedirectToAction
êê '
(
êê' (
$str
êê( 8
)
êê8 9
;
êê9 :
}
ëë 
return
íí 
View
íí 
(
íí 
ttsConfiguration
íí (
)
íí( )
;
íí) *
}
ìì 	
[
ïï 	
HttpGet
ïï	 
]
ïï 
[
ññ 	
Route
ññ	 
(
ññ 
$str
ññ +
)
ññ+ ,
]
ññ, -
public
óó 
async
óó 
Task
óó 
<
óó 
IActionResult
óó '
>
óó' (!
DeleteConfiguration
óó) <
(
óó< =
string
óó= C
id
óóD F
)
óóF G
{
òò 	
var
ôô 
result
ôô 
=
ôô 
await
ôô $
ConfigurationViewModel
ôô 5
.
ôô5 6

Repository
ôô6 @
.
ôô@ A
RemoveModelAsync
ôôA Q
(
ôôQ R
m
ôôR S
=>
ôôT V
m
ôôW X
.
ôôX Y
Keyword
ôôY `
==
ôôa c
id
ôôd f
&&
ôôg i
m
ôôj k
.
ôôk l
Specificulture
ôôl z
==
ôô{ }
CurrentLanguageôô~ ç
)ôôç é
.ôôé è
ConfigureAwaitôôè ù
(ôôù û
falseôôû £
)ôô£ §
;ôô§ •
if
öö 
(
öö 
result
öö 
.
öö 
	IsSucceed
öö  
)
öö  !
{
õõ (
GlobalConfigurationService
úú *
.
úú* +
Instance
úú+ 3
.
úú3 4
Refresh
úú4 ;
(
úú; <
)
úú< =
;
úú= >
}
ùù 
return
ûû 
RedirectToAction
ûû #
(
ûû# $
$str
ûû$ 4
)
ûû4 5
;
ûû5 6
}
üü 	
}
¢¢ 
}££ ‹
hD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\TeamController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
. 
Areas $
.$ %
Portal% +
.+ ,
Controllers, 7
{ 
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str "
)" #
]# $
public		 

class		 
TeamController		 
:		  !
BaseController		" 0
<		0 1
TeamController		1 ?
>		? @
{

 
public 
TeamController 
( 
IHostingEnvironment 1
env2 5
)5 6
:7 8
base9 =
(= >
env> A
)A B
{ 	
} 	
[ 	
HttpPost	 
, 
HttpGet 
] 
[ 	
Route	 
( 
$str 
) 
] 
[ 	
Route	 
( 
$str 
) 
] 
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
} 
} Ãp
lD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\TemplateController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str &
)& '
]' (
public 

class 
TemplateController #
:$ %
BaseController& 4
<4 5
TemplateController5 G
>G H
{ 
public 
TemplateController !
(! "
IHostingEnvironment" 5
env6 9
) 
: 
base 
( 
env 
) 
{ 	
} 	
[ 	
HttpGet	 
] 
[ 	
Route	 
( 
$str !
)! "
]" #
[   	
Route  	 
(   
$str   L
)  L M
]  M N
[!! 	
Route!!	 
(!! 
$str!! B
)!!B C
]!!C D
["" 	
Route""	 
("" 
$str"" [
)""[ \
]""\ ]
[## 	
Route##	 
(## 
$str## Q
)##Q R
]##R S
public$$ 
async$$ 
Task$$ 
<$$ 
IActionResult$$ '
>$$' (
Index$$) .
($$. /
int$$/ 2

templateId$$3 =
,$$= >
string$$? E
folder$$F L
,$$L M
int$$N Q
pageSize$$R Z
=$$[ \
$num$$] _
,$$_ `
int$$a d
	pageIndex$$e n
=$$o p
$num$$q r
,$$r s
string$$t z
keyword	$${ Ç
=
$$É Ñ
null
$$Ö â
)
$$â ä
{%% 	
var&& 
getTemplateFile&& 
=&&  !
await&&" '!
InfoTemplateViewModel&&( =
.&&= >

Repository&&> H
.&&H I
GetModelListByAsync&&I \
(&&\ ]
template'' 
=>'' 
template'' %
.''% &

TemplateId''& 0
==''1 3

templateId''4 >
&&(( 
template(( 
.(( 

FolderType(( '
==((( *
folder((+ 1
&&)) 
()) 
string)) 
.)) 
IsNullOrEmpty)) )
())) *
keyword))* 1
)))1 2
||))3 5
template))6 >
.))> ?
FileName))? G
.))G H
Contains))H P
())P Q
keyword))Q X
)))X Y
)))Y Z
,))Z [
$str** "
,**" #
OrderByDirection**$ 4
.**4 5

Descending**5 ?
,**? @
pageSize++ 
,++ 
	pageIndex++ $
)++$ %
.++% &
ConfigureAwait++& 4
(++4 5
false++5 :
)++: ;
;++; <
ViewBag,, 
.,, 

templateId,, 
=,,  

templateId,,! +
;,,+ ,
return-- 
View-- 
(-- 
getTemplateFile-- '
.--' (
Data--( ,
)--, -
;--- .
}.. 	
[00 	
HttpGet00	 
]00 
[11 	
Route11	 
(11 
$str11 (
)11( )
]11) *
public22 
IActionResult22 
Create22 #
(22# $
int22$ '

templateId22( 2
)222 3
{33 	
var44 
getTemplate44 
=44 
BEThemeViewModel44 .
.44. /

Repository44/ 9
.449 :
GetSingleModel44: H
(44H I
t44I J
=>44K M
t44N O
.44O P
Id44P R
==44S U

templateId44V `
)44` a
;44a b
if55 
(55 
getTemplate55 
.55 
	IsSucceed55 %
)55% &
{66 
var77 
TemplateFile77  
=77! "
new77# &
BETemplateViewModel77' :
(77: ;
)77; <
{88 

ModifiedBy99 
=99  
User99! %
.99% &
Identity99& .
.99. /
Name99/ 3
,993 4
	Extension:: 
=:: 
SWCmsConstants::  .
.::. /

Parameters::/ 9
.::9 :
TemplateExtension::: K
,::K L

TemplateId;; 
=;;  

templateId;;! +
,;;+ ,
TemplateName<<  
=<<! "
getTemplate<<# .
.<<. /
Data<</ 3
.<<3 4
Name<<4 8
}== 
;== 
return>> 
View>> 
(>> 
TemplateFile>> (
)>>( )
;>>) *
}?? 
else@@ 
{AA 
returnBB 
NotFoundBB 
(BB  
)BB  !
;BB! "
}CC 
}DD 	
[II 	
RouteII	 
(II 
$strII (
)II( )
]II) *
[JJ 	
HttpPostJJ	 
]JJ 
[KK 	$
ValidateAntiForgeryTokenKK	 !
]KK! "
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (
CreateLL) /
(LL/ 0
intLL0 3

templateIdLL4 >
,LL> ?
BETemplateViewModelLL@ S
templateLLT \
)LL\ ]
{MM 	
ifNN 
(NN 

ModelStateNN 
.NN 
IsValidNN "
)NN" #
{OO 
templatePP 
.PP 
CreatedDateTimePP (
=PP) *
DateTimePP+ 3
.PP3 4
UtcNowPP4 :
;PP: ;
DomainQQ 
.QQ 
CoreQQ 
.QQ 

ViewModelsQQ &
.QQ& '
RepositoryResponseQQ' 9
<QQ9 :
BETemplateViewModelQQ: M
>QQM N
resultQQO U
=QQV W
awaitQQX ]
templateQQ^ f
.QQf g
SaveModelAsyncQQg u
(QQu v
trueQQv z
)QQz {
.QQ{ |
ConfigureAwait	QQ| ä
(
QQä ã
false
QQã ê
)
QQê ë
;
QQë í
ifRR 
(RR 
resultRR 
.RR 
	IsSucceedRR $
)RR$ %
{SS 
returnTT 
RedirectToActionTT +
(TT+ ,
$strTT, 3
,TT3 4
newTT5 8
{TT9 :

templateIdTT; E
=TTF G
templateTTH P
.TTP Q

TemplateIdTTQ [
,TT[ \
folderTT] c
=TTd e
templateTTf n
.TTn o

FolderTypeTTo y
}TTz {
)TT{ |
;TT| }
}UU 
elseVV 
{WW 
returnXX 
ViewXX 
(XX  
templateXX  (
)XX( )
;XX) *
}YY 
}ZZ 
return[[ 
View[[ 
([[ 
template[[  
)[[  !
;[[! "
}\\ 	
[__ 	
HttpGet__	 
]__ 
[`` 	
Route``	 
(`` 
$str`` 
)`` 
]`` 
publicaa 
asyncaa 
Taskaa 
<aa 
IActionResultaa '
>aa' (
Editaa) -
(aa- .
intaa. 1
?aa1 2
idaa3 5
)aa5 6
{bb 	
ifcc 
(cc 
idcc 
==cc 
nullcc 
)cc 
{dd 
returnee 
NotFoundee 
(ee  
)ee  !
;ee! "
}ff 
varhh 
TemplateFilehh 
=hh 
awaithh $
BETemplateViewModelhh% 8
.hh8 9

Repositoryhh9 C
.hhC D
GetSingleModelAsynchhD W
(hhW X
mhhX Y
=>hhZ \
mhh] ^
.hh^ _
Idhh_ a
==hhb d
idhhe g
)hhg h
.hhh i
ConfigureAwaithhi w
(hhw x
falsehhx }
)hh} ~
;hh~ 
ifii 
(ii 
!ii 
TemplateFileii 
.ii 
	IsSucceedii '
)ii' (
{jj 
returnkk 
NotFoundkk 
(kk  
)kk  !
;kk! "
}ll 
returnmm 
Viewmm 
(mm 
TemplateFilemm $
.mm$ %
Datamm% )
)mm) *
;mm* +
}nn 	
[ss 	
Routess	 
(ss 
$strss 
)ss 
]ss 
[tt 	
HttpPosttt	 
]tt 
[uu 	$
ValidateAntiForgeryTokenuu	 !
]uu! "
publicvv 
asyncvv 
Taskvv 
<vv 
IActionResultvv '
>vv' (
Editvv) -
(vv- .
intvv. 1
idvv2 4
,vv4 5
BETemplateViewModelvv6 I
templatevvJ R
)vvR S
{ww 	
ifxx 
(xx 
idxx 
!=xx 
templatexx 
.xx 
Idxx !
)xx! "
{yy 
returnzz 
NotFoundzz 
(zz  
)zz  !
;zz! "
}{{ 
if}} 
(}} 

ModelState}} 
.}} 
IsValid}} "
)}}" #
{~~ 
try 
{
ÄÄ 
template
ÅÅ 
.
ÅÅ 

ModifiedBy
ÅÅ '
=
ÅÅ( )
User
ÅÅ* .
.
ÅÅ. /
Identity
ÅÅ/ 7
.
ÅÅ7 8
Name
ÅÅ8 <
;
ÅÅ< =
template
ÇÇ 
.
ÇÇ 
LastModified
ÇÇ )
=
ÇÇ* +
DateTime
ÇÇ, 4
.
ÇÇ4 5
UtcNow
ÇÇ5 ;
;
ÇÇ; <
var
ÉÉ 
result
ÉÉ 
=
ÉÉ  
await
ÉÉ! &
template
ÉÉ' /
.
ÉÉ/ 0
SaveModelAsync
ÉÉ0 >
(
ÉÉ> ?
true
ÉÉ? C
)
ÉÉC D
.
ÉÉD E
ConfigureAwait
ÉÉE S
(
ÉÉS T
false
ÉÉT Y
)
ÉÉY Z
;
ÉÉZ [
if
ÑÑ 
(
ÑÑ 
result
ÑÑ 
.
ÑÑ 
	IsSucceed
ÑÑ (
)
ÑÑ( )
{
ÖÖ 
return
ÜÜ 
RedirectToAction
ÜÜ /
(
ÜÜ/ 0
$str
ÜÜ0 7
,
ÜÜ7 8
new
ÜÜ9 <
{
ÜÜ= >

templateId
ÜÜ? I
=
ÜÜJ K
template
ÜÜL T
.
ÜÜT U

TemplateId
ÜÜU _
,
ÜÜ_ `
folder
ÜÜa g
=
ÜÜh i
template
ÜÜj r
.
ÜÜr s

FolderType
ÜÜs }
}
ÜÜ~ 
)ÜÜ Ä
;ÜÜÄ Å
}
áá 
else
àà 
{
ââ 

ModelState
ää "
.
ää" #
AddModelError
ää# 0
(
ää0 1
string
ää1 7
.
ää7 8
Empty
ää8 =
,
ää= >
result
ää? E
.
ääE F
	Exception
ääF O
.
ääO P
Message
ääP W
)
ääW X
;
ääX Y
return
ãã 
View
ãã #
(
ãã# $
template
ãã$ ,
)
ãã, -
;
ãã- .
}
åå 
}
çç 
catch
éé 
(
éé *
DbUpdateConcurrencyException
éé 3
)
éé3 4
{
èè 
if
êê 
(
êê 
!
êê !
BETemplateViewModel
êê ,
.
êê, -

Repository
êê- 7
.
êê7 8
CheckIsExists
êê8 E
(
êêE F
m
êêF G
=>
êêH J
m
êêK L
.
êêL M
Id
êêM O
==
êêP R
template
êêS [
.
êê[ \
Id
êê\ ^
)
êê^ _
)
êê_ `
{
ëë 
return
íí 
NotFound
íí '
(
íí' (
)
íí( )
;
íí) *
}
ìì 
else
îî 
{
ïï 
throw
ññ 
;
ññ 
}
óó 
}
òò 
}
öö 
ViewData
õõ 
[
õõ 
$str
õõ 
]
õõ 
=
õõ  
$str
õõ! '
;
õõ' (
ViewData
úú 
[
úú 
$str
úú !
]
úú! "
=
úú# $
$str
úú% 3
;
úú3 4
return
ùù 
View
ùù 
(
ùù 
template
ùù  
)
ùù  !
;
ùù! "
}
ûû 	
[
†† 	
HttpGet
††	 
]
†† 
[
°° 	
Route
°°	 
(
°° 
$str
°° 
)
°° 
]
°° 
public
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
IActionResult
¢¢ '
>
¢¢' (
Delete
¢¢) /
(
¢¢/ 0
int
¢¢0 3
?
¢¢3 4
id
¢¢5 7
)
¢¢7 8
{
££ 	
var
§§ 
template
§§ 
=
§§ 
await
§§  !
BETemplateViewModel
§§! 4
.
§§4 5

Repository
§§5 ?
.
§§? @!
GetSingleModelAsync
§§@ S
(
§§S T
m
§§T U
=>
§§V X
m
§§Y Z
.
§§Z [
Id
§§[ ]
==
§§^ `
id
§§a c
)
§§c d
.
§§d e
ConfigureAwait
§§e s
(
§§s t
false
§§t y
)
§§y z
;
§§z {
await
•• 
template
•• 
.
•• 
Data
•• 
.
••  
RemoveModelAsync
••  0
(
••0 1
)
••1 2
.
••2 3
ConfigureAwait
••3 A
(
••A B
false
••B G
)
••G H
;
••H I
return
¶¶ 
RedirectToAction
¶¶ #
(
¶¶# $
$str
¶¶$ +
,
¶¶+ ,
new
¶¶- 0
{
¶¶1 2

templateId
¶¶3 =
=
¶¶> ?
template
¶¶@ H
.
¶¶H I
Data
¶¶I M
.
¶¶M N

TemplateId
¶¶N X
,
¶¶X Y
folder
¶¶Z `
=
¶¶a b
template
¶¶c k
.
¶¶k l
Data
¶¶l p
?
¶¶p q
.
¶¶q r

FolderType
¶¶r |
}
¶¶} ~
)
¶¶~ 
;¶¶ Ä
}
ßß 	
}
®® 
}ØØ ÷u
iD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\Controllers\ThemeController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
Controllers( 3
{ 
[ 
	Microsoft 
. 

AspNetCore 
. 
Authorization '
.' (
	Authorize( 1
]1 2
[ 
Area 	
(	 

$str
 
) 
] 
[ 
Route 

(
 
$str #
)# $
]$ %
[ 
RequestSizeLimit 
( 
int 
. 
MaxValue "
)" #
]# $
public 

class 
ThemeController  
:! "
BaseController# 1
<1 2
ThemeController2 A
>A B
{ 
public 
ThemeController 
( 
IHostingEnvironment 2
env3 6
) 
: 
base 
( 
env 
) 
{   	
}!! 	
[## 	
HttpGet##	 
]## 
[$$ 	
Route$$	 
($$ 
$str$$ 
)$$ 
]$$ 
[%% 	
Route%%	 
(%% 
$str%% ;
)%%; <
]%%< =
[&& 	
Route&&	 
(&& 
$str&& 1
)&&1 2
]&&2 3
['' 	
Route''	 
('' 
$str'' A
)''A B
]''B C
[(( 	
Route((	 
((( 
$str(( 7
)((7 8
]((8 9
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
Index))) .
()). /
int))/ 2
pageSize))3 ;
=))< =
$num))> @
,))@ A
int))B E
	pageIndex))F O
=))P Q
$num))R S
,))S T
string))U [
keyword))\ c
=))d e
null))f j
)))j k
{** 	
var++ 
getTemplate++ 
=++ 
await++ #
InfoThemeViewModel++$ 6
.++6 7

Repository++7 A
.++A B
GetModelListByAsync++B U
(++U V
template,, 
=>,, 
(,, 
string,, $
.,,$ %
IsNullOrEmpty,,% 2
(,,2 3
keyword,,3 :
),,: ;
||,,< >
template,,? G
.,,G H
Name,,H L
.,,L M
Contains,,M U
(,,U V
keyword,,V ]
),,] ^
),,^ _
,,,_ `
$str-- "
,--" #
OrderByDirection--$ 4
.--4 5

Descending--5 ?
,--? @
pageSize.. 
,.. 
	pageIndex.. $
)..$ %
...% &
ConfigureAwait..& 4
(..4 5
false..5 :
)..: ;
;..; <
return00 
View00 
(00 
getTemplate00 #
.00# $
Data00$ (
)00( )
;00) *
}11 	
[33 	
HttpGet33	 
]33 
[44 	
Route44	 
(44 
$str44 #
)44# $
]44$ %
public55 
async55 
Task55 
<55 
IActionResult55 '
>55' (
SyncFromLocal55) 6
(556 7
int557 :
id55; =
)55= >
{66 	
var77 
getTemplate77 
=77 
await77 #
BETemplateViewModel77$ 7
.777 8

Repository778 B
.77B C
GetModelListByAsync77C V
(77V W
template88 
=>88 
template88 %
.88% &

TemplateId88& 0
==881 3
id884 6
)886 7
.887 8
ConfigureAwait888 F
(88F G
false88G L
)88L M
;88M N
foreach99 
(99 
var99 
item99 
in99  
getTemplate99! ,
.99, -
Data99- 1
)991 2
{:: 
await;; 
item;; 
.;; 
SaveModelAsync;; )
(;;) *
true;;* .
);;. /
.;;/ 0
ConfigureAwait;;0 >
(;;> ?
false;;? D
);;D E
;;;E F
}<< 
return== 
RedirectToAction== #
(==# $
$str==$ +
)==+ ,
;==, -
}>> 	
[@@ 	
HttpGet@@	 
]@@ 
[AA 	
RouteAA	 
(AA 
$strAA 
)AA 
]AA 
publicBB 
IActionResultBB 
CreateBB #
(BB# $
)BB$ %
{CC 	
varDD 
templateDD 
=DD 
newDD 
BEThemeViewModelDD /
(DD/ 0
)DD0 1
{EE 
	CreatedByFF 
=FF 
UserFF  
.FF  !
IdentityFF! )
.FF) *
NameFF* .
,FF. /
SpecificultureGG 
=GG  
CurrentLanguageGG! 0
}HH 
;HH 
returnII 
ViewII 
(II 
templateII  
)II  !
;II! "
}JJ 	
[OO 	
RouteOO	 
(OO 
$strOO 
)OO 
]OO 
[PP 	
HttpPostPP	 
]PP 
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
IActionResultQQ '
>QQ' (
CreateQQ) /
(QQ/ 0
BEThemeViewModelQQ0 @
templateQQA I
)QQI J
{RR 	
ifSS 
(SS 

ModelStateSS 
.SS 
IsValidSS "
)SS" #
{TT 
templateUU 
.UU 
CreatedDateTimeUU (
=UU) *
DateTimeUU+ 3
.UU3 4
UtcNowUU4 :
;UU: ;
varVV 
resultVV 
=VV 
awaitVV "
templateVV# +
.VV+ ,
SaveModelAsyncVV, :
(VV: ;
trueVV; ?
)VV? @
.VV@ A
ConfigureAwaitVVA O
(VVO P
falseVVP U
)VVU V
;VVV W
ifWW 
(WW 
resultWW 
.WW 
	IsSucceedWW $
)WW$ %
{XX 
returnYY 
RedirectToActionYY +
(YY+ ,
$strYY, 3
)YY3 4
;YY4 5
}ZZ 
else[[ 
{\\ 
foreach]] 
(]] 
var]]  
error]]! &
in]]' )
result]]* 0
.]]0 1
Errors]]1 7
)]]7 8
{^^ 

ModelState__ "
.__" #
AddModelError__# 0
(__0 1
$str__1 3
,__3 4
error__5 :
)__: ;
;__; <
}`` 
returnaa 
Viewaa 
(aa  
templateaa  (
)aa( )
;aa) *
}bb 
}cc 
returndd 
Viewdd 
(dd 
templatedd  
)dd  !
;dd! "
}ee 	
[hh 	
HttpGethh	 
]hh 
[ii 	
Routeii	 
(ii 
$strii 
)ii 
]ii 
publicjj 
asyncjj 
Taskjj 
<jj 
IActionResultjj '
>jj' (
Editjj) -
(jj- .
intjj. 1
?jj1 2
idjj3 5
)jj5 6
{kk 	
ifll 
(ll 
idll 
==ll 
nullll 
)ll 
{mm 
returnnn 
NotFoundnn 
(nn  
)nn  !
;nn! "
}oo 
varqq 
templateqq 
=qq 
awaitqq  
BEThemeViewModelqq! 1
.qq1 2

Repositoryqq2 <
.qq< =
GetSingleModelAsyncqq= P
(qqP Q
mqqQ R
=>qqS U
mqqV W
.qqW X
IdqqX Z
==qq[ ]
idqq^ `
)qq` a
.qqa b
ConfigureAwaitqqb p
(qqp q
falseqqq v
)qqv w
;qqw x
ifrr 
(rr 
!rr 
templaterr 
.rr 
	IsSucceedrr #
)rr# $
{ss 
returntt 
NotFoundtt 
(tt  
)tt  !
;tt! "
}uu 
elsevv 
{ww 
templatexx 
.xx 
Dataxx 
.xx 
Specificulturexx ,
=xx- .
CurrentLanguagexx/ >
;xx> ?
templateyy 
.yy 
Datayy 
.yy 
	IsActivedyy '
=yy( )
templateyy* 2
.yy2 3
Datayy3 7
.yy7 8
Nameyy8 <
==yy= ?&
GlobalConfigurationServiceyy@ Z
.yyZ [
Instanceyy[ c
.yyc d
GetLocalStringyyd r
(yyr s
SWCmsConstants	yys Å
.
yyÅ Ç"
ConfigurationKeyword
yyÇ ñ
.
yyñ ó
Theme
yyó ú
,
yyú ù
CurrentLanguage
yyû ≠
,
yy≠ Æ
SWCmsConstants
yyØ Ω
.
yyΩ æ
Default
yyæ ≈
.
yy≈ ∆#
DefaultTemplateFolder
yy∆ €
)
yy€ ‹
;
yy‹ ›
}zz 
return{{ 
View{{ 
({{ 
template{{  
.{{  !
Data{{! %
){{% &
;{{& '
}|| 	
[
ÅÅ 	
Route
ÅÅ	 
(
ÅÅ 
$str
ÅÅ 
)
ÅÅ 
]
ÅÅ 
[
ÇÇ 	
HttpPost
ÇÇ	 
]
ÇÇ 
[
ÉÉ 	
RequestSizeLimit
ÉÉ	 
(
ÉÉ 
$num
ÉÉ #
)
ÉÉ# $
]
ÉÉ$ %
[
ÑÑ 	&
ValidateAntiForgeryToken
ÑÑ	 !
]
ÑÑ! "
public
ÖÖ 
async
ÖÖ 
Task
ÖÖ 
<
ÖÖ 
IActionResult
ÖÖ '
>
ÖÖ' (
Edit
ÖÖ) -
(
ÖÖ- .
int
ÖÖ. 1
id
ÖÖ2 4
,
ÖÖ4 5
BEThemeViewModel
ÖÖ6 F
template
ÖÖG O
)
ÖÖO P
{
ÜÜ 	
if
áá 
(
áá 
id
áá 
!=
áá 
template
áá 
.
áá 
Id
áá !
)
áá! "
{
àà 
return
ââ 
NotFound
ââ 
(
ââ  
)
ââ  !
;
ââ! "
}
ää 
if
åå 
(
åå 

ModelState
åå 
.
åå 
IsValid
åå "
)
åå" #
{
çç 
try
éé 
{
èè 
var
êê 
result
êê 
=
êê  
await
êê! &
template
êê' /
.
êê/ 0
SaveModelAsync
êê0 >
(
êê> ?
true
êê? C
)
êêC D
.
êêD E
ConfigureAwait
êêE S
(
êêS T
false
êêT Y
)
êêY Z
;
êêZ [
if
ëë 
(
ëë 
result
ëë 
.
ëë 
	IsSucceed
ëë (
)
ëë( )
{
íí 
return
ìì 
RedirectToAction
ìì /
(
ìì/ 0
$str
ìì0 7
)
ìì7 8
;
ìì8 9
}
îî 
else
ïï 
{
ññ 
if
óó 
(
óó 
result
óó "
.
óó" #
	Exception
óó# ,
!=
óó, .
null
óó. 2
)
óó2 3
{
òò 

ModelState
ôô &
.
ôô& '
AddModelError
ôô' 4
(
ôô4 5
string
ôô5 ;
.
ôô; <
Empty
ôô< A
,
ôôA B
result
ôôC I
.
ôôI J
	Exception
ôôJ S
.
ôôS T
Message
ôôT [
)
ôô[ \
;
ôô\ ]
}
öö 
foreach
úú 
(
úú  !
var
úú! $
error
úú% *
in
úú+ -
result
úú. 4
.
úú4 5
Errors
úú5 ;
)
úú; <
{
ùù 

ModelState
ûû &
.
ûû& '
AddModelError
ûû' 4
(
ûû4 5
string
ûû5 ;
.
ûû; <
Empty
ûû< A
,
ûûA B
error
ûûC H
)
ûûH I
;
ûûI J
}
üü 
return
†† 
View
†† #
(
††# $
template
††$ ,
)
††, -
;
††- .
}
°° 
}
¢¢ 
catch
££ 
(
££ *
DbUpdateConcurrencyException
££ 3
)
££3 4
{
§§ 
if
•• 
(
•• 
!
•• 
BEThemeViewModel
•• )
.
••) *

Repository
••* 4
.
••4 5
CheckIsExists
••5 B
(
••B C
m
••C D
=>
••E G
m
••H I
.
••I J
Id
••J L
==
••M O
template
••P X
.
••X Y
Id
••Y [
)
••[ \
)
••\ ]
{
¶¶ 
return
ßß 
NotFound
ßß '
(
ßß' (
)
ßß( )
;
ßß) *
}
®® 
else
©© 
{
™™ 
throw
´´ 
;
´´ 
}
¨¨ 
}
≠≠ 
}
∞∞ 
ViewData
±± 
[
±± 
$str
±± 
]
±± 
=
±±  
$str
±±! '
;
±±' (
ViewData
≤≤ 
[
≤≤ 
$str
≤≤ !
]
≤≤! "
=
≤≤# $
$str
≤≤% /
;
≤≤/ 0
return
≥≥ 
View
≥≥ 
(
≥≥ 
template
≥≥  
)
≥≥  !
;
≥≥! "
}
¥¥ 	
[
∂∂ 	
HttpGet
∂∂	 
]
∂∂ 
[
∑∑ 	
Route
∑∑	 
(
∑∑ 
$str
∑∑ 
)
∑∑ 
]
∑∑ 
public
∏∏ 
async
∏∏ 
Task
∏∏ 
<
∏∏ 
IActionResult
∏∏ '
>
∏∏' (
Delete
∏∏) /
(
∏∏/ 0
int
∏∏0 3
?
∏∏3 4
id
∏∏5 7
)
∏∏7 8
{
ππ 	
var
∫∫ 
template
∫∫ 
=
∫∫ 
await
∫∫  
BEThemeViewModel
∫∫! 1
.
∫∫1 2

Repository
∫∫2 <
.
∫∫< =!
GetSingleModelAsync
∫∫= P
(
∫∫P Q
m
∫∫Q R
=>
∫∫S U
m
∫∫V W
.
∫∫W X
Id
∫∫X Z
==
∫∫[ ]
id
∫∫^ `
)
∫∫` a
.
∫∫a b
ConfigureAwait
∫∫b p
(
∫∫p q
false
∫∫q v
)
∫∫v w
;
∫∫w x
if
ªª 
(
ªª 
template
ªª 
.
ªª 
	IsSucceed
ªª "
)
ªª" #
{
ºº 
await
ΩΩ 
template
ΩΩ 
.
ΩΩ 
Data
ΩΩ #
.
ΩΩ# $
RemoveModelAsync
ΩΩ$ 4
(
ΩΩ4 5
true
ΩΩ5 9
)
ΩΩ9 :
.
ΩΩ: ;
ConfigureAwait
ΩΩ; I
(
ΩΩI J
false
ΩΩJ O
)
ΩΩO P
;
ΩΩP Q
}
ææ 
return
øø 
RedirectToAction
øø #
(
øø# $
$str
øø$ +
)
øø+ ,
;
øø, -
}
¿¿ 	
}
¡¡ 
}»» ¿
hD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\ViewComponents\Breadcrumbs.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
ViewComponents( 6
{ 
public		 

class		 
Breadcrumbs		 
:		 
ViewComponent		 ,
{

 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
) 
; 
} 	
} 
} ∆
kD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\ViewComponents\ControlSidebar.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
ViewComponents( 6
{ 
public		 

class		 
ControlSidebar		 
:		  !
ViewComponent		" /
{

 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
) 
; 
} 	
} 
} ¬
iD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\ViewComponents\HeaderNavbar.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
ViewComponents( 6
{ 
public		 

class		 
HeaderNavbar		 
:		 
ViewComponent		  -
{

 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
) 
; 
} 	
} 
} æ
gD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\ViewComponents\MainFooter.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
ViewComponents( 6
{ 
public		 

class		 

MainFooter		 
:		 
ViewComponent		 +
{

 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
) 
; 
} 	
} 
} ¿
hD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\ViewComponents\MainSidebar.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
ViewComponents( 6
{ 
public		 

class		 
MainSidebar		 
:		 
ViewComponent		 ,
{

 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
) 
; 
} 	
} 
} ∂
cD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\Portal\ViewComponents\Modals.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
Portal! '
.' (
ViewComponents( 6
{ 
public		 

class		 
Modals		 
:		 
ViewComponent		 '
{

 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
return 
View 
( 
) 
; 
} 	
} 
} ¨á
hD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Areas\User\Controllers\ManageController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Areas  
.  !
User! %
.% &
Controllers& 1
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public 

class 
ProfileController "
:# $

Controller% /
{ 
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
private 
readonly 
SignInManager &
<& '
ApplicationUser' 6
>6 7
_signInManager8 F
;F G
private 
readonly 
IEmailSender %
_emailSender& 2
;2 3
private 
readonly 

ISmsSender #

_smsSender$ .
;. /
private 
readonly 
ILogger  
_logger! (
;( )
public 
ProfileController  
(  !
UserManager
 
< 
ApplicationUser %
>% &
userManager' 2
,2 3
SignInManager
 
< 
ApplicationUser '
>' (
signInManager) 6
,6 7
IEmailSender  
 
emailSender   "
,  " #

ISmsSender!!
 
	smsSender!! 
,!! 
ILoggerFactory""
 
loggerFactory"" &
)""& '
{## 	
_userManager$$ 
=$$ 
userManager$$ &
;$$& '
_signInManager%% 
=%% 
signInManager%% *
;%%* +
_emailSender'' 
='' 
emailSender'' &
;''& '

_smsSender(( 
=(( 
	smsSender(( "
;((" #
_logger)) 
=)) 
loggerFactory)) #
.))# $
CreateLogger))$ 0
<))0 1
ProfileController))1 B
>))B C
())C D
)))D E
;))E F
}** 	
[.. 	
HttpGet..	 
].. 
public// 
async// 
Task// 
<// 
IActionResult// '
>//' (
Index//) .
(//. /
ManageMessageId/// >
?//> ?
message//@ G
=//H I
null//J N
)//N O
{00 	
ViewData11 
[11 
$str11 $
]11$ %
=11& '
message22 
==22 
ManageMessageId22 *
.22* +!
ChangePasswordSuccess22+ @
?22A B
$str22C d
:33 
message33 
==33 
ManageMessageId33 ,
.33, -
SetPasswordSuccess33- ?
?33@ A
$str33B _
:44 
message44 
==44 
ManageMessageId44 ,
.44, -
SetTwoFactorSuccess44- @
?44A B
$str44C z
:55 
message55 
==55 
ManageMessageId55 ,
.55, -
Error55- 2
?553 4
$str555 M
:66 
message66 
==66 
ManageMessageId66 ,
.66, -
AddPhoneSuccess66- <
?66= >
$str66? ]
:77 
message77 
==77 
ManageMessageId77 ,
.77, -
RemovePhoneSuccess77- ?
?77@ A
$str77B b
:88 
$str88 
;88 
var:: 
user:: 
=:: 
await:: 
GetCurrentUserAsync:: 0
(::0 1
)::1 2
;::2 3
if;; 
(;; 
user;; 
==;; 
null;; 
);; 
{<< 
return== 
View== 
(== 
$str== #
)==# $
;==$ %
}>> 
var?? 
model?? 
=?? 
new?? 
IndexViewModel?? *
{@@ 
HasPasswordAA 
=AA 
awaitAA #
_userManagerAA$ 0
.AA0 1
HasPasswordAsyncAA1 A
(AAA B
userAAB F
)AAF G
,AAG H
PhoneNumberBB 
=BB 
awaitBB #
_userManagerBB$ 0
.BB0 1
GetPhoneNumberAsyncBB1 D
(BBD E
userBBE I
)BBI J
,BBJ K
	TwoFactorCC 
=CC 
awaitCC !
_userManagerCC" .
.CC. /$
GetTwoFactorEnabledAsyncCC/ G
(CCG H
userCCH L
)CCL M
,CCM N
LoginsDD 
=DD 
awaitDD 
_userManagerDD +
.DD+ ,
GetLoginsAsyncDD, :
(DD: ;
userDD; ?
)DD? @
,DD@ A
BrowserRememberedEE !
=EE" #
awaitEE$ )
_signInManagerEE* 8
.EE8 9,
 IsTwoFactorClientRememberedAsyncEE9 Y
(EEY Z
userEEZ ^
)EE^ _
}FF 
;FF 
returnGG 
ViewGG 
(GG 
modelGG 
)GG 
;GG 
}HH 	
[LL 	
HttpPostLL	 
]LL 
[MM 	$
ValidateAntiForgeryTokenMM	 !
]MM! "
publicNN 
asyncNN 
TaskNN 
<NN 
IActionResultNN '
>NN' (
RemoveLoginNN) 4
(NN4 5 
RemoveLoginViewModelNN5 I
accountNNJ Q
)NNQ R
{OO 	
ManageMessageIdPP 
?PP 
messagePP $
=PP% &
ManageMessageIdPP' 6
.PP6 7
ErrorPP7 <
;PP< =
varQQ 
userQQ 
=QQ 
awaitQQ 
GetCurrentUserAsyncQQ 0
(QQ0 1
)QQ1 2
;QQ2 3
ifRR 
(RR 
userRR 
!=RR 
nullRR 
)RR 
{SS 
varTT 
resultTT 
=TT 
awaitTT "
_userManagerTT# /
.TT/ 0
RemoveLoginAsyncTT0 @
(TT@ A
userTTA E
,TTE F
accountTTG N
.TTN O
LoginProviderTTO \
,TT\ ]
accountTT^ e
.TTe f
ProviderKeyTTf q
)TTq r
;TTr s
ifUU 
(UU 
resultUU 
.UU 
	SucceededUU $
)UU$ %
{VV 
awaitWW 
_signInManagerWW (
.WW( )
SignInAsyncWW) 4
(WW4 5
userWW5 9
,WW9 :
isPersistentWW; G
:WWG H
falseWWI N
)WWN O
;WWO P
messageXX 
=XX 
ManageMessageIdXX -
.XX- .
RemoveLoginSuccessXX. @
;XX@ A
}YY 
}ZZ 
return[[ 
RedirectToAction[[ #
([[# $
nameof[[$ *
([[* +
ManageLogins[[+ 7
)[[7 8
,[[8 9
new[[: =
{[[> ?
Message[[@ G
=[[H I
message[[J Q
}[[R S
)[[S T
;[[T U
}\\ 	
public`` 
IActionResult`` 
AddPhoneNumber`` +
(``+ ,
)``, -
{aa 	
returnbb 
Viewbb 
(bb 
)bb 
;bb 
}cc 	
[gg 	
HttpPostgg	 
]gg 
[hh 	$
ValidateAntiForgeryTokenhh	 !
]hh! "
publicii 
asyncii 
Taskii 
<ii 
IActionResultii '
>ii' (
AddPhoneNumberii) 7
(ii7 8#
AddPhoneNumberViewModelii8 O
modeliiP U
)iiU V
{jj 	
ifkk 
(kk 
!kk 

ModelStatekk 
.kk 
IsValidkk #
)kk# $
{ll 
returnmm 
Viewmm 
(mm 
modelmm !
)mm! "
;mm" #
}nn 
varpp 
userpp 
=pp 
awaitpp 
GetCurrentUserAsyncpp 0
(pp0 1
)pp1 2
;pp2 3
ifqq 
(qq 
userqq 
==qq 
nullqq 
)qq 
{rr 
returnss 
Viewss 
(ss 
$strss #
)ss# $
;ss$ %
}tt 
varuu 
codeuu 
=uu 
awaituu 
_userManageruu )
.uu) */
#GenerateChangePhoneNumberTokenAsyncuu* M
(uuM N
useruuN R
,uuR S
modeluuT Y
.uuY Z
PhoneNumberuuZ e
)uue f
;uuf g
awaitvv 

_smsSendervv 
.vv 
SendSmsAsyncvv )
(vv) *
modelvv* /
.vv/ 0
PhoneNumbervv0 ;
,vv; <
$strvv= V
+vvW X
codevvY ]
)vv] ^
;vv^ _
returnww 
RedirectToActionww #
(ww# $
nameofww$ *
(ww* +
VerifyPhoneNumberww+ <
)ww< =
,ww= >
newww? B
{wwC D
PhoneNumberwwE P
=wwQ R
modelwwS X
.wwX Y
PhoneNumberwwY d
}wwe f
)wwf g
;wwg h
}xx 	
[|| 	
HttpPost||	 
]|| 
[}} 	$
ValidateAntiForgeryToken}}	 !
]}}! "
public~~ 
async~~ 
Task~~ 
<~~ 
IActionResult~~ '
>~~' ()
EnableTwoFactorAuthentication~~) F
(~~F G
)~~G H
{ 	
var
ÄÄ 
user
ÄÄ 
=
ÄÄ 
await
ÄÄ !
GetCurrentUserAsync
ÄÄ 0
(
ÄÄ0 1
)
ÄÄ1 2
;
ÄÄ2 3
if
ÅÅ 
(
ÅÅ 
user
ÅÅ 
!=
ÅÅ 
null
ÅÅ 
)
ÅÅ 
{
ÇÇ 
await
ÉÉ 
_userManager
ÉÉ "
.
ÉÉ" #&
SetTwoFactorEnabledAsync
ÉÉ# ;
(
ÉÉ; <
user
ÉÉ< @
,
ÉÉ@ A
true
ÉÉB F
)
ÉÉF G
;
ÉÉG H
await
ÑÑ 
_signInManager
ÑÑ $
.
ÑÑ$ %
SignInAsync
ÑÑ% 0
(
ÑÑ0 1
user
ÑÑ1 5
,
ÑÑ5 6
isPersistent
ÑÑ7 C
:
ÑÑC D
false
ÑÑE J
)
ÑÑJ K
;
ÑÑK L
_logger
ÖÖ 
.
ÖÖ 
LogInformation
ÖÖ &
(
ÖÖ& '
$num
ÖÖ' (
,
ÖÖ( )
$str
ÖÖ* S
)
ÖÖS T
;
ÖÖT U
}
ÜÜ 
return
áá 
RedirectToAction
áá #
(
áá# $
nameof
áá$ *
(
áá* +
Index
áá+ 0
)
áá0 1
,
áá1 2
$str
áá3 ;
)
áá; <
;
áá< =
}
àà 	
[
åå 	
HttpPost
åå	 
]
åå 
[
çç 	&
ValidateAntiForgeryToken
çç	 !
]
çç! "
public
éé 
async
éé 
Task
éé 
<
éé 
IActionResult
éé '
>
éé' (,
DisableTwoFactorAuthentication
éé) G
(
ééG H
)
ééH I
{
èè 	
var
êê 
user
êê 
=
êê 
await
êê !
GetCurrentUserAsync
êê 0
(
êê0 1
)
êê1 2
;
êê2 3
if
ëë 
(
ëë 
user
ëë 
!=
ëë 
null
ëë 
)
ëë 
{
íí 
await
ìì 
_userManager
ìì "
.
ìì" #&
SetTwoFactorEnabledAsync
ìì# ;
(
ìì; <
user
ìì< @
,
ìì@ A
false
ììB G
)
ììG H
;
ììH I
await
îî 
_signInManager
îî $
.
îî$ %
SignInAsync
îî% 0
(
îî0 1
user
îî1 5
,
îî5 6
isPersistent
îî7 C
:
îîC D
false
îîE J
)
îîJ K
;
îîK L
_logger
ïï 
.
ïï 
LogInformation
ïï &
(
ïï& '
$num
ïï' (
,
ïï( )
$str
ïï* T
)
ïïT U
;
ïïU V
}
ññ 
return
óó 
RedirectToAction
óó #
(
óó# $
nameof
óó$ *
(
óó* +
Index
óó+ 0
)
óó0 1
,
óó1 2
$str
óó3 ;
)
óó; <
;
óó< =
}
òò 	
[
úú 	
HttpGet
úú	 
]
úú 
public
ùù 
async
ùù 
Task
ùù 
<
ùù 
IActionResult
ùù '
>
ùù' (
VerifyPhoneNumber
ùù) :
(
ùù: ;
string
ùù; A
phoneNumber
ùùB M
)
ùùM N
{
ûû 	
var
üü 
user
üü 
=
üü 
await
üü !
GetCurrentUserAsync
üü 0
(
üü0 1
)
üü1 2
;
üü2 3
if
†† 
(
†† 
user
†† 
==
†† 
null
†† 
)
†† 
{
°° 
return
¢¢ 
View
¢¢ 
(
¢¢ 
$str
¢¢ #
)
¢¢# $
;
¢¢$ %
}
££ 
var
§§ 
code
§§ 
=
§§ 
await
§§ 
_userManager
§§ )
.
§§) *1
#GenerateChangePhoneNumberTokenAsync
§§* M
(
§§M N
user
§§N R
,
§§R S
phoneNumber
§§T _
)
§§_ `
;
§§` a
return
¶¶ 
phoneNumber
¶¶ 
==
¶¶ !
null
¶¶" &
?
¶¶' (
View
¶¶) -
(
¶¶- .
$str
¶¶. 5
)
¶¶5 6
:
¶¶7 8
View
¶¶9 =
(
¶¶= >
new
¶¶> A(
VerifyPhoneNumberViewModel
¶¶B \
{
¶¶] ^
PhoneNumber
¶¶_ j
=
¶¶k l
phoneNumber
¶¶m x
}
¶¶y z
)
¶¶z {
;
¶¶{ |
}
ßß 	
[
´´ 	
HttpPost
´´	 
]
´´ 
[
¨¨ 	&
ValidateAntiForgeryToken
¨¨	 !
]
¨¨! "
public
≠≠ 
async
≠≠ 
Task
≠≠ 
<
≠≠ 
IActionResult
≠≠ '
>
≠≠' (
VerifyPhoneNumber
≠≠) :
(
≠≠: ;(
VerifyPhoneNumberViewModel
≠≠; U
model
≠≠V [
)
≠≠[ \
{
ÆÆ 	
if
ØØ 
(
ØØ 
!
ØØ 

ModelState
ØØ 
.
ØØ 
IsValid
ØØ #
)
ØØ# $
{
∞∞ 
return
±± 
View
±± 
(
±± 
model
±± !
)
±±! "
;
±±" #
}
≤≤ 
var
≥≥ 
user
≥≥ 
=
≥≥ 
await
≥≥ !
GetCurrentUserAsync
≥≥ 0
(
≥≥0 1
)
≥≥1 2
;
≥≥2 3
if
¥¥ 
(
¥¥ 
user
¥¥ 
!=
¥¥ 
null
¥¥ 
)
¥¥ 
{
µµ 
var
∂∂ 
result
∂∂ 
=
∂∂ 
await
∂∂ "
_userManager
∂∂# /
.
∂∂/ 0$
ChangePhoneNumberAsync
∂∂0 F
(
∂∂F G
user
∂∂G K
,
∂∂K L
model
∂∂M R
.
∂∂R S
PhoneNumber
∂∂S ^
,
∂∂^ _
model
∂∂` e
.
∂∂e f
Code
∂∂f j
)
∂∂j k
;
∂∂k l
if
∑∑ 
(
∑∑ 
result
∑∑ 
.
∑∑ 
	Succeeded
∑∑ $
)
∑∑$ %
{
∏∏ 
await
ππ 
_signInManager
ππ (
.
ππ( )
SignInAsync
ππ) 4
(
ππ4 5
user
ππ5 9
,
ππ9 :
isPersistent
ππ; G
:
ππG H
false
ππI N
)
ππN O
;
ππO P
return
∫∫ 
RedirectToAction
∫∫ +
(
∫∫+ ,
nameof
∫∫, 2
(
∫∫2 3
Index
∫∫3 8
)
∫∫8 9
,
∫∫9 :
new
∫∫; >
{
∫∫? @
Message
∫∫A H
=
∫∫I J
ManageMessageId
∫∫K Z
.
∫∫Z [
AddPhoneSuccess
∫∫[ j
}
∫∫k l
)
∫∫l m
;
∫∫m n
}
ªª 
}
ºº 

ModelState
ææ 
.
ææ 
AddModelError
ææ $
(
ææ$ %
string
ææ% +
.
ææ+ ,
Empty
ææ, 1
,
ææ1 2
$str
ææ3 R
)
ææR S
;
ææS T
return
øø 
View
øø 
(
øø 
model
øø 
)
øø 
;
øø 
}
¿¿ 	
[
ƒƒ 	
HttpPost
ƒƒ	 
]
ƒƒ 
[
≈≈ 	&
ValidateAntiForgeryToken
≈≈	 !
]
≈≈! "
public
∆∆ 
async
∆∆ 
Task
∆∆ 
<
∆∆ 
IActionResult
∆∆ '
>
∆∆' (
RemovePhoneNumber
∆∆) :
(
∆∆: ;
)
∆∆; <
{
«« 	
var
»» 
user
»» 
=
»» 
await
»» !
GetCurrentUserAsync
»» 0
(
»»0 1
)
»»1 2
;
»»2 3
if
…… 
(
…… 
user
…… 
!=
…… 
null
…… 
)
…… 
{
   
var
ÀÀ 
result
ÀÀ 
=
ÀÀ 
await
ÀÀ "
_userManager
ÀÀ# /
.
ÀÀ/ 0!
SetPhoneNumberAsync
ÀÀ0 C
(
ÀÀC D
user
ÀÀD H
,
ÀÀH I
null
ÀÀJ N
)
ÀÀN O
;
ÀÀO P
if
ÃÃ 
(
ÃÃ 
result
ÃÃ 
.
ÃÃ 
	Succeeded
ÃÃ $
)
ÃÃ$ %
{
ÕÕ 
await
ŒŒ 
_signInManager
ŒŒ (
.
ŒŒ( )
SignInAsync
ŒŒ) 4
(
ŒŒ4 5
user
ŒŒ5 9
,
ŒŒ9 :
isPersistent
ŒŒ; G
:
ŒŒG H
false
ŒŒI N
)
ŒŒN O
;
ŒŒO P
return
œœ 
RedirectToAction
œœ +
(
œœ+ ,
nameof
œœ, 2
(
œœ2 3
Index
œœ3 8
)
œœ8 9
,
œœ9 :
new
œœ; >
{
œœ? @
Message
œœA H
=
œœI J
ManageMessageId
œœK Z
.
œœZ [ 
RemovePhoneSuccess
œœ[ m
}
œœn o
)
œœo p
;
œœp q
}
–– 
}
—— 
return
““ 
RedirectToAction
““ #
(
““# $
nameof
““$ *
(
““* +
Index
““+ 0
)
““0 1
,
““1 2
new
““3 6
{
““7 8
Message
““9 @
=
““A B
ManageMessageId
““C R
.
““R S
Error
““S X
}
““Y Z
)
““Z [
;
““[ \
}
”” 	
[
◊◊ 	
HttpGet
◊◊	 
]
◊◊ 
public
ÿÿ 
IActionResult
ÿÿ 
ChangePassword
ÿÿ +
(
ÿÿ+ ,
)
ÿÿ, -
{
ŸŸ 	
return
⁄⁄ 
View
⁄⁄ 
(
⁄⁄ 
)
⁄⁄ 
;
⁄⁄ 
}
€€ 	
[
ﬂﬂ 	
HttpPost
ﬂﬂ	 
]
ﬂﬂ 
[
‡‡ 	&
ValidateAntiForgeryToken
‡‡	 !
]
‡‡! "
public
·· 
async
·· 
Task
·· 
<
·· 
IActionResult
·· '
>
··' (
ChangePassword
··) 7
(
··7 8%
ChangePasswordViewModel
··8 O
model
··P U
)
··U V
{
‚‚ 	
if
„„ 
(
„„ 
!
„„ 

ModelState
„„ 
.
„„ 
IsValid
„„ #
)
„„# $
{
‰‰ 
return
ÂÂ 
View
ÂÂ 
(
ÂÂ 
model
ÂÂ !
)
ÂÂ! "
;
ÂÂ" #
}
ÊÊ 
var
ÁÁ 
user
ÁÁ 
=
ÁÁ 
await
ÁÁ !
GetCurrentUserAsync
ÁÁ 0
(
ÁÁ0 1
)
ÁÁ1 2
;
ÁÁ2 3
if
ËË 
(
ËË 
user
ËË 
!=
ËË 
null
ËË 
)
ËË 
{
ÈÈ 
var
ÍÍ 
result
ÍÍ 
=
ÍÍ 
await
ÍÍ "
_userManager
ÍÍ# /
.
ÍÍ/ 0!
ChangePasswordAsync
ÍÍ0 C
(
ÍÍC D
user
ÍÍD H
,
ÍÍH I
model
ÍÍJ O
.
ÍÍO P
OldPassword
ÍÍP [
,
ÍÍ[ \
model
ÍÍ] b
.
ÍÍb c
NewPassword
ÍÍc n
)
ÍÍn o
;
ÍÍo p
if
ÎÎ 
(
ÎÎ 
result
ÎÎ 
.
ÎÎ 
	Succeeded
ÎÎ $
)
ÎÎ$ %
{
ÏÏ 
await
ÌÌ 
_signInManager
ÌÌ (
.
ÌÌ( )
SignInAsync
ÌÌ) 4
(
ÌÌ4 5
user
ÌÌ5 9
,
ÌÌ9 :
isPersistent
ÌÌ; G
:
ÌÌG H
false
ÌÌI N
)
ÌÌN O
;
ÌÌO P
_logger
ÓÓ 
.
ÓÓ 
LogInformation
ÓÓ *
(
ÓÓ* +
$num
ÓÓ+ ,
,
ÓÓ, -
$str
ÓÓ. Y
)
ÓÓY Z
;
ÓÓZ [
return
ÔÔ 
RedirectToAction
ÔÔ +
(
ÔÔ+ ,
nameof
ÔÔ, 2
(
ÔÔ2 3
Index
ÔÔ3 8
)
ÔÔ8 9
,
ÔÔ9 :
new
ÔÔ; >
{
ÔÔ? @
Message
ÔÔA H
=
ÔÔI J
ManageMessageId
ÔÔK Z
.
ÔÔZ [#
ChangePasswordSuccess
ÔÔ[ p
}
ÔÔq r
)
ÔÔr s
;
ÔÔs t
}
 
	AddErrors
ÒÒ 
(
ÒÒ 
result
ÒÒ  
)
ÒÒ  !
;
ÒÒ! "
return
ÚÚ 
View
ÚÚ 
(
ÚÚ 
model
ÚÚ !
)
ÚÚ! "
;
ÚÚ" #
}
ÛÛ 
return
ÙÙ 
RedirectToAction
ÙÙ #
(
ÙÙ# $
nameof
ÙÙ$ *
(
ÙÙ* +
Index
ÙÙ+ 0
)
ÙÙ0 1
,
ÙÙ1 2
new
ÙÙ3 6
{
ÙÙ7 8
Message
ÙÙ9 @
=
ÙÙA B
ManageMessageId
ÙÙC R
.
ÙÙR S
Error
ÙÙS X
}
ÙÙY Z
)
ÙÙZ [
;
ÙÙ[ \
}
ıı 	
[
˘˘ 	
HttpGet
˘˘	 
]
˘˘ 
public
˙˙ 
IActionResult
˙˙ 
SetPassword
˙˙ (
(
˙˙( )
)
˙˙) *
{
˚˚ 	
return
¸¸ 
View
¸¸ 
(
¸¸ 
)
¸¸ 
;
¸¸ 
}
˝˝ 	
[
ÅÅ 	
HttpPost
ÅÅ	 
]
ÅÅ 
[
ÇÇ 	&
ValidateAntiForgeryToken
ÇÇ	 !
]
ÇÇ! "
public
ÉÉ 
async
ÉÉ 
Task
ÉÉ 
<
ÉÉ 
IActionResult
ÉÉ '
>
ÉÉ' (
SetPassword
ÉÉ) 4
(
ÉÉ4 5"
SetPasswordViewModel
ÉÉ5 I
model
ÉÉJ O
)
ÉÉO P
{
ÑÑ 	
if
ÖÖ 
(
ÖÖ 
!
ÖÖ 

ModelState
ÖÖ 
.
ÖÖ 
IsValid
ÖÖ #
)
ÖÖ# $
{
ÜÜ 
return
áá 
View
áá 
(
áá 
model
áá !
)
áá! "
;
áá" #
}
àà 
var
ää 
user
ää 
=
ää 
await
ää !
GetCurrentUserAsync
ää 0
(
ää0 1
)
ää1 2
;
ää2 3
if
ãã 
(
ãã 
user
ãã 
!=
ãã 
null
ãã 
)
ãã 
{
åå 
var
çç 
result
çç 
=
çç 
await
çç "
_userManager
çç# /
.
çç/ 0
AddPasswordAsync
çç0 @
(
çç@ A
user
ççA E
,
ççE F
model
ççG L
.
ççL M
NewPassword
ççM X
)
ççX Y
;
ççY Z
if
éé 
(
éé 
result
éé 
.
éé 
	Succeeded
éé $
)
éé$ %
{
èè 
await
êê 
_signInManager
êê (
.
êê( )
SignInAsync
êê) 4
(
êê4 5
user
êê5 9
,
êê9 :
isPersistent
êê; G
:
êêG H
false
êêI N
)
êêN O
;
êêO P
return
ëë 
RedirectToAction
ëë +
(
ëë+ ,
nameof
ëë, 2
(
ëë2 3
Index
ëë3 8
)
ëë8 9
,
ëë9 :
new
ëë; >
{
ëë? @
Message
ëëA H
=
ëëI J
ManageMessageId
ëëK Z
.
ëëZ [ 
SetPasswordSuccess
ëë[ m
}
ëën o
)
ëëo p
;
ëëp q
}
íí 
	AddErrors
ìì 
(
ìì 
result
ìì  
)
ìì  !
;
ìì! "
return
îî 
View
îî 
(
îî 
model
îî !
)
îî! "
;
îî" #
}
ïï 
return
ññ 
RedirectToAction
ññ #
(
ññ# $
nameof
ññ$ *
(
ññ* +
Index
ññ+ 0
)
ññ0 1
,
ññ1 2
new
ññ3 6
{
ññ7 8
Message
ññ9 @
=
ññA B
ManageMessageId
ññC R
.
ññR S
Error
ññS X
}
ññY Z
)
ññZ [
;
ññ[ \
}
óó 	
[
öö 	
HttpGet
öö	 
]
öö 
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
IActionResult
õõ '
>
õõ' (
ManageLogins
õõ) 5
(
õõ5 6
ManageMessageId
õõ6 E
?
õõE F
message
õõG N
=
õõO P
null
õõQ U
)
õõU V
{
úú 	
ViewData
ùù 
[
ùù 
$str
ùù $
]
ùù$ %
=
ùù& '
message
ûû 
==
ûû 
ManageMessageId
ûû *
.
ûû* + 
RemoveLoginSuccess
ûû+ =
?
ûû> ?
$str
ûû@ a
:
üü 
message
üü 
==
üü 
ManageMessageId
üü ,
.
üü, -
AddLoginSuccess
üü- <
?
üü= >
$str
üü? ^
:
†† 
message
†† 
==
†† 
ManageMessageId
†† ,
.
††, -
Error
††- 2
?
††3 4
$str
††5 M
:
°° 
$str
°° 
;
°° 
var
¢¢ 
user
¢¢ 
=
¢¢ 
await
¢¢ !
GetCurrentUserAsync
¢¢ 0
(
¢¢0 1
)
¢¢1 2
;
¢¢2 3
if
££ 
(
££ 
user
££ 
==
££ 
null
££ 
)
££ 
{
§§ 
return
•• 
View
•• 
(
•• 
$str
•• #
)
••# $
;
••$ %
}
¶¶ 
var
ßß 

userLogins
ßß 
=
ßß 
await
ßß "
_userManager
ßß# /
.
ßß/ 0
GetLoginsAsync
ßß0 >
(
ßß> ?
user
ßß? C
)
ßßC D
;
ßßD E
var
®® 
schemes
®® 
=
®® 
await
®® 
_signInManager
®®  .
.
®®. /3
%GetExternalAuthenticationSchemesAsync
®®/ T
(
®®T U
)
®®U V
;
®®V W
var
©© 
otherLogins
©© 
=
©© 
schemes
©© %
.
©©% &
Where
©©& +
(
©©+ ,
auth
©©, 0
=>
©©1 3

userLogins
©©4 >
.
©©> ?
All
©©? B
(
©©B C
ul
©©C E
=>
©©F H
auth
©©I M
.
©©M N
Name
©©N R
!=
©©S U
ul
©©V X
.
©©X Y
LoginProvider
©©Y f
)
©©f g
)
©©g h
.
©©h i
ToList
©©i o
(
©©o p
)
©©p q
;
©©q r
ViewData
™™ 
[
™™ 
$str
™™ '
]
™™' (
=
™™) *
user
™™+ /
.
™™/ 0
PasswordHash
™™0 <
!=
™™= ?
null
™™@ D
||
™™E G

userLogins
™™H R
.
™™R S
Count
™™S X
>
™™Y Z
$num
™™[ \
;
™™\ ]
return
´´ 
View
´´ 
(
´´ 
new
´´ #
ManageLoginsViewModel
´´ 1
{
¨¨ 
CurrentLogins
≠≠ 
=
≠≠ 

userLogins
≠≠  *
,
≠≠* +
OtherLogins
ÆÆ 
=
ÆÆ 
otherLogins
ÆÆ )
}
ØØ 
)
ØØ 
;
ØØ 
}
∞∞ 	
[
¥¥ 	
HttpPost
¥¥	 
]
¥¥ 
[
µµ 	&
ValidateAntiForgeryToken
µµ	 !
]
µµ! "
public
∂∂ 
async
∂∂ 
Task
∂∂ 
<
∂∂ 
IActionResult
∂∂ '
>
∂∂' (
	LinkLogin
∂∂) 2
(
∂∂2 3
string
∂∂3 9
provider
∂∂: B
)
∂∂B C
{
∑∑ 	
await
ππ 
HttpContext
ππ 
.
ππ 
SignOutAsync
ππ *
(
ππ* +
IdentityConstants
ππ+ <
.
ππ< =
ExternalScheme
ππ= K
)
ππK L
;
ππL M
var
ºº 
redirectUrl
ºº 
=
ºº 
Url
ºº !
.
ºº! "
Action
ºº" (
(
ºº( )
nameof
ºº) /
(
ºº/ 0
LinkLoginCallback
ºº0 A
)
ººA B
,
ººB C
$str
ººD L
)
ººL M
;
ººM N
var
ΩΩ 

properties
ΩΩ 
=
ΩΩ 
_signInManager
ΩΩ +
.
ΩΩ+ ,7
)ConfigureExternalAuthenticationProperties
ΩΩ, U
(
ΩΩU V
provider
ΩΩV ^
,
ΩΩ^ _
redirectUrl
ΩΩ` k
,
ΩΩk l
_userManager
ΩΩm y
.
ΩΩy z
	GetUserIdΩΩz É
(ΩΩÉ Ñ
UserΩΩÑ à
)ΩΩà â
)ΩΩâ ä
;ΩΩä ã
return
ææ 
	Challenge
ææ 
(
ææ 

properties
ææ '
,
ææ' (
provider
ææ) 1
)
ææ1 2
;
ææ2 3
}
øø 	
[
√√ 	
HttpGet
√√	 
]
√√ 
public
ƒƒ 
async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
ActionResult
ƒƒ &
>
ƒƒ& '
LinkLoginCallback
ƒƒ( 9
(
ƒƒ9 :
)
ƒƒ: ;
{
≈≈ 	
var
∆∆ 
user
∆∆ 
=
∆∆ 
await
∆∆ !
GetCurrentUserAsync
∆∆ 0
(
∆∆0 1
)
∆∆1 2
;
∆∆2 3
if
«« 
(
«« 
user
«« 
==
«« 
null
«« 
)
«« 
{
»» 
return
…… 
View
…… 
(
…… 
$str
…… #
)
……# $
;
……$ %
}
   
var
ÀÀ 
info
ÀÀ 
=
ÀÀ 
await
ÀÀ 
_signInManager
ÀÀ +
.
ÀÀ+ ,'
GetExternalLoginInfoAsync
ÀÀ, E
(
ÀÀE F
await
ÀÀF K
_userManager
ÀÀL X
.
ÀÀX Y
GetUserIdAsync
ÀÀY g
(
ÀÀg h
user
ÀÀh l
)
ÀÀl m
)
ÀÀm n
;
ÀÀn o
if
ÃÃ 
(
ÃÃ 
info
ÃÃ 
==
ÃÃ 
null
ÃÃ 
)
ÃÃ 
{
ÕÕ 
return
ŒŒ 
RedirectToAction
ŒŒ '
(
ŒŒ' (
nameof
ŒŒ( .
(
ŒŒ. /
ManageLogins
ŒŒ/ ;
)
ŒŒ; <
,
ŒŒ< =
new
ŒŒ> A
{
ŒŒB C
Message
ŒŒD K
=
ŒŒL M
ManageMessageId
ŒŒN ]
.
ŒŒ] ^
Error
ŒŒ^ c
}
ŒŒd e
)
ŒŒe f
;
ŒŒf g
}
œœ 
var
–– 
result
–– 
=
–– 
await
–– 
_userManager
–– +
.
––+ ,
AddLoginAsync
––, 9
(
––9 :
user
––: >
,
––> ?
info
––@ D
)
––D E
;
––E F
var
—— 
message
—— 
=
—— 
ManageMessageId
—— )
.
——) *
Error
——* /
;
——/ 0
if
““ 
(
““ 
result
““ 
.
““ 
	Succeeded
““  
)
““  !
{
”” 
message
‘‘ 
=
‘‘ 
ManageMessageId
‘‘ )
.
‘‘) *
AddLoginSuccess
‘‘* 9
;
‘‘9 :
await
÷÷ 
HttpContext
÷÷ !
.
÷÷! "
SignOutAsync
÷÷" .
(
÷÷. /
IdentityConstants
÷÷/ @
.
÷÷@ A
ExternalScheme
÷÷A O
)
÷÷O P
;
÷÷P Q
}
◊◊ 
return
ÿÿ 
RedirectToAction
ÿÿ #
(
ÿÿ# $
nameof
ÿÿ$ *
(
ÿÿ* +
ManageLogins
ÿÿ+ 7
)
ÿÿ7 8
,
ÿÿ8 9
new
ÿÿ: =
{
ÿÿ> ?
Message
ÿÿ@ G
=
ÿÿH I
message
ÿÿJ Q
}
ÿÿR S
)
ÿÿS T
;
ÿÿT U
}
ŸŸ 	
private
›› 
void
›› 
	AddErrors
›› 
(
›› 
IdentityResult
›› -
result
››. 4
)
››4 5
{
ﬁﬁ 	
foreach
ﬂﬂ 
(
ﬂﬂ 
var
ﬂﬂ 
error
ﬂﬂ 
in
ﬂﬂ !
result
ﬂﬂ" (
.
ﬂﬂ( )
Errors
ﬂﬂ) /
)
ﬂﬂ/ 0
{
‡‡ 

ModelState
·· 
.
·· 
AddModelError
·· (
(
··( )
string
··) /
.
··/ 0
Empty
··0 5
,
··5 6
error
··7 <
.
··< =
Description
··= H
)
··H I
;
··I J
}
‚‚ 
}
„„ 	
public
ÂÂ 
enum
ÂÂ 
ManageMessageId
ÂÂ #
{
ÊÊ 	
AddPhoneSuccess
ÁÁ 
,
ÁÁ 
AddLoginSuccess
ËË 
,
ËË #
ChangePasswordSuccess
ÈÈ !
,
ÈÈ! "!
SetTwoFactorSuccess
ÍÍ 
,
ÍÍ   
SetPasswordSuccess
ÎÎ 
,
ÎÎ  
RemoveLoginSuccess
ÏÏ 
,
ÏÏ  
RemovePhoneSuccess
ÌÌ 
,
ÌÌ 
Error
ÓÓ 
}
ÔÔ 	
private
ÒÒ 
Task
ÒÒ 
<
ÒÒ 
ApplicationUser
ÒÒ $
>
ÒÒ$ %!
GetCurrentUserAsync
ÒÒ& 9
(
ÒÒ9 :
)
ÒÒ: ;
{
ÚÚ 	
return
ÛÛ 
_userManager
ÛÛ 
.
ÛÛ  
GetUserAsync
ÛÛ  ,
(
ÛÛ, -
HttpContext
ÛÛ- 8
.
ÛÛ8 9
User
ÛÛ9 =
)
ÛÛ= >
;
ÛÛ> ?
}
ÙÙ 	
}
˜˜ 
}¯¯ ¥H
[D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Controllers\BaseController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Controllers &
{ 
public 

class 
BaseController 
<  
T  !
>! "
:# $

Controller% /
{ 
public 
readonly 
string 
ROUTE_CULTURE_NAME 1
=2 3
$str4 =
;= >
public 
readonly 
string !
ROUTE_DEFAULT_CULTURE 4
=5 6
SWCmsConstants7 E
.E F
DefaultF M
.M N
SpecificultureN \
;\ ]
	protected 
string 
_domain  
;  !
	protected 
IConfigurationRoot $
_configuration% 3
;3 4
	protected 
IHostingEnvironment %
_env& *
;* +
private 
string 
_currentLanguage '
;' (
public 
BaseController 
( 
IHostingEnvironment 1
env2 5
)5 6
{ 	
_env 
= 
env 
; 
string   
lang   
=   
	RouteData   #
!=  $ &
null  ' +
&&  , .
	RouteData  / 8
.  8 9
Values  9 ?
[  ? @
ROUTE_CULTURE_NAME  @ R
]  R S
!=  T V
null  W [
?!! 
	RouteData!! 
.!! 
Values!! !
[!!! "
ROUTE_CULTURE_NAME!!" 4
]!!4 5
.!!5 6
ToString!!6 >
(!!> ?
)!!? @
:!!A B!
ROUTE_DEFAULT_CULTURE!!C X
;!!X Y
var$$ 
cultureInfo$$ 
=$$ 
new$$ !
CultureInfo$$" -
($$- .
CurrentLanguage$$. =
)$$= >
;$$> ?
CultureInfo%% 
.%% '
DefaultThreadCurrentCulture%% 3
=%%4 5
cultureInfo%%6 A
;%%A B
CultureInfo&& 
.&& )
DefaultThreadCurrentUICulture&& 5
=&&6 7
cultureInfo&&8 C
;&&C D
}'' 	
public)) 
BaseController)) 
()) 
IHostingEnvironment)) 1
env))2 5
,))5 6
IConfigurationRoot))7 I
configuration))J W
)))W X
{** 	
_configuration++ 
=++ 
configuration++ *
;++* +
_env,, 
=,, 
env,, 
;,, 
string-- 
lang-- 
=-- 
	RouteData-- #
!=--$ &
null--' +
&&--, .
	RouteData--/ 8
.--8 9
Values--9 ?
[--? @
ROUTE_CULTURE_NAME--@ R
]--R S
!=--T V
null--W [
?.. 
	RouteData.. 
... 
Values.. !
[..! "
ROUTE_CULTURE_NAME.." 4
]..4 5
...5 6
ToString..6 >
(..> ?
)..? @
:..A B!
ROUTE_DEFAULT_CULTURE..C X
;..X Y
var11 
cultureInfo11 
=11 
new11 !
CultureInfo11" -
(11- .
CurrentLanguage11. =
)11= >
;11> ?
CultureInfo22 
.22 '
DefaultThreadCurrentCulture22 3
=224 5
cultureInfo226 A
;22A B
CultureInfo33 
.33 )
DefaultThreadCurrentUICulture33 5
=336 7
cultureInfo338 C
;33C D
}44 	
public66 
ViewContext66 
ViewContext66 &
{66' (
get66) ,
;66, -
set66. 1
;661 2
}663 4
	protected88 
string88 
CurrentLanguage88 (
{88) *
get99 
{99 
_currentLanguage::  
=::! "
	RouteData::# ,
?::, -
.::- .
Values::. 4
[::4 5
ROUTE_CULTURE_NAME::5 G
]::G H
!=::I K
null::L P
?;;$ %
	RouteData;;& /
.;;/ 0
Values;;0 6
[;;6 7
ROUTE_CULTURE_NAME;;7 I
];;I J
.;;J K
ToString;;K S
(;;S T
);;T U
.;;U V
ToLower;;V ]
(;;] ^
);;^ _
:;;` a!
ROUTE_DEFAULT_CULTURE;;b w
.;;w x
ToLower;;x 
(	;; Ä
)
;;Ä Å
;
;;Å Ç
return<< 
_currentLanguage<< '
;<<' (
}== 
}>> 	
publicHH 
overrideHH 
voidHH 
OnActionExecutingHH .
(HH. /"
ActionExecutingContextHH/ E
contextHHF M
)HHM N
{II 	
ifJJ 
(JJ 
!JJ 
stringJJ 
.JJ 
IsNullOrEmptyJJ %
(JJ% &&
GlobalConfigurationServiceJJ& @
.JJ@ A
InstanceJJA I
.JJI J
ConnectionStringJJJ Z
)JJZ [
)JJ[ \
{KK 
GetLanguageLL 
(LL 
)LL 
;LL 
}MM 
baseNN 
.NN 
OnActionExecutingNN "
(NN" #
contextNN# *
)NN* +
;NN+ ,
}OO 	
	protectedQQ 
voidQQ 
GetLanguageQQ "
(QQ" #
)QQ# $
{RR 	
_domainVV 
=VV 
stringVV 
.VV 
FormatVV #
(VV# $
$strVV$ /
,VV/ 0
RequestVV1 8
.VV8 9
SchemeVV9 ?
,VV? @
RequestVVA H
.VVH I
HostVVI M
)VVM N
;VVN O
ViewBagXX 
.XX 
cultureXX 
=XX 
CurrentLanguageXX -
;XX- .
}\\ 	
	protected^^ 
async^^ 
Task^^ 
<^^ 
string^^ #
>^^# $
UploadFileAsync^^% 4
(^^4 5
	IFormFile^^5 >
file^^? C
,^^C D
string^^E K

folderPath^^L V
)^^V W
{__ 	
if`` 
(`` 
file`` 
!=`` 
null`` 
&&`` 
file``  $
.``$ %
Length``% +
>``, -
$num``. /
)``/ 0
{aa 
stringbb 
fileNamebb 
=bb  !
awaitbb" '
CommonHelperbb( 4
.bb4 5
UploadFileAsyncbb5 D
(bbD E
SystembbE K
.bbK L
IObbL N
.bbN O
PathbbO S
.bbS T
CombinebbT [
(bb[ \
_envbb\ `
.bb` a
WebRootPathbba l
,bbl m

folderPathbbn x
)bbx y
,bby z
filebb{ 
)	bb Ä
;
bbÄ Å
ifcc 
(cc 
!cc 
stringcc 
.cc 
IsNullOrEmptycc )
(cc) *
fileNamecc* 2
)cc2 3
)cc3 4
{dd 
stringee 
filePathee #
=ee$ %
stringee& ,
.ee, -
Formatee- 3
(ee3 4
$stree4 =
,ee= >

folderPathee? I
,eeI J
fileNameeeK S
)eeS T
;eeT U
returnff 
filePathff #
;ff# $
}gg 
elsehh 
{ii 
returnjj 
stringjj !
.jj! "
Emptyjj" '
;jj' (
}kk 
}ll 
elsemm 
{nn 
returnoo 
stringoo 
.oo 
Emptyoo #
;oo# $
}pp 
}qq 	
	protectedss 
asyncss 
Taskss 
<ss 
Listss !
<ss! "
stringss" (
>ss( )
>ss) *
UploadListFileAsyncss+ >
(ss> ?
stringss? E

folderPathssF P
)ssP Q
{tt 	
Listuu 
<uu 
stringuu 
>uu 
resultuu 
=uu  !
newuu" %
Listuu& *
<uu* +
stringuu+ 1
>uu1 2
(uu2 3
)uu3 4
;uu4 5
varvv 
filesvv 
=vv 
HttpContextvv #
.vv# $
Requestvv$ +
.vv+ ,
Formvv, 0
.vv0 1
Filesvv1 6
;vv6 7
foreachww 
(ww 
varww 
fileww 
inww  
filesww! &
)ww& '
{xx 
stringyy 
fileNameyy 
=yy  !
awaityy" '
UploadFileAsyncyy( 7
(yy7 8
fileyy8 <
,yy< =

folderPathyy> H
)yyH I
;yyI J
ifzz 
(zz 
!zz 
stringzz 
.zz 
IsNullOrEmptyzz )
(zz) *
fileNamezz* 2
)zz2 3
)zz3 4
{{{ 
result|| 
.|| 
Add|| 
(|| 
fileName|| '
)||' (
;||( )
}}} 
}~~ 
return 
result 
; 
}
ÄÄ 	
}
ÅÅ 
}ÇÇ í„
[D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Controllers\HomeController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Mvc 
. 
Controllers &
{ 
[ 
ResponseCache 
( 
CacheProfileName #
=$ %
$str& /
)/ 0
]0 1
[ 
Route 

(
 
$str 
) 
] 
public 

class 
HomeController 
:  !
BaseController" 0
<0 1
HomeController1 ?
>? @
{ 
private   
readonly   
UserManager   $
<  $ %
ApplicationUser  % 4
>  4 5
_userManager  6 B
;  B C
private!! 
readonly!! 
RoleManager!! $
<!!$ %
IdentityRole!!% 1
>!!1 2
_roleManager!!3 ?
;!!? @
public"" 
HomeController"" 
("" 
IHostingEnvironment"" 1
env""2 5
,""5 6
UserManager&& 
<&& 
ApplicationUser&& (
>&&( )
userManager&&* 5
,&&5 6
RoleManager'' 
<'' 
IdentityRole'' $
>''$ %
roleManager''& 1
)(( 
:)) 
base)) 
()) 
env)) 
))) 
{** 	
this++ 
.++ 
_userManager++ 
=++ 
userManager++  +
;+++ ,
this,, 
.,, 
_roleManager,, 
=,, 
roleManager,,  +
;,,+ ,
}00 	
[22 	
HttpPost22	 
]22 
public33 
IActionResult33 
SetLanguage33 (
(33( )
string33) /
culture330 7
,337 8
string339 ?
	returnUrl33@ I
)33I J
{44 	
Response55 
.55 
Cookies55 
.55 
Append55 #
(55# $(
CookieRequestCultureProvider66 ,
.66, -
DefaultCookieName66- >
,66> ?(
CookieRequestCultureProvider77 ,
.77, -
MakeCookieValue77- <
(77< =
new77= @
RequestCulture77A O
(77O P
culture77P W
)77W X
)77X Y
,77Y Z
new88 
CookieOptions88 !
{88" #
Expires88$ +
=88, -
DateTimeOffset88. <
.88< =
UtcNow88= C
.88C D
AddYears88D L
(88L M
$num88M N
)88N O
}88P Q
)99 
;99 
return;; 
LocalRedirect;;  
(;;  !
	returnUrl;;! *
);;* +
;;;+ ,
}<< 	
[>> 	
HttpGet>>	 
]>> 
[?? 	
Route??	 
(?? 
$str?? 
)?? 
]?? 
[@@ 	
Route@@	 
(@@ 
$str@@ 
)@@ 
]@@ 
[CC 	
RouteCC	 
(CC 
$strCC ,
)CC, -
]CC- .
[DD 	
RouteDD	 
(DD 
$strDD <
)DD< =
]DD= >
publicEE 
IActionResultEE 
HomeEE !
(EE! "
stringEE" (
pageNameEE) 1
,EE1 2
intEE3 6
	pageIndexEE7 @
,EE@ A
intEEB E
pageSizeEEF N
=EEO P
$numEEQ S
)EES T
{FF 	
ifHH 
(HH 
stringHH 
.HH 
IsNullOrEmptyHH $
(HH$ %
pageNameHH% -
)HH- .
||HH/ 1
pageNameHH2 :
==HH; =
$strHH> D
)HHD E
{II 
varKK 
getPageKK 
=KK 
FECategoryViewModelKK 1
.KK1 2

RepositoryKK2 <
.KK< =
GetSingleModelKK= K
(KKK L
pKKL M
=>KKN P
pKKQ R
.KKR S
TypeKKS W
==KKX Z
(KK[ \
intKK\ _
)KK_ `
SWCmsConstantsKK` n
.KKn o
CateTypeKKo w
.KKw x
HomeKKx |
&&KK} 
p
KKÄ Å
.
KKÅ Ç
Specificulture
KKÇ ê
==
KKë ì
CurrentLanguage
KKî £
)
KK£ §
;
KK§ •
ifLL 
(LL 
getPageLL 
.LL 
	IsSucceedLL %
&&LL& (
getPageLL) 0
.LL0 1
DataLL1 5
.LL5 6
ViewLL6 :
!=LL; =
nullLL> B
)LLB C
{MM 
ViewBagNN 
.NN 
	pageClassNN %
=NN& '
getPageNN( /
.NN/ 0
DataNN0 4
.NN4 5
CssClassNN5 =
;NN= >
returnOO 
ViewOO 
(OO  
getPageOO  '
.OO' (
DataOO( ,
)OO, -
;OO- .
}PP 
elseQQ 
{RR 
returnSS 
RedirectToActionSS +
(SS+ ,
$strSS, 3
,SS3 4
$strSS5 =
,SS= >
newSS? B
{SSC D
cultureSSE L
=SSM N
CurrentLanguageSSO ^
}SS_ `
)SS` a
;SSa b
}TT 
}UU 
elseVV 
{WW 
varXX 
getPageXX 
=XX 
FECategoryViewModelXX 1
.XX1 2

RepositoryXX2 <
.XX< =
GetSingleModelXX= K
(XXK L
pYY 
=>YY 
pYY 
.YY 
SeoNameYY "
==YY# %
pageNameYY& .
&&YY/ 1
pYY2 3
.YY3 4
SpecificultureYY4 B
==YYC E
CurrentLanguageYYF U
)YYU V
;YYV W
ifZZ 
(ZZ 
getPageZZ 
.ZZ 
	IsSucceedZZ %
&&ZZ& (
getPageZZ) 0
.ZZ0 1
DataZZ1 5
.ZZ5 6
ViewZZ6 :
!=ZZ; =
nullZZ> B
)ZZB C
{[[ 
if\\ 
(\\ 
getPage\\ 
.\\  
Data\\  $
.\\$ %
Type\\% )
==\\* ,
SWCmsConstants\\- ;
.\\; <
CateType\\< D
.\\D E
List\\E I
)\\I J
{]] 
getPage^^ 
.^^  
Data^^  $
.^^$ %
Articles^^% -
.^^- .
Items^^. 3
.^^3 4
ForEach^^4 ;
(^^; <
a^^< =
=>^^> @
{__ 
a`` 
.`` 
Article`` %
.``% &

DetailsUrl``& 0
=``1 2
SwCmsHelper``3 >
.``> ?
GetRouterUrl``? K
(``K L
$str``L U
,``U V
new``W Z
{``[ \
a``] ^
.``^ _
Article``_ f
.``f g
SeoName``g n
}``o p
,``p q
Request``r y
,``y z
Url``{ ~
)``~ 
;	`` Ä
}aa 
)aa 
;aa 
}bb 
ifcc 
(cc 
getPagecc 
.cc  
Datacc  $
.cc$ %
Typecc% )
==cc* ,
SWCmsConstantscc- ;
.cc; <
CateTypecc< D
.ccD E
ListProductccE P
)ccP Q
{dd 
getPageee 
.ee  
Dataee  $
.ee$ %
Productsee% -
.ee- .
Itemsee. 3
.ee3 4
ForEachee4 ;
(ee; <
pee< =
=>ee> @
{ff 
pgg 
.gg 
Productgg %
.gg% &

DetailsUrlgg& 0
=gg1 2
SwCmsHelpergg3 >
.gg> ?
GetRouterUrlgg? K
(ggK L
$strggL U
,ggU V
newggW Z
{gg[ \
pgg] ^
.gg^ _
Productgg_ f
.ggf g
SeoNameggg n
}ggo p
,ggp q
Requestggr y
,ggy z
Urlgg{ ~
)gg~ 
;	gg Ä
}hh 
)hh 
;hh 
}ii 
ViewBagjj 
.jj 
	pageClassjj %
=jj& '
getPagejj( /
.jj/ 0
Datajj0 4
.jj4 5
CssClassjj5 =
;jj= >
returnkk 
Viewkk 
(kk  
getPagekk  '
.kk' (
Datakk( ,
)kk, -
;kk- .
}ll 
elsemm 
{nn 
returnoo 
Redirectoo #
(oo# $
stringoo$ *
.oo* +
Formatoo+ 1
(oo1 2
$stroo2 8
,oo8 9
CurrentLanguageoo: I
)ooI J
)ooJ K
;ooK L
}pp 
}qq 
}rr 	
[tt 	
HttpGettt	 
]tt 
[uu 	
Routeuu	 
(uu 
$struu  
)uu  !
]uu! "
[vv 	
Routevv	 
(vv 
$strvv 1
)vv1 2
]vv2 3
[ww 	
Routeww	 
(ww 
$strww A
)wwA B
]wwB C
publicxx 
IActionResultxx 
Listxx !
(xx! "
stringxx" (
pageNamexx) 1
,xx1 2
intxx3 6
	pageIndexxx7 @
=xxA B
$numxxC D
,xxD E
intxxF I
pageSizexxJ R
=xxS T
$numxxU W
)xxW X
{yy 	
varzz 
getPagezz 
=zz 
FECategoryViewModelzz -
.zz- .

Repositoryzz. 8
.zz8 9
GetSingleModelzz9 G
(zzG H
p{{ 
=>{{ 
p{{ 
.{{ 
Type{{ 
=={{ 
({{  
int{{  #
){{# $
SWCmsConstants{{$ 2
.{{2 3
CateType{{3 ;
.{{; <
Home{{< @
&&{{A C
p{{D E
.{{E F
Specificulture{{F T
=={{U W
CurrentLanguage{{X g
){{g h
;{{h i
if}} 
(}} 
getPage}} 
.}} 
	IsSucceed}} !
)}}! "
{~~ 
return 
View 
( 
getPage #
.# $
Data$ (
)( )
;) *
}
ÄÄ 
else
ÅÅ 
{
ÇÇ 
return
ÉÉ 
Redirect
ÉÉ 
(
ÉÉ  
string
ÉÉ  &
.
ÉÉ& '
Format
ÉÉ' -
(
ÉÉ- .
$str
ÉÉ. 4
,
ÉÉ4 5
CurrentLanguage
ÉÉ6 E
)
ÉÉE F
)
ÉÉF G
;
ÉÉG H
}
ÑÑ 
}
ÖÖ 	
[
áá 	
Route
áá	 
(
áá 
$str
áá 
)
áá 
]
áá 
[
àà 	
Route
àà	 
(
àà 
$str
àà !
)
àà! "
]
àà" #
[
ââ 	
Route
ââ	 
(
ââ 
$str
ââ B
)
ââB C
]
ââC D
[
ää 	
HttpPost
ää	 
,
ää 
HttpGet
ää 
]
ää 
public
ãã 
async
ãã 
System
ãã 
.
ãã 
	Threading
ãã %
.
ãã% &
Tasks
ãã& +
.
ãã+ ,
Task
ãã, 0
<
ãã0 1
IActionResult
ãã1 >
>
ãã> ?
Search
ãã@ F
(
ããF G
int
ããG J
	pageIndex
ããK T
=
ããU V
$num
ããW X
,
ããX Y
int
ããZ ]
pageSize
ãã^ f
=
ããg h
$num
ããi k
,
ããk l
string
ããm s
keyword
ããt {
=
ãã| }
nullãã~ Ç
)ããÇ É
{
åå 	
var
óó 
getArticles
óó 
=
óó 
await
óó #"
InfoArticleViewModel
óó$ 8
.
óó8 9

Repository
óó9 C
.
óóC D!
GetModelListByAsync
óóD W
(
óóW X
article
òò 
=>
òò 
article
òò !
.
òò! "
Specificulture
òò" 0
==
òò1 3
CurrentLanguage
òò4 C
&&
ôô 
article
ôô 
.
ôô 
Status
ôô $
!=
ôô% '
(
ôô( )
int
ôô) ,
)
ôô, -
SWStatus
ôô- 5
.
ôô5 6
Deleted
ôô6 =
&&
öö 
(
öö 
string
õõ 
.
õõ 
IsNullOrEmpty
õõ ,
(
õõ, -
keyword
õõ- 4
)
õõ4 5
||
õõ6 8
article
õõ9 @
.
õõ@ A
Title
õõA F
.
õõF G
Contains
õõG O
(
õõO P
keyword
õõP W
)
õõW X
||
úú 
(
úú 
article
úú #
.
úú# $
Excerpt
úú$ +
!=
úú, .
null
úú/ 3
&&
úú4 6
article
úú7 >
.
úú> ?
Excerpt
úú? F
.
úúF G
Contains
úúG O
(
úúO P
keyword
úúP W
)
úúW X
)
úúX Y
)
ùù 
,
ùù 
$str
ûû  
,
ûû  !
OrderByDirection
ûû" 2
.
ûû2 3

Descending
ûû3 =
,
ûû= >
pageSize
üü 
,
üü 
	pageIndex
üü "
)
üü" #
;
üü# $
var
†† 
getProducts
†† 
=
†† 
await
†† #"
InfoProductViewModel
††$ 8
.
††8 9

Repository
††9 C
.
††C D!
GetModelListByAsync
††D W
(
††W X
Product
°° 
=>
°° 
Product
°° !
.
°°! "
Specificulture
°°" 0
==
°°1 3
CurrentLanguage
°°4 C
&&
¢¢ 
Product
¢¢ 
.
¢¢ 
Status
¢¢ $
!=
¢¢% '
(
¢¢( )
int
¢¢) ,
)
¢¢, -
SWStatus
¢¢- 5
.
¢¢5 6
Deleted
¢¢6 =
&&
££ 
(
££ 
string
§§ 
.
§§ 
IsNullOrEmpty
§§ ,
(
§§, -
keyword
§§- 4
)
§§4 5
||
§§6 8
Product
§§9 @
.
§§@ A
Title
§§A F
.
§§F G
Contains
§§G O
(
§§O P
keyword
§§P W
)
§§W X
||
•• 
(
•• 
Product
•• #
.
••# $
Excerpt
••$ +
!=
••, .
null
••/ 3
&&
••4 6
Product
••7 >
.
••> ?
Excerpt
••? F
.
••F G
Contains
••G O
(
••O P
keyword
••P W
)
••W X
)
••X Y
)
¶¶ 
,
¶¶ 
$str
ßß  
,
ßß  !
OrderByDirection
ßß" 2
.
ßß2 3

Descending
ßß3 =
,
ßß= >
pageSize
®® 
,
®® 
	pageIndex
®® "
)
®®" #
;
®®# $
ViewData
©© 
[
©© 
$str
©© 
]
©©  
=
©©! "
getProducts
©©# .
.
©©. /
Data
©©/ 3
;
©©3 4
return
™™ 
View
™™ 
(
™™ 
getArticles
™™ #
.
™™# $
Data
™™$ (
)
™™( )
;
™™) *
}
´´ 	
[
≠≠ 	
HttpGet
≠≠	 
]
≠≠ 
[
ÆÆ 	
Route
ÆÆ	 
(
ÆÆ 
$str
ÆÆ 
)
ÆÆ 
]
ÆÆ  
[
ØØ 	
Route
ØØ	 
(
ØØ 
$str
ØØ ?
)
ØØ? @
]
ØØ@ A
[
∞∞ 	
HttpPost
∞∞	 
,
∞∞ 
HttpGet
∞∞ 
]
∞∞ 
public
±± 
async
±± 
System
±± 
.
±± 
	Threading
±± %
.
±±% &
Tasks
±±& +
.
±±+ ,
Task
±±, 0
<
±±0 1
IActionResult
±±1 >
>
±±> ?
Tag
±±@ C
(
±±C D
int
±±D G
	pageIndex
±±H Q
=
±±R S
$num
±±T U
,
±±U V
int
±±W Z
pageSize
±±[ c
=
±±d e
$num
±±f h
,
±±h i
string
±±j p
keyword
±±q x
=
±±y z
null
±±{ 
)±± Ä
{
≤≤ 	
var
ºº 
getArticles
ºº 
=
ºº 
await
ºº #"
InfoArticleViewModel
ºº$ 8
.
ºº8 9

Repository
ºº9 C
.
ººC D!
GetModelListByAsync
ººD W
(
ººW X
cate
ΩΩ 
=>
ΩΩ 
cate
ΩΩ 
.
ΩΩ 
Specificulture
ΩΩ *
==
ΩΩ+ -
CurrentLanguage
ΩΩ. =
&&
ææ 
cate
ææ 
.
ææ 
Status
ææ !
!=
ææ" $
(
ææ% &
int
ææ& )
)
ææ) *
SWStatus
ææ* 2
.
ææ2 3
Deleted
ææ3 :
&&
øø 
(
øø 
string
øø 
.
øø 
IsNullOrEmpty
øø +
(
øø+ ,
keyword
øø, 3
)
øø3 4
||
øø5 7
cate
øø8 <
.
øø< =
Tags
øø= A
.
øøA B
Contains
øøB J
(
øøJ K
keyword
øøK R
)
øøR S
)
øøS T
,
øøT U
$str
¿¿  
,
¿¿  !
OrderByDirection
¿¿" 2
.
¿¿2 3

Descending
¿¿3 =
,
¿¿= >
pageSize
¡¡ 
,
¡¡ 
	pageIndex
¡¡ "
)
¡¡" #
;
¡¡# $
var
¬¬ 
getProducts
¬¬ 
=
¬¬ 
await
¬¬ #"
InfoProductViewModel
¬¬$ 8
.
¬¬8 9

Repository
¬¬9 C
.
¬¬C D!
GetModelListByAsync
¬¬D W
(
¬¬W X
Product
√√ 
=>
√√ 
Product
√√ !
.
√√! "
Specificulture
√√" 0
==
√√1 3
CurrentLanguage
√√4 C
&&
ƒƒ 
Product
ƒƒ 
.
ƒƒ 
Status
ƒƒ $
!=
ƒƒ% '
(
ƒƒ( )
int
ƒƒ) ,
)
ƒƒ, -
SWStatus
ƒƒ- 5
.
ƒƒ5 6
Deleted
ƒƒ6 =
&&
≈≈ 
(
≈≈ 
string
∆∆ 
.
∆∆ 
IsNullOrEmpty
∆∆ ,
(
∆∆, -
keyword
∆∆- 4
)
∆∆4 5
||
∆∆6 8
Product
∆∆9 @
.
∆∆@ A
Tags
∆∆A E
.
∆∆E F
Contains
∆∆F N
(
∆∆N O
keyword
∆∆O V
)
∆∆V W
)
«« 
,
«« 
$str
»»  
,
»»  !
OrderByDirection
»»" 2
.
»»2 3

Descending
»»3 =
,
»»= >
pageSize
…… 
,
…… 
	pageIndex
…… "
)
……" #
;
……# $
ViewData
   
[
   
$str
   
]
    
=
  ! "
getProducts
  # .
.
  . /
Data
  / 3
;
  3 4
return
ÀÀ 
View
ÀÀ 
(
ÀÀ 
getArticles
ÀÀ #
.
ÀÀ# $
Data
ÀÀ$ (
)
ÀÀ( )
;
ÀÀ) *
}
ÃÃ 	
[
ŒŒ 	
HttpGet
ŒŒ	 
]
ŒŒ 
[
œœ 	
Route
œœ	 
(
œœ 
$str
œœ  
)
œœ  !
]
œœ! "
public
–– 
IActionResult
–– 
Article
–– $
(
––$ %
string
––% +
pageName
––, 4
)
––4 5
{
—— 	
var
““ 
getPage
““ 
=
““ !
FECategoryViewModel
““ -
.
““- .

Repository
““. 8
.
““8 9
GetSingleModel
““9 G
(
““G H
p
”” 
=>
”” 
p
”” 
.
”” 
Type
”” 
==
”” 
(
””  
int
””  #
)
””# $
SWCmsConstants
””$ 2
.
””2 3
CateType
””3 ;
.
””; <
Home
””< @
&&
””A C
p
””D E
.
””E F
Specificulture
””F T
==
””U W
CurrentLanguage
””X g
)
””g h
;
””h i
if
’’ 
(
’’ 
getPage
’’ 
.
’’ 
	IsSucceed
’’ !
)
’’! "
{
÷÷ 
return
◊◊ 
View
◊◊ 
(
◊◊ 
getPage
◊◊ #
.
◊◊# $
Data
◊◊$ (
)
◊◊( )
;
◊◊) *
}
ÿÿ 
else
ŸŸ 
{
⁄⁄ 
return
€€ 
Redirect
€€ 
(
€€  
string
€€  &
.
€€& '
Format
€€' -
(
€€- .
$str
€€. 4
,
€€4 5
CurrentLanguage
€€6 E
)
€€E F
)
€€F G
;
€€G H
}
‹‹ 
}
›› 	
[
ﬂﬂ 	
HttpGet
ﬂﬂ	 
]
ﬂﬂ 
[
‡‡ 	
Route
‡‡	 
(
‡‡ 
$str
‡‡ "
)
‡‡" #
]
‡‡# $
[
·· 	
Route
··	 
(
·· 
$str
·· 0
)
··0 1
]
··1 2
public
‚‚ 
IActionResult
‚‚ 
ArticleDetails
‚‚ +
(
‚‚+ ,
string
‚‚, 2
SeoName
‚‚3 :
,
‚‚: ;
string
‚‚< B
CateSeoName
‚‚C N
=
‚‚O P
null
‚‚Q U
)
‚‚U V
{
„„ 	
var
‰‰ 

getArticle
‰‰ 
=
‰‰  
FEArticleViewModel
‰‰ /
.
‰‰/ 0

Repository
‰‰0 :
.
‰‰: ;
GetSingleModel
‰‰; I
(
‰‰I J
a
ÂÂ 
=>
ÂÂ 
a
ÂÂ 
.
ÂÂ 
SeoName
ÂÂ 
==
ÂÂ !
SeoName
ÂÂ" )
&&
ÂÂ* ,
a
ÂÂ- .
.
ÂÂ. /
Specificulture
ÂÂ/ =
==
ÂÂ> @
CurrentLanguage
ÂÂA P
)
ÂÂP Q
;
ÂÂQ R
ViewData
ÊÊ 
[
ÊÊ 
$str
ÊÊ "
]
ÊÊ" #
=
ÊÊ$ %
CateSeoName
ÊÊ& 1
;
ÊÊ1 2
if
ËË 
(
ËË 

getArticle
ËË 
.
ËË 
	IsSucceed
ËË $
)
ËË$ %
{
ÈÈ 
return
ÍÍ 
View
ÍÍ 
(
ÍÍ 

getArticle
ÍÍ &
.
ÍÍ& '
Data
ÍÍ' +
)
ÍÍ+ ,
;
ÍÍ, -
}
ÎÎ 
else
ÏÏ 
{
ÌÌ 
return
ÓÓ 
Redirect
ÓÓ 
(
ÓÓ  
string
ÓÓ  &
.
ÓÓ& '
Format
ÓÓ' -
(
ÓÓ- .
$str
ÓÓ. 4
,
ÓÓ4 5
CurrentLanguage
ÓÓ6 E
)
ÓÓE F
)
ÓÓF G
;
ÓÓG H
}
ÔÔ 
}
 	
[
ÚÚ 	
HttpGet
ÚÚ	 
]
ÚÚ 
[
ÛÛ 	
Route
ÛÛ	 
(
ÛÛ 
$str
ÛÛ "
)
ÛÛ" #
]
ÛÛ# $
[
ÙÙ 	
Route
ÙÙ	 
(
ÙÙ 
$str
ÙÙ 0
)
ÙÙ0 1
]
ÙÙ1 2
public
ıı 
IActionResult
ıı 
ProductDetails
ıı +
(
ıı+ ,
string
ıı, 2
SeoName
ıı3 :
,
ıı: ;
string
ıı< B
CateSeoName
ııC N
=
ııO P
null
ııQ U
)
ııU V
{
ˆˆ 	
var
˜˜ 

getProduct
˜˜ 
=
˜˜  
FEProductViewModel
˜˜ /
.
˜˜/ 0

Repository
˜˜0 :
.
˜˜: ;
GetSingleModel
˜˜; I
(
˜˜I J
a
¯¯ 
=>
¯¯ 
a
¯¯ 
.
¯¯ 
SeoName
¯¯ 
==
¯¯ !
SeoName
¯¯" )
&&
¯¯* ,
a
¯¯- .
.
¯¯. /
Specificulture
¯¯/ =
==
¯¯> @
CurrentLanguage
¯¯A P
)
¯¯P Q
;
¯¯Q R
ViewData
˘˘ 
[
˘˘ 
$str
˘˘ "
]
˘˘" #
=
˘˘$ %
CateSeoName
˘˘& 1
;
˘˘1 2
if
˚˚ 
(
˚˚ 

getProduct
˚˚ 
.
˚˚ 
	IsSucceed
˚˚ $
)
˚˚$ %
{
¸¸ 
return
˝˝ 
View
˝˝ 
(
˝˝ 

getProduct
˝˝ &
.
˝˝& '
Data
˝˝' +
)
˝˝+ ,
;
˝˝, -
}
˛˛ 
else
ˇˇ 
{
ÄÄ 
return
ÅÅ 
Redirect
ÅÅ 
(
ÅÅ  
string
ÅÅ  &
.
ÅÅ& '
Format
ÅÅ' -
(
ÅÅ- .
$str
ÅÅ. 4
,
ÅÅ4 5
CurrentLanguage
ÅÅ6 E
)
ÅÅE F
)
ÅÅF G
;
ÅÅG H
}
ÇÇ 
}
ÉÉ 	
[
ÜÜ 	
HttpGet
ÜÜ	 
]
ÜÜ 
[
áá 	
Route
áá	 
(
áá 
$str
áá #
)
áá# $
]
áá$ %
public
àà 
ActionResult
àà 
Scriban
àà #
(
àà# $
string
àà$ *
pageName
àà+ 3
)
àà3 4
{
ââ 	
Product
ää 
products
ää 
=
ää 
new
ää "
Product
ää# *
(
ää* +
)
ää+ ,
;
ää, -
products
ãã 
.
ãã 
Products
ãã 
=
ãã 
new
ãã  #
ProductList
ãã$ /
[
ãã/ 0
$num
ãã0 1
]
ãã1 2
;
ãã2 3
products
åå 
.
åå 
Products
åå 
[
åå 
$num
åå 
]
åå  
=
åå! "
new
åå# &
ProductList
åå' 2
{
åå3 4
Name
åå5 9
=
åå: ;
$str
åå< A
,
ååA B
Price
ååC H
=
ååI J
$num
ååK M
,
ååM N
Description
ååO Z
=
åå[ \
$str
åå] j
}
ååk l
;
åål m
products
çç 
.
çç 
Products
çç 
[
çç 
$num
çç 
]
çç  
=
çç! "
new
çç# &
ProductList
çç' 2
{
çç3 4
Name
çç5 9
=
çç: ;
$str
çç< A
,
ççA B
Price
ççC H
=
ççI J
(
ççK L
float
ççL Q
)
ççQ R
$num
ççR V
,
ççV W
Description
ççX c
=
ççd e
$str
ççf s
}
ççt u
;
ççu v
products
éé 
.
éé 
Products
éé 
[
éé 
$num
éé 
]
éé  
=
éé! "
new
éé# &
ProductList
éé' 2
{
éé3 4
Name
éé5 9
=
éé: ;
$str
éé< A
,
ééA B
Price
ééC H
=
ééI J
$num
ééK M
,
ééM N
Description
ééO Z
=
éé[ \
$str
éé] j
}
éék l
;
éél m
var
êê 
getPage
êê 
=
êê !
FECategoryViewModel
êê -
.
êê- .

Repository
êê. 8
.
êê8 9
GetSingleModel
êê9 G
(
êêG H
p
ëë 
=>
ëë 
p
ëë 
.
ëë 
SeoName
ëë !
==
ëë" $
pageName
ëë% -
&&
ëë. 0
p
ëë1 2
.
ëë2 3
Specificulture
ëë3 A
==
ëëB D
CurrentLanguage
ëëE T
)
ëëT U
;
ëëU V
string
ìì 
	tmpsource
ìì 
=
ìì 
getPage
ìì &
.
ìì& '
Data
ìì' +
.
ìì+ ,
View
ìì, 0
.
ìì0 1

SpaContent
ìì1 ;
!=
ìì< >
$str
ìì? A
?
ììB C
getPage
ììD K
.
ììK L
Data
ììL P
.
ììP Q
View
ììQ U
.
ììU V

SpaContent
ììV `
:
ììa b
$str
ìùc  
;
ùù  !
var
ûû 
template
ûû 
=
ûû 
Template
ûû #
.
ûû# $
Parse
ûû$ )
(
ûû) *
	tmpsource
ûû* 3
)
ûû3 4
;
ûû4 5
string
üü 
result
üü 
=
üü 
template
üü $
.
üü$ %
Render
üü% +
(
üü+ ,
products
üü, 4
)
üü4 5
;
üü5 6
if
°° 
(
°° 
getPage
°° 
.
°° 
	IsSucceed
°° !
)
°°! "
{
¢¢ 
return
££ 
new
££ 
ContentResult
££ (
(
££( )
)
££) *
{
§§ 
Content
•• 
=
•• 
result
•• $
,
••$ %
ContentType
¶¶ 
=
¶¶  !
$str
¶¶" -
,
¶¶- .
}
ßß 
;
ßß 
}
®® 
else
©© 
{
™™ 
return
´´ 
Content
´´ 
(
´´ 
$str
´´ '
)
´´' (
;
´´( )
}
¨¨ 
}
≠≠ 	
private
ØØ 
class
ØØ 
Product
ØØ 
{
∞∞ 	
public
±± 
ProductList
±± 
[
±± 
]
±±  
Products
±±! )
{
±±* +
get
±±, /
;
±±/ 0
set
±±1 4
;
±±4 5
}
±±6 7
}
≤≤ 	
private
¥¥ 
class
¥¥ 
ProductList
¥¥ !
{
µµ 	
public
∂∂ 
string
∂∂ 
Name
∂∂ 
{
∂∂  
get
∂∂! $
;
∂∂$ %
set
∂∂& )
;
∂∂) *
}
∂∂+ ,
public
∑∑ 
float
∑∑ 
Price
∑∑ 
{
∑∑  
get
∑∑! $
;
∑∑$ %
set
∑∑& )
;
∑∑) *
}
∑∑+ ,
public
∏∏ 
string
∏∏ 
Description
∏∏ %
{
∏∏& '
get
∏∏( +
;
∏∏+ ,
set
∏∏- 0
;
∏∏0 1
}
∏∏2 3
}
ππ 	
}
∫∫ 
}ªª ¨
^D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Controllers\InitCmsController.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
. 
Controllers *
{ 
public 

class 
InitCmsController "
:# $
BaseController% 3
<3 4
InitCmsController4 E
>E F
{ 
private 
readonly 
UserManager $
<$ %
ApplicationUser% 4
>4 5
_userManager6 B
;B C
private 
readonly 
RoleManager $
<$ %
IdentityRole% 1
>1 2
_roleManager3 ?
;? @
public 
InitCmsController  
(  !
IHostingEnvironment! 4
env5 8
,8 9
UserManager 
< 
ApplicationUser (
>( )
userManager* 5
,5 6
RoleManager 
< 
IdentityRole $
>$ %
roleManager& 1
) 
: 
base 
( 
env 
) 
{ 	
this 
. 
_userManager 
= 
userManager  +
;+ ,
this 
. 
_roleManager 
= 
roleManager  +
;+ ,
} 	
[   	
HttpGet  	 
]   
[!! 	
Route!!	 
(!! 
$str!! 
)!! 
]!! 
["" 	
Route""	 
("" 
$str"" 
)"" 
]"" 
public## 
async## 
System## 
.## 
	Threading## %
.##% &
Tasks##& +
.##+ ,
Task##, 0
<##0 1
IActionResult##1 >
>##> ?
Index##@ E
(##E F
)##F G
{$$ 	
if%% 
(%% 
string%% 
.%% 
IsNullOrEmpty%% $
(%%$ %&
GlobalConfigurationService%%% ?
.%%? @
Instance%%@ H
.%%H I"
GetConfigConnectionKey%%I _
(%%_ `
)%%` a
)%%a b
)%%b c
{&& 
return'' 
RedirectToAction'' '
(''' (
$str''( .
,''. /
$str''0 8
,''8 9
new'': =
{''> ?
culture''@ G
=''H I!
ROUTE_DEFAULT_CULTURE''J _
}''` a
)''a b
;''b c
}(( 
else)) 
{** 
var++ 

superAdmin++ 
=++  
await++! &
_userManager++' 3
.++3 4
GetUsersInRoleAsync++4 G
(++G H
$str++H T
)++T U
;++U V
if,, 
(,, 

superAdmin,, 
.,, 
Count,, $
==,,% '
$num,,( )
),,) *
{-- 
return.. 
Redirect.. #
(..# $
$"..$ &
/..& '
{..' (!
ROUTE_DEFAULT_CULTURE..( =
}..= >+
/Portal/Auth/RegisterSuperAdmin..> ]
"..] ^
)..^ _
;.._ `
}// 
else00 
{11 &
GlobalConfigurationService22 .
.22. /
Instance22/ 7
.227 8
IsInit228 >
=22? @
true22A E
;22E F&
GlobalConfigurationService33 .
.33. /
Instance33/ 7
.337 8
Refresh338 ?
(33? @
)33@ A
;33A B
return44 
RedirectToAction44 +
(44+ ,
$str44, .
,44. /
$str440 6
,446 7
new448 ;
{44< =
culture44> E
=44F G
CurrentLanguage44H W
}44X Y
)44Y Z
;44Z [
}55 
}66 
}77 	
}88 
}99 Ä
VD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Models\ErrorViewModel.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
. 
Models %
{ 
public 

class 
ErrorViewModel 
{ 
public		 
string		 
	RequestId		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
} ¸
\D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Models\Identity\JWTSettings.cs
	namespace		 	
Swastika		
 
.		 
Cms		 
.		 
Web		 
.		 
Mvc		 
.		 
Models		 %
.		% &
Identity		& .
{

 
public 

class 
JwtSettings 
{ 
public 
string 
	SecretKey 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
Issuer 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Audience 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ò

HD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Program.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
BuildWebHost 
( 
args 
) 
. 
Run "
(" #
)# $
;$ %
} 	
public 
static 
IWebHost 
BuildWebHost +
(+ ,
string, 2
[2 3
]3 4
args5 9
)9 :
=>; =
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
<  
Startup  '
>' (
(( )
)) *
. "
UseApplicationInsights +
(+ ,
), -
. 
Build 
( 
) 
; 
} 
} Øb
HD:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\Startup.cs
	namespace 	
Swastika
 
. 
Cms 
. 
Web 
. 
Mvc 
{ 
public 

partial 
class 
Startup  
{ 
public 
const 
string '
CONST_ROUTE_DEFAULT_CULTURE 7
=8 9
$str: A
;A B
public 
Startup 
( 
IHostingEnvironment *
env+ .
). /
{   	
var!! 
builder!! 
=!! 
new!!  
ConfigurationBuilder!! 2
(!!2 3
)!!3 4
."" 
SetBasePath"" 
("" 
env""  
.""  !
ContentRootPath""! 0
)""0 1
.## 
AddJsonFile## 
(## 
$str## /
,##/ 0
optional##1 9
:##9 :
false##; @
,##@ A
reloadOnChange##B P
:##P Q
true##R V
)##V W
.$$ 
AddJsonFile$$ 
($$ 
$"$$ 
appsettings.$$ +
{$$+ ,
env$$, /
.$$/ 0
EnvironmentName$$0 ?
}$$? @
.json$$@ E
"$$E F
,$$F G
optional$$H P
:$$P Q
true$$R V
)$$V W
;$$W X
if&& 
(&& 
env&& 
.&& 
IsDevelopment&& !
(&&! "
)&&" #
)&&# $
{'' 
}** 
builder,, 
.,, #
AddEnvironmentVariables,, +
(,,+ ,
),,, -
;,,- .
Configuration-- 
=-- 
builder-- #
.--# $
Build--$ )
(--) *
)--* +
;--+ ,
}.. 	
public00 
IConfigurationRoot00 !
Configuration00" /
{000 1
get002 5
;005 6
}007 8
public33 
void33 
ConfigureServices33 %
(33% &
IServiceCollection33& 8
services339 A
)33A B
{44 	
services77 
.77 
AddDbContext77 !
<77! "
SiocCmsContext77" 0
>770 1
(771 2
options772 9
=>77: <
options88 
.88 
UseSqlServer88 $
(88$ %
Configuration88% 2
.882 3
GetConnectionString883 F
(88F G
Swastika88G O
.88O P
Cms88P S
.88S T
Lib88T W
.88W X
SWCmsConstants88X f
.88f g$
CONST_DEFAULT_CONNECTION88g 
)	88 Ä
)
88Ä Å
)
88Å Ç
;
88Ç É
services;; 
.;; 
	Configure;; 
<;; 
WebEncoderOptions;; 0
>;;0 1
(;;1 2
options;;2 9
=>;;: <
options;;= D
.;;D E
TextEncoderSettings;;E X
=;;Y Z
new;;[ ^
TextEncoderSettings;;_ r
(;;r s
UnicodeRanges	;;s Ä
.
;;Ä Å
All
;;Å Ñ
)
;;Ñ Ö
)
;;Ö Ü
;
;;Ü á
services<< 
.<< 
	Configure<< 
<<< 
FormOptions<< *
><<* +
(<<+ ,
options<<, 3
=><<4 6
options<<7 >
.<<> ?$
MultipartBodyLengthLimit<<? W
=<<X Y
$num<<Z c
)<<c d
;<<d e
ConfigIdentity?? 
(?? 
services?? #
,??# $
Configuration??% 2
,??2 3
Swastika??4 <
.??< =
Cms??= @
.??@ A
Lib??A D
.??D E
SWCmsConstants??E S
.??S T$
CONST_DEFAULT_CONNECTION??T l
)??l m
;??m n
ConfigCookieAuthCC 
(CC 
servicesCC %
,CC% &
ConfigurationCC' 4
)CC4 5
;CC5 6
ConfigJWTTokenDD 
(DD 
servicesDD #
,DD# $
ConfigurationDD% 2
)DD2 3
;DD3 4
servicesGG 
.GG 
AddTransientGG !
<GG! "
IEmailSenderGG" .
,GG. /"
AuthEmailMessageSenderGG0 F
>GGF G
(GGG H
)GGH I
;GGI J
servicesHH 
.HH 
AddTransientHH !
<HH! "

ISmsSenderHH" ,
,HH, - 
AuthSmsMessageSenderHH. B
>HHB C
(HHC D
)HHD E
;HHE F
servicesKK 
.KK 
AddSingletonKK !
<KK! "&
GlobalConfigurationServiceKK" <
>KK< =
(KK= >
)KK> ?
;KK? @
servicesLL 
.LL 
AddSingletonLL !
<LL! "!
GlobalLanguageServiceLL" 7
>LL7 8
(LL8 9
)LL9 :
;LL: ;
servicesMM 
.MM 
AddSingletonMM !
<MM! "
IConfigurationRootMM" 4
>MM4 5
(MM5 6
ConfigurationMM6 C
)MMC D
;MMD E
servicesNN 
.NN 
	AddScopedNN 
<NN 
IViewRenderServiceNN 1
,NN1 2
ViewRenderServiceNN3 D
>NND E
(NNE F
)NNF G
;NNG H
servicesPP 
.PP 

AddRoutingPP 
(PP  
optionsPP  '
=>PP( *
optionsPP+ 2
.PP2 3
LowercaseUrlsPP3 @
=PPA B
truePPC G
)PPG H
;PPH I
servicesQQ 
.QQ 
AddMvcQQ 
(QQ 
optionsQQ #
=>QQ$ &
{RR 
optionsSS 
.SS 
CacheProfilesSS %
.SS% &
AddSS& )
(SS) *
$strSS* 3
,SS3 4
newTT 
CacheProfileTT $
(TT$ %
)TT% &
{UU 
DurationVV  
=VV! "
$numVV# %
}WW 
)WW 
;WW 
}^^ 
)^^ 
;^^ 
}ee 	
publichh 
voidhh 
	Configurehh 
(hh 
IApplicationBuilderhh 1
apphh2 5
,hh5 6
IHostingEnvironmenthh7 J
envhhK N
,hhN O
ILoggerFactoryhhP ^
loggerFactoryhh_ l
)hhl m
{ii 	
loggerFactoryjj 
.jj 

AddConsolejj $
(jj$ %
Configurationjj% 2
.jj2 3

GetSectionjj3 =
(jj= >
$strjj> G
)jjG H
)jjH I
;jjI J
loggerFactorykk 
.kk 
AddDebugkk "
(kk" #
)kk# $
;kk$ %
appll 
.ll 
UseCorsll 
(ll 
optionll 
=>ll !
{ll" #
optionll$ *
.ll* +
AllowAnyMethodll+ 9
(ll9 :
)ll: ;
;ll; <
optionll= C
.llC D
AllowAnyOriginllD R
(llR S
)llS T
;llT U
optionllV \
.ll\ ]
AllowAnyHeaderll] k
(llk l
)lll m
;llm n
}llo p
)llp q
;llq r
ifmm 
(mm 
envmm 
.mm 
IsDevelopmentmm !
(mm! "
)mm" #
)mm# $
{nn 
appoo 
.oo %
UseDeveloperExceptionPageoo -
(oo- .
)oo. /
;oo/ 0
apppp 
.pp  
UseDatabaseErrorPagepp (
(pp( )
)pp) *
;pp* +
appqq 
.qq 
UseBrowserLinkqq "
(qq" #
)qq# $
;qq$ %
}rr 
elsess 
{tt 
appvv 
.vv %
UseDeveloperExceptionPagevv -
(vv- .
)vv. /
;vv/ 0
}ww 
app|| 
.|| 
UseStaticFiles|| 
(|| 
)||  
;||  !
app}} 
.}} 
UseAuthentication}} !
(}}! "
)}}" #
;}}# $
app
åå 
.
åå 
UseMvc
åå 
(
åå 
routes
åå 
=>
åå  
{
çç 
routes
éé 
.
éé 
MapRoute
éé 
(
éé  
name
èè 
:
èè 
$str
èè %
,
èè% &
template
êê 
:
êê 
$str
êê )
+
êê* +)
CONST_ROUTE_DEFAULT_CULTURE
êê, G
+
êêH I
$str
êêJ ~
)
êê~ 
;êê Ä
routes
ëë 
.
ëë 
MapRoute
ëë 
(
ëë  
name
íí 
:
íí 
$str
íí &
,
íí& '
template
ìì 
:
ìì 
$str
ìì )
+
ìì* +)
CONST_ROUTE_DEFAULT_CULTURE
ìì, G
+
ììH I
$strììJ Ñ
)ììÑ Ö
;ììÖ Ü
routes
ïï 
.
ïï 
MapRoute
ïï 
(
ïï  
name
ññ 
:
ññ 
$str
ññ $
,
ññ$ %
template
óó 
:
óó 
$str
óó -
+
óó. /)
CONST_ROUTE_DEFAULT_CULTURE
óó0 K
+
óóL M
$stróóN Ç
)óóÇ É
;óóÉ Ñ
routes
òò 
.
òò 
MapRoute
òò 
(
òò  
name
ôô 
:
ôô 
$str
ôô *
,
ôô* +
template
öö 
:
öö 
$str
öö T
)
ööT U
;
ööU V
routes
õõ 
.
õõ 
MapRoute
õõ 
(
õõ  
name
úú 
:
úú 
$str
úú #
,
úú# $
template
ùù 
:
ùù 
$str
ùù )
+
ùù* +)
CONST_ROUTE_DEFAULT_CULTURE
ùù, G
+
ùùH I
$str
ùùJ w
)
ùùw x
;
ùùx y
routes
ûû 
.
ûû 
MapRoute
ûû 
(
ûû  
name
üü 
:
üü 
$str
üü  
,
üü  !
template
†† 
:
†† 
$str
†† )
+
††* +)
CONST_ROUTE_DEFAULT_CULTURE
††, G
+
††H I
$str
††J W
)
††W X
;
††X Y
routes
°° 
.
°° 
MapRoute
°° 
(
°°  
name
¢¢ 
:
¢¢ 
$str
¢¢  
,
¢¢  !
template
££ 
:
££ 
$str
££ )
+
££* +)
CONST_ROUTE_DEFAULT_CULTURE
££, G
+
££H I
$str
££J Y
)
££Y Z
;
££Z [
routes
§§ 
.
§§ 
MapRoute
§§ 
(
§§  
name
•• 
:
•• 
$str
•• #
,
••# $
template
¶¶ 
:
¶¶ 
$str
¶¶ )
+
¶¶* +)
CONST_ROUTE_DEFAULT_CULTURE
¶¶, G
+
¶¶H I
$str
¶¶J _
)
¶¶_ `
;
¶¶` a
routes
ßß 
.
ßß 
MapRoute
ßß 
(
ßß  
name
®® 
:
®® 
$str
®® #
,
®®# $
template
©© 
:
©© 
$str
©© )
+
©©* +)
CONST_ROUTE_DEFAULT_CULTURE
©©, G
+
©©H I
$str
©©J _
)
©©_ `
;
©©` a
}
™™ 
)
™™ 
;
™™ 
}
´´ 	
public
∞∞ 
class
∞∞ %
LanguageRouteConstraint
∞∞ ,
:
∞∞- .
IRouteConstraint
∞∞/ ?
{
±± 	
public
≤≤ 
bool
≤≤ 
Match
≤≤ 
(
≤≤ 
HttpContext
≤≤ )
httpContext
≤≤* 5
,
≤≤5 6
IRouter
≤≤7 >
route
≤≤? D
,
≤≤D E
string
≤≤F L
routeKey
≤≤M U
,
≤≤U V"
RouteValueDictionary
≤≤W k
values
≤≤l r
,
≤≤r s
RouteDirection≤≤t Ç
routeDirection≤≤É ë
)≤≤ë í
{
≥≥ 
if
¥¥ 
(
¥¥ 
!
¥¥ 
values
¥¥ 
.
¥¥ 
ContainsKey
¥¥ '
(
¥¥' (
$str
¥¥( 1
)
¥¥1 2
)
¥¥2 3
return
µµ 
false
µµ  
;
µµ  !
var
∑∑ 
culture
∑∑ 
=
∑∑ 
values
∑∑ $
[
∑∑$ %
$str
∑∑% .
]
∑∑. /
.
∑∑/ 0
ToString
∑∑0 8
(
∑∑8 9
)
∑∑9 :
;
∑∑: ;
return
∏∏ 
culture
∏∏ 
==
∏∏ !
$str
∏∏" &
||
∏∏' )
culture
∏∏* 1
==
∏∏2 4
$str
∏∏5 9
;
∏∏9 :
}
ππ 
}
∫∫ 	
}
ªª 
}ºº £	
\D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\ViewComponents\FooterNavbar.cs
	namespace

 	
Swastika


 
.

 
Cms

 
.

 
Mvc

 
.

 
ViewComponents

 )
{ 
public 

class 
FooterNavbar 
: 
ViewComponent  -
{ 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
string 
culture 
= 
ViewBag $
.$ %
culture% ,
;, -
var 
topCates 
= 
new 
List #
<# $!
InfoCategoryViewModel$ 9
>9 :
(: ;
); <
;< =
return 
View 
( 
topCates  
.  !
OrderBy! (
(( )
c) *
=>+ -
c. /
./ 0
Priority0 8
)8 9
.9 :
ToList: @
(@ A
)A B
)B C
;C D
} 	
} 
} Ü
\D:\Workspace\GitHub\Swastika-IO-Core\src\Swastika.Cms.Web.Mvc\ViewComponents\HeaderNavbar.cs
	namespace

 	
Swastika


 
.

 
Cms

 
.

 
Mvc

 
.

 
ViewComponents

 )
{ 
public 

class 
HeaderNavbar 
: 
ViewComponent  -
{ 
public  
IViewComponentResult #
Invoke$ *
(* +
)+ ,
{ 	
string 
culture 
= 
ViewBag $
.$ %
culture% ,
;, -
var 
topCates 
= !
InfoCategoryViewModel 0
.0 1

Repository1 ;
.; <
GetModelListBy< J
( 
c 
=> 
c 
. 
Specificulture &
==' )
culture* 1
&&2 4
c5 6
.6 7 
SiocCategoryPosition7 K
.K L
CountL Q
(Q R
pR S
=>T V
pW X
.X Y

PositionIdY c
==d f
(g h
inth k
)k l
SWCmsConstantsl z
.z {
CatePosition	{ á
.
á à
Top
à ã
)
ã å
>
ç é
$num
è ê
) 
; 
var 
data 
= 
topCates 
.  
Data  $
??% '
new( +
System, 2
.2 3
Collections3 >
.> ?
Generic? F
.F G
ListG K
<K L!
InfoCategoryViewModelL a
>a b
(b c
)c d
;d e
return 
View 
( 
data 
) 
; 
} 	
} 
} 